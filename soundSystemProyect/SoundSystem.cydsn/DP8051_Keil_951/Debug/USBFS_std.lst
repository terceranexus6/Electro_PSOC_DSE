C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE USBFS_STD
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Debug\USBFS_std.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\4.0\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -Generated_Source\PSoC3\USBFS_std.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB WL(2) PR(
                    -.\DP8051_Keil_951\Debug/USBFS_std.lst) CD OT(2,SIZE) OJ(.\DP8051_Keil_951\Debug\USBFS_std.obj)

line level    source

   1          /*******************************************************************************
   2          * File Name: USBFS_std.c
   3          * Version 2.70
   4          *
   5          * Description:
   6          *  USB Standard request handler.
   7          *
   8          * Note:
   9          *
  10          ********************************************************************************
  11          * Copyright 2008-2013, Cypress Semiconductor Corporation.  All rights reserved.
  12          * You may use this file only in accordance with the license, terms, conditions,
  13          * disclaimers, and limitations in the end user license agreement accompanying
  14          * the software package with which this file was provided.
  15          *******************************************************************************/
  16          
  17          #include "USBFS.h"
  18          #include "USBFS_cdc.h"
  19          #include "USBFS_pvt.h"
  20          #if defined(USBFS_ENABLE_MIDI_STREAMING)
                  #include "USBFS_midi.h"
              #endif /*  USBFS_ENABLE_MIDI_STREAMING*/
  23          
  24          
  25          /***************************************
  26          *   Static data allocation
  27          ***************************************/
  28          
  29          #if defined(USBFS_ENABLE_FWSN_STRING)
                  static volatile uint8 *USBFS_fwSerialNumberStringDescriptor;
                  static volatile uint8 USBFS_snStringConfirm = USBFS_FALSE;
              #endif  /* USBFS_ENABLE_FWSN_STRING */
  33          
  34          #if defined(USBFS_ENABLE_FWSN_STRING)
              
                  /*******************************************************************************
                  * Function Name: USBFS_SerialNumString
                  ********************************************************************************
                  *
                  * Summary:
                  *  Application firmware may supply the source of the USB device descriptors
                  *  serial number string during runtime.
                  *
                  * Parameters:
                  *  snString:  pointer to string.
                  *
                  * Return:
                  *  None.
                  *
                  * Reentrant:
                  *  No.
                  *
                  *******************************************************************************/
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 2   

                  void  USBFS_SerialNumString(uint8 snString[]) 
                  {
                      USBFS_snStringConfirm = USBFS_FALSE;
                      if(snString != NULL)
                      {
                          /* Check descriptor validation */
                          if( (snString[0u] > 1u ) && (snString[1u] == USBFS_DESCR_STRING) )
                          {
                              USBFS_fwSerialNumberStringDescriptor = snString;
                              USBFS_snStringConfirm = USBFS_TRUE;
                          }
                      }
                  }
              
              #endif  /* USBFS_ENABLE_FWSN_STRING */
  69          
  70          
  71          /*******************************************************************************
  72          * Function Name: USBFS_HandleStandardRqst
  73          ********************************************************************************
  74          *
  75          * Summary:
  76          *  This Routine dispatches standard requests
  77          *
  78          * Parameters:
  79          *  None.
  80          *
  81          * Return:
  82          *  TRUE if request handled.
  83          *
  84          * Reentrant:
  85          *  No.
  86          *
  87          *******************************************************************************/
  88          uint8 USBFS_HandleStandardRqst(void) 
  89          {
  90   1          uint8 requestHandled = USBFS_FALSE;
  91   1          uint8 interfaceNumber;
  92   1          uint8 configurationN;
  93   1          #if defined(USBFS_ENABLE_STRINGS)
  94   1              volatile uint8 *pStr = 0u;
  95   1              #if defined(USBFS_ENABLE_DESCRIPTOR_STRINGS)
  96   1                  uint8 nStr;
  97   1                  uint8 descrLength;
  98   1              #endif /* USBFS_ENABLE_DESCRIPTOR_STRINGS */
  99   1          #endif /* USBFS_ENABLE_STRINGS */
 100   1          static volatile uint8 USBFS_tBuffer[USBFS_STATUS_LENGTH_MAX];
 101   1          const T_USBFS_LUT CYCODE *pTmp;
 102   1          USBFS_currentTD.count = 0u;
 103   1      
 104   1          if ((CY_GET_REG8(USBFS_bmRequestType) & USBFS_RQST_DIR_MASK) == USBFS_RQST_DIR_D2H)
 105   1          {
 106   2              /* Control Read */
 107   2              switch (CY_GET_REG8(USBFS_bRequest))
 108   2              {
 109   3                  case USBFS_GET_DESCRIPTOR:
 110   3                      if (CY_GET_REG8(USBFS_wValueHi) == USBFS_DESCR_DEVICE)
 111   3                      {
 112   4                          pTmp = USBFS_GetDeviceTablePtr();
 113   4                          USBFS_currentTD.pData = (volatile uint8 *)pTmp->p_list;
 114   4                          USBFS_currentTD.count = USBFS_DEVICE_DESCR_LENGTH;
 115   4                          requestHandled  = USBFS_InitControlRead();
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 3   

 116   4                      }
 117   3                      else if (CY_GET_REG8(USBFS_wValueHi) == USBFS_DESCR_CONFIG)
 118   3                      {
 119   4                          pTmp = USBFS_GetConfigTablePtr(CY_GET_REG8(USBFS_wValueLo));
 120   4                          if( pTmp != NULL )  /* Verify that requested descriptor exists */
 121   4                          {
 122   5                              USBFS_currentTD.pData = (volatile uint8 *)pTmp->p_list;
 123   5                              USBFS_currentTD.count = ((uint16)(USBFS_currentTD.pData)[ \
 124   5                                                USBFS_CONFIG_DESCR_TOTAL_LENGTH_HI] << 8u) | \
 125   5                                               (USBFS_currentTD.pData)[USBFS_CONFIG_DESCR_TOTAL_LENGTH_LOW];
 126   5                              requestHandled  = USBFS_InitControlRead();
 127   5                          }
 128   4                      }
 129   3                      #if defined(USBFS_ENABLE_STRINGS)
 130   3                      else if (CY_GET_REG8(USBFS_wValueHi) == USBFS_DESCR_STRING)
 131   3                      {
 132   4                          /* Descriptor Strings*/
 133   4                          #if defined(USBFS_ENABLE_DESCRIPTOR_STRINGS)
 134   4                              nStr = 0u;
 135   4                              pStr = (volatile uint8 *)&USBFS_STRING_DESCRIPTORS[0u];
 136   4                              while ( (CY_GET_REG8(USBFS_wValueLo) > nStr) && (*pStr != 0u) )
 137   4                              {
 138   5                                  /* Read descriptor length from 1st byte */
 139   5                                  descrLength = *pStr;
 140   5                                  /* Move to next string descriptor */
 141   5                                  pStr = &pStr[descrLength];
 142   5                                  nStr++;
 143   5                              }
 144   4                          #endif /*  USBFS_ENABLE_DESCRIPTOR_STRINGS */
 145   4                          /* Microsoft OS String*/
 146   4                          #if defined(USBFS_ENABLE_MSOS_STRING)
                                      if( CY_GET_REG8(USBFS_wValueLo) == USBFS_STRING_MSOS )
                                      {
                                          pStr = (volatile uint8 *)&USBFS_MSOS_DESCRIPTOR[0u];
                                      }
                                  #endif /*  USBFS_ENABLE_MSOS_STRING*/
 152   4                          /* SN string */
 153   4                          #if defined(USBFS_ENABLE_SN_STRING)
                                      if( (CY_GET_REG8(USBFS_wValueLo) != 0u) &&
                                          (CY_GET_REG8(USBFS_wValueLo) ==
                                          USBFS_DEVICE0_DESCR[USBFS_DEVICE_DESCR_SN_SHIFT]) )
                                      {
                                          
                                          #if defined(USBFS_ENABLE_IDSN_STRING)
                                              /* Read DIE ID and generate string descriptor in RAM */
                                              USBFS_ReadDieID(USBFS_idSerialNumberStringDescriptor);
                                              pStr = USBFS_idSerialNumberStringDescriptor;
                                          #elif defined(USBFS_ENABLE_FWSN_STRING)
                                              if(USBFS_snStringConfirm != USBFS_FALSE)
                                              {
                                                  pStr = USBFS_fwSerialNumberStringDescriptor;
                                              }
                                              else
                                              {
                                                  pStr = (volatile uint8 *)&USBFS_SN_STRING_DESCRIPTOR[0u];
                                              }
                                          #else
                                              pStr = (volatile uint8 *)&USBFS_SN_STRING_DESCRIPTOR[0u];
                                          #endif  /* defined(USBFS_ENABLE_IDSN_STRING) */
                                      }
                                  #endif    /*  USBFS_ENABLE_SN_STRING */
 177   4                          if (*pStr != 0u)
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 4   

 178   4                          {
 179   5                              USBFS_currentTD.count = *pStr;
 180   5                              USBFS_currentTD.pData = pStr;
 181   5                              requestHandled  = USBFS_InitControlRead();
 182   5                          }
 183   4                      }
 184   3                      #endif /*  USBFS_ENABLE_STRINGS */
 185   3                      else
 186   3                      {
 187   4                          requestHandled = USBFS_DispatchClassRqst();
 188   4                      }
 189   3                      break;
 190   3                  case USBFS_GET_STATUS:
 191   3                      switch ((CY_GET_REG8(USBFS_bmRequestType) & USBFS_RQST_RCPT_MASK))
 192   3                      {
 193   4                          case USBFS_RQST_RCPT_EP:
 194   4                              USBFS_currentTD.count = USBFS_EP_STATUS_LENGTH;
 195   4                              USBFS_tBuffer[0u] = USBFS_EP[ \
 196   4                                              CY_GET_REG8(USBFS_wIndexLo) & USBFS_DIR_UNUSED].hwEpState;
 197   4                              USBFS_tBuffer[1u] = 0u;
 198   4                              USBFS_currentTD.pData = &USBFS_tBuffer[0u];
 199   4                              requestHandled  = USBFS_InitControlRead();
 200   4                              break;
 201   4                          case USBFS_RQST_RCPT_DEV:
 202   4                              USBFS_currentTD.count = USBFS_DEVICE_STATUS_LENGTH;
 203   4                              USBFS_tBuffer[0u] = USBFS_deviceStatus;
 204   4                              USBFS_tBuffer[1u] = 0u;
 205   4                              USBFS_currentTD.pData = &USBFS_tBuffer[0u];
 206   4                              requestHandled  = USBFS_InitControlRead();
 207   4                              break;
 208   4                          default:    /* requestHandled is initialized as FALSE by default */
 209   4                              break;
 210   4                      }
 211   3                      break;
 212   3                  case USBFS_GET_CONFIGURATION:
 213   3                      USBFS_currentTD.count = 1u;
 214   3                      USBFS_currentTD.pData = (volatile uint8 *)&USBFS_configuration;
 215   3                      requestHandled  = USBFS_InitControlRead();
 216   3                      break;
 217   3                  case USBFS_GET_INTERFACE:
 218   3                      USBFS_currentTD.count = 1u;
 219   3                      USBFS_currentTD.pData = (volatile uint8 *)&USBFS_interfaceSetting[ \
 220   3                                                                                  CY_GET_REG8(USBFS_wIndexLo)];
 221   3                      requestHandled  = USBFS_InitControlRead();
 222   3                      break;
 223   3                  default: /* requestHandled is initialized as FALSE by default */
 224   3                      break;
 225   3              }
 226   2          }
 227   1          else {
 228   2              /* Control Write */
 229   2              switch (CY_GET_REG8(USBFS_bRequest))
 230   2              {
 231   3                  case USBFS_SET_ADDRESS:
 232   3                      USBFS_deviceAddress = CY_GET_REG8(USBFS_wValueLo);
 233   3                      requestHandled = USBFS_InitNoDataControlTransfer();
 234   3                      break;
 235   3                  case USBFS_SET_CONFIGURATION:
 236   3                      configurationN = CY_GET_REG8(USBFS_wValueLo);
 237   3                      if(configurationN > 0)
 238   3                      {   /* Verify that configuration descriptor exists */
 239   4                          pTmp = USBFS_GetConfigTablePtr(configurationN - 1u);
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 5   

 240   4                      }
 241   3                      /* Responds with a Request Error when configuration number is invalid */
 242   3                      if (((configurationN > 0) && (pTmp != NULL)) || (configurationN == 0u))
 243   3                      {
 244   4                          /* Set new configuration if it has been changed */
 245   4                          if(configurationN != USBFS_configuration)        
 246   4                          {
 247   5                              USBFS_configuration = configurationN;
 248   5                              USBFS_configurationChanged = USBFS_TRUE;
 249   5                              USBFS_Config(USBFS_TRUE);
 250   5                          }
 251   4                          requestHandled = USBFS_InitNoDataControlTransfer();
 252   4                      }
 253   3                      break;
 254   3                  case USBFS_SET_INTERFACE:
 255   3                      if (USBFS_ValidateAlternateSetting() != 0u)
 256   3                      {
 257   4                          interfaceNumber = CY_GET_REG8(USBFS_wIndexLo);
 258   4                          USBFS_interfaceNumber = interfaceNumber;
 259   4                          USBFS_configurationChanged = USBFS_TRUE;
 260   4                          #if ((USBFS_EP_MA == USBFS__MA_DYNAMIC) && \
 261   4                               (USBFS_EP_MM == USBFS__EP_MANUAL) )
                                      USBFS_Config(USBFS_FALSE);
                                  #else
 264   4                              USBFS_ConfigAltChanged();
 265   4                          #endif /*  (USBFS_EP_MA == USBFS__MA_DYNAMIC) */
 266   4                          /* Update handled Alt setting changes status */
 267   4                          USBFS_interfaceSetting_last[interfaceNumber] =
 268   4                               USBFS_interfaceSetting[interfaceNumber];
 269   4                          requestHandled = USBFS_InitNoDataControlTransfer();
 270   4                      }
 271   3                      break;
 272   3                  case USBFS_CLEAR_FEATURE:
 273   3                      switch (CY_GET_REG8(USBFS_bmRequestType) & USBFS_RQST_RCPT_MASK)
 274   3                      {
 275   4                          case USBFS_RQST_RCPT_EP:
 276   4                              if (CY_GET_REG8(USBFS_wValueLo) == USBFS_ENDPOINT_HALT)
 277   4                              {
 278   5                                  requestHandled = USBFS_ClearEndpointHalt();
 279   5                              }
 280   4                              break;
 281   4                          case USBFS_RQST_RCPT_DEV:
 282   4                              /* Clear device REMOTE_WAKEUP */
 283   4                              if (CY_GET_REG8(USBFS_wValueLo) == USBFS_DEVICE_REMOTE_WAKEUP)
 284   4                              {
 285   5                                  USBFS_deviceStatus &= (uint8)~USBFS_DEVICE_STATUS_REMOTE_WAKEUP;
 286   5                                  requestHandled = USBFS_InitNoDataControlTransfer();
 287   5                              }
 288   4                              break;
 289   4                          case USBFS_RQST_RCPT_IFC:
 290   4                              /* Validate interfaceNumber */
 291   4                              if (CY_GET_REG8(USBFS_wIndexLo) < USBFS_MAX_INTERFACES_NUMBER)
 292   4                              {
 293   5                                  USBFS_interfaceStatus[CY_GET_REG8(USBFS_wIndexLo)] &=
 294   5                                                                      (uint8)~(CY_GET_REG8(USBFS_wValueLo));
 295   5                                  requestHandled = USBFS_InitNoDataControlTransfer();
 296   5                              }
 297   4                              break;
 298   4                          default:    /* requestHandled is initialized as FALSE by default */
 299   4                              break;
 300   4                      }
 301   3                      break;
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 6   

 302   3                  case USBFS_SET_FEATURE:
 303   3                      switch (CY_GET_REG8(USBFS_bmRequestType) & USBFS_RQST_RCPT_MASK)
 304   3                      {
 305   4                          case USBFS_RQST_RCPT_EP:
 306   4                              if (CY_GET_REG8(USBFS_wValueLo) == USBFS_ENDPOINT_HALT)
 307   4                              {
 308   5                                  requestHandled = USBFS_SetEndpointHalt();
 309   5                              }
 310   4                              break;
 311   4                          case USBFS_RQST_RCPT_DEV:
 312   4                              /* Set device REMOTE_WAKEUP */
 313   4                              if (CY_GET_REG8(USBFS_wValueLo) == USBFS_DEVICE_REMOTE_WAKEUP)
 314   4                              {
 315   5                                  USBFS_deviceStatus |= USBFS_DEVICE_STATUS_REMOTE_WAKEUP;
 316   5                                  requestHandled = USBFS_InitNoDataControlTransfer();
 317   5                              }
 318   4                              break;
 319   4                          case USBFS_RQST_RCPT_IFC:
 320   4                              /* Validate interfaceNumber */
 321   4                              if (CY_GET_REG8(USBFS_wIndexLo) < USBFS_MAX_INTERFACES_NUMBER)
 322   4                              {
 323   5                                  USBFS_interfaceStatus[CY_GET_REG8(USBFS_wIndexLo)] &=
 324   5                                                                      (uint8)~(CY_GET_REG8(USBFS_wValueLo));
 325   5                                  requestHandled = USBFS_InitNoDataControlTransfer();
 326   5                              }
 327   4                              break;
 328   4                          default:    /* requestHandled is initialized as FALSE by default */
 329   4                              break;
 330   4                      }
 331   3                      break;
 332   3                  default:    /* requestHandled is initialized as FALSE by default */
 333   3                      break;
 334   3              }
 335   2          }
 336   1          return(requestHandled);
 337   1      }
 338          
 339          
 340          #if defined(USBFS_ENABLE_IDSN_STRING)
              
                  /***************************************************************************
                  * Function Name: USBFS_ReadDieID
                  ****************************************************************************
                  *
                  * Summary:
                  *  This routine read Die ID and generate Serial Number string descriptor.
                  *
                  * Parameters:
                  *  descr:  pointer on string descriptor.
                  *
                  * Return:
                  *  None.
                  *
                  * Reentrant:
                  *  No.
                  *
                  ***************************************************************************/
                  void USBFS_ReadDieID(uint8 descr[]) 
                  {
                      uint8 i;
                      uint8 j = 0u;
                      uint8 value;
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 7   

                      const char8 CYCODE hex[16u] = "0123456789ABCDEF";
              
                      /* Check descriptor validation */
                      if( descr != NULL)
                      {
                          descr[0u] = USBFS_IDSN_DESCR_LENGTH;
                          descr[1u] = USBFS_DESCR_STRING;
              
                          /* fill descriptor */
                          for(i = 2u; i < USBFS_IDSN_DESCR_LENGTH; i += 4u)
                          {
                              value = CY_GET_XTND_REG8((void CYFAR *)(USBFS_DIE_ID + j));
                              j++;
                              descr[i] = (uint8)hex[value >> 4u];
                              descr[i + 2u] = (uint8)hex[value & 0x0Fu];
                          }
                      }
                  }
              
              #endif /*  USBFS_ENABLE_IDSN_STRING */
 384          
 385          
 386          /*******************************************************************************
 387          * Function Name: USBFS_ConfigReg
 388          ********************************************************************************
 389          *
 390          * Summary:
 391          *  This routine configures hardware registers from the variables.
 392          *  It is called from USBFS_Config() function and from RestoreConfig
 393          *  after Wakeup.
 394          *
 395          * Parameters:
 396          *  None.
 397          *
 398          * Return:
 399          *  None.
 400          *
 401          *******************************************************************************/
 402          void USBFS_ConfigReg(void) 
 403          {
 404   1          uint8 ep;
 405   1          uint8 i;
 406   1          #if(USBFS_EP_MM == USBFS__EP_DMAAUTO)
                      uint8 epType = 0u;
                  #endif /*  USBFS_EP_MM == USBFS__EP_DMAAUTO */
 409   1      
 410   1          /* Set the endpoint buffer addresses */
 411   1          ep = USBFS_EP1;
 412   1          for (i = 0u; i < 0x80u; i+= 0x10u)
 413   1          {
 414   2              CY_SET_REG8((reg8 *)(USBFS_ARB_EP1_CFG_IND + i), USBFS_ARB_EPX_CFG_DEFAULT);
 415   2              #if(USBFS_EP_MM != USBFS__EP_MANUAL)
 416   2                  /* Enable all Arbiter EP Interrupts : err, buf under, buf over, dma gnt(mode2 only), in buf fu
             -ll */
 417   2                  CY_SET_REG8((reg8 *)(USBFS_ARB_EP1_INT_EN_IND + i), USBFS_ARB_EPX_INT_MASK);
 418   2              #endif   /*  USBFS_EP_MM != USBFS__EP_MANUAL */
 419   2      
 420   2              if(USBFS_EP[ep].epMode != USBFS_MODE_DISABLE)
 421   2              {
 422   3                  if((USBFS_EP[ep].addr & USBFS_DIR_IN) != 0u )
 423   3                  {
 424   4                      CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CR0_IND + i), USBFS_MODE_NAK_IN);
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 8   

 425   4                  }
 426   3                  else
 427   3                  {
 428   4                      CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CR0_IND + i), USBFS_MODE_NAK_OUT);
 429   4                      /* Prepare EP type mask for automatic memory allocation */
 430   4                      #if(USBFS_EP_MM == USBFS__EP_DMAAUTO)
                                  epType |= (uint8)(0x01u << (ep - USBFS_EP1));
                              #endif /*  USBFS_EP_MM == USBFS__EP_DMAAUTO */
 433   4                  }
 434   3              }
 435   2              else
 436   2              {
 437   3                  CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CR0_IND + i), USBFS_MODE_STALL_DATA_EP);
 438   3              }
 439   2      
 440   2              #if(USBFS_EP_MM != USBFS__EP_DMAAUTO)
 441   2                  CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CNT0_IND + i),   USBFS_EP[ep].bufferSize >> 8u);
 442   2                  CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CNT1_IND + i),   USBFS_EP[ep].bufferSize & 0xFFu);
 443   2      
 444   2                  CY_SET_REG8((reg8 *)(USBFS_ARB_RW1_RA_IND + i),     USBFS_EP[ep].buffOffset & 0xFFu);
 445   2                  CY_SET_REG8((reg8 *)(USBFS_ARB_RW1_RA_MSB_IND + i), USBFS_EP[ep].buffOffset >> 8u);
 446   2                  CY_SET_REG8((reg8 *)(USBFS_ARB_RW1_WA_IND + i),     USBFS_EP[ep].buffOffset & 0xFFu);
 447   2                  CY_SET_REG8((reg8 *)(USBFS_ARB_RW1_WA_MSB_IND + i), USBFS_EP[ep].buffOffset >> 8u);
 448   2              #endif /*  USBFS_EP_MM != USBFS__EP_DMAAUTO */
 449   2      
 450   2              ep++;
 451   2          }
 452   1      
 453   1          #if(USBFS_EP_MM == USBFS__EP_DMAAUTO)
                       /* BUF_SIZE depend on DMA_THRESS value: 55-32 bytes  44-16 bytes 33-8 bytes 22-4 bytes 11-2 bytes
             - */
                      USBFS_BUF_SIZE_REG = USBFS_DMA_BUF_SIZE;
                      USBFS_DMA_THRES_REG = USBFS_DMA_BYTES_PER_BURST;   /* DMA burst threshold */
                      USBFS_DMA_THRES_MSB_REG = 0u;
                      USBFS_EP_ACTIVE_REG = USBFS_ARB_INT_MASK;
                      USBFS_EP_TYPE_REG = epType;
                      /* Cfg_cmp bit set to 1 once configuration is complete. */
                      USBFS_ARB_CFG_REG = USBFS_ARB_CFG_AUTO_DMA | USBFS_ARB_CFG_AUTO_MEM |
                                                     USBFS_ARB_CFG_CFG_CPM;
                      /* Cfg_cmp bit set to 0 during configuration of PFSUSB Registers. */
                      USBFS_ARB_CFG_REG = USBFS_ARB_CFG_AUTO_DMA | USBFS_ARB_CFG_AUTO_MEM;
                  #endif /*  USBFS_EP_MM == USBFS__EP_DMAAUTO */
 466   1      
 467   1          CY_SET_REG8(USBFS_SIE_EP_INT_EN_PTR, 0xFFu);
 468   1      }
 469          
 470          
 471          /*******************************************************************************
 472          * Function Name: USBFS_Config
 473          ********************************************************************************
 474          *
 475          * Summary:
 476          *  This routine configures endpoints for the entire configuration by scanning
 477          *  the configuration descriptor.
 478          *
 479          * Parameters:
 480          *  clearAltSetting: It configures the bAlternateSetting 0 for each interface.
 481          *
 482          * Return:
 483          *  None.
 484          *
 485          * USBFS_interfaceClass - Initialized class array for each interface.
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 9   

 486          *   It is used for handling Class specific requests depend on interface class.
 487          *   Different classes in multiple Alternate settings does not supported.
 488          *
 489          * Reentrant:
 490          *  No.
 491          *
 492          *******************************************************************************/
 493          void USBFS_Config(uint8 clearAltSetting) 
 494          {
 495   1          uint8 ep;
 496   1          uint8 cur_ep;
 497   1          uint8 i;
 498   1          uint8 epType;
 499   1          const uint8 *pDescr;
 500   1          #if(USBFS_EP_MM != USBFS__EP_DMAAUTO)
 501   1              uint16 buffCount = 0u;
 502   1          #endif /*  USBFS_EP_MM != USBFS__EP_DMAAUTO */
 503   1      
 504   1          const T_USBFS_LUT CYCODE *pTmp;
 505   1          const T_USBFS_EP_SETTINGS_BLOCK CYCODE *pEP;
 506   1      
 507   1          /* Clear all of the endpoints */
 508   1          for (ep = 0u; ep < USBFS_MAX_EP; ep++)
 509   1          {
 510   2              USBFS_EP[ep].attrib = 0u;
 511   2              USBFS_EP[ep].hwEpState = 0u;
 512   2              USBFS_EP[ep].apiEpState = USBFS_NO_EVENT_PENDING;
 513   2              USBFS_EP[ep].epToggle = 0u;
 514   2              USBFS_EP[ep].epMode = USBFS_MODE_DISABLE;
 515   2              USBFS_EP[ep].bufferSize = 0u;
 516   2              USBFS_EP[ep].interface = 0u;
 517   2      
 518   2          }
 519   1      
 520   1          /* Clear Alternate settings for all interfaces */
 521   1          if(clearAltSetting != 0u)
 522   1          {
 523   2              for (i = 0u; i < USBFS_MAX_INTERFACES_NUMBER; i++)
 524   2              {
 525   3                  USBFS_interfaceSetting[i] = 0x00u;
 526   3                  USBFS_interfaceSetting_last[i] = 0x00u;
 527   3              }
 528   2          }
 529   1      
 530   1          /* Init Endpoints and Device Status if configured */
 531   1          if(USBFS_configuration > 0u)
 532   1          {
 533   2              pTmp = USBFS_GetConfigTablePtr(USBFS_configuration - 1u);
 534   2              /* Set Power status for current configuration */
 535   2              pDescr = (const uint8 *)pTmp->p_list;
 536   2              if((pDescr[USBFS_CONFIG_DESCR_ATTRIB] & USBFS_CONFIG_DESCR_ATTRIB_SELF_POWERED) != 0u)
 537   2              {
 538   3                  USBFS_deviceStatus |=  USBFS_DEVICE_STATUS_SELF_POWERED;
 539   3              }
 540   2              else
 541   2              {
 542   3                  USBFS_deviceStatus &=  (uint8)~USBFS_DEVICE_STATUS_SELF_POWERED;
 543   3              }
 544   2              /* Move to next element */
 545   2              pTmp = &pTmp[1u];
 546   2              ep = pTmp->c;  /* For this table, c is the number of endpoints configurations  */
 547   2      
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 10  

 548   2              #if ((USBFS_EP_MA == USBFS__MA_DYNAMIC) && \
 549   2                   (USBFS_EP_MM == USBFS__EP_MANUAL) )
                          /* Configure for dynamic EP memory allocation */
                          /* p_list points the endpoint setting table. */
                          pEP = (T_USBFS_EP_SETTINGS_BLOCK *) pTmp->p_list;
                          for (i = 0u; i < ep; i++)
                          {
                              /* Compare current Alternate setting with EP Alt */
                              if(USBFS_interfaceSetting[pEP->interface] == pEP->altSetting)
                              {
                                  cur_ep = pEP->addr & USBFS_DIR_UNUSED;
                                  epType = pEP->attributes & USBFS_EP_TYPE_MASK;
                                  if (pEP->addr & USBFS_DIR_IN)
                                  {
                                      /* IN Endpoint */
                                      USBFS_EP[cur_ep].apiEpState = USBFS_EVENT_PENDING;
                                      USBFS_EP[cur_ep].epMode = (epType == USBFS_EP_TYPE_ISOC) ?
                                                                      USBFS_MODE_ISO_IN : USBFS_MODE_ACK_IN;
                                      #if defined(USBFS_ENABLE_CDC_CLASS)
                                          if(((pEP->bMisc == USBFS_CLASS_CDC_DATA) ||
                                              (pEP->bMisc == USBFS_CLASS_CDC)) &&
                                              (epType != USBFS_EP_TYPE_INT))
                                          {
                                              USBFS_cdc_data_in_ep = cur_ep;
                                          }
                                      #endif  /*  USBFS_ENABLE_CDC_CLASS*/
                                      #if ( defined(USBFS_ENABLE_MIDI_STREAMING) && \
                                                           (USBFS_MIDI_IN_BUFF_SIZE > 0) )
                                          if((pEP->bMisc == USBFS_CLASS_AUDIO) &&
                                             (epType == USBFS_EP_TYPE_BULK))
                                          {
                                              USBFS_midi_in_ep = cur_ep;
                                          }
                                      #endif  /*  USBFS_ENABLE_MIDI_STREAMING*/
                                  }
                                  else
                                  {
                                      /* OUT Endpoint */
                                      USBFS_EP[cur_ep].apiEpState = USBFS_NO_EVENT_PENDING;
                                      USBFS_EP[cur_ep].epMode = (epType == USBFS_EP_TYPE_ISOC) ?
                                                                  USBFS_MODE_ISO_OUT : USBFS_MODE_ACK_OUT;
                                      #if defined(USBFS_ENABLE_CDC_CLASS)
                                          if(((pEP->bMisc == USBFS_CLASS_CDC_DATA) ||
                                              (pEP->bMisc == USBFS_CLASS_CDC)) &&
                                              (epType != USBFS_EP_TYPE_INT))
                                          {
                                              USBFS_cdc_data_out_ep = cur_ep;
                                          }
                                      #endif  /*  USBFS_ENABLE_CDC_CLASS*/
                                      #if ( defined(USBFS_ENABLE_MIDI_STREAMING) && \
                                                   (USBFS_MIDI_OUT_BUFF_SIZE > 0) )
                                          if((pEP->bMisc == USBFS_CLASS_AUDIO) &&
                                             (epType == USBFS_EP_TYPE_BULK))
                                          {
                                              USBFS_midi_out_ep = cur_ep;
                                          }
                                      #endif  /*  USBFS_ENABLE_MIDI_STREAMING*/
                                  }
                                  USBFS_EP[cur_ep].bufferSize = pEP->bufferSize;
                                  USBFS_EP[cur_ep].addr = pEP->addr;
                                  USBFS_EP[cur_ep].attrib = pEP->attributes;
                              }
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 11  

                              pEP = &pEP[1u];
                          }
                      #else /* Configure for static EP memory allocation  */
 613   2                  for (i = USBFS_EP1; i < USBFS_MAX_EP; i++)
 614   2                  {
 615   3                      /* p_list points the endpoint setting table. */
 616   3                      pEP = (const T_USBFS_EP_SETTINGS_BLOCK CYCODE *) pTmp->p_list;
 617   3                      /* Find max length for each EP and select it (length could be different in different Alt s
             -ettings) */
 618   3                      /* but other settings should be correct with regards to Interface alt Setting */
 619   3                      for (cur_ep = 0u; cur_ep < ep; cur_ep++)
 620   3                      {
 621   4                          /* EP count is equal to EP # in table and we found larger EP length than have before*/
 622   4                          if(i == (pEP->addr & USBFS_DIR_UNUSED))
 623   4                          {
 624   5                              if(USBFS_EP[i].bufferSize < pEP->bufferSize)
 625   5                              {
 626   6                                  USBFS_EP[i].bufferSize = pEP->bufferSize;
 627   6                              }
 628   5                              /* Compare current Alternate setting with EP Alt*/
 629   5                              if(USBFS_interfaceSetting[pEP->interface] == pEP->altSetting)
 630   5                              {
 631   6                                  epType = pEP->attributes & USBFS_EP_TYPE_MASK;
 632   6                                  if ((pEP->addr & USBFS_DIR_IN) != 0u)
 633   6                                  {
 634   7                                      /* IN Endpoint */
 635   7                                      USBFS_EP[i].apiEpState = USBFS_EVENT_PENDING;
 636   7                                      USBFS_EP[i].epMode = (epType == USBFS_EP_TYPE_ISOC) ?
 637   7                                                              USBFS_MODE_ISO_IN : USBFS_MODE_ACK_IN;
 638   7                                      /* Find and initialize CDC IN endpoint number */
 639   7                                      #if defined(USBFS_ENABLE_CDC_CLASS)
                                                  if(((pEP->bMisc == USBFS_CLASS_CDC_DATA) ||
                                                      (pEP->bMisc == USBFS_CLASS_CDC)) &&
                                                      (epType != USBFS_EP_TYPE_INT))
                                                  {
                                                      USBFS_cdc_data_in_ep = i;
                                                  }
                                              #endif  /*  USBFS_ENABLE_CDC_CLASS*/
 647   7                                      #if ( defined(USBFS_ENABLE_MIDI_STREAMING) && \
 648   7                                                   (USBFS_MIDI_IN_BUFF_SIZE > 0) )
                                                  if((pEP->bMisc == USBFS_CLASS_AUDIO) &&
                                                     (epType == USBFS_EP_TYPE_BULK))
                                                  {
                                                      USBFS_midi_in_ep = i;
                                                  }
                                              #endif  /*  USBFS_ENABLE_MIDI_STREAMING*/
 655   7                                  }
 656   6                                  else
 657   6                                  {
 658   7                                      /* OUT Endpoint */
 659   7                                      USBFS_EP[i].apiEpState = USBFS_NO_EVENT_PENDING;
 660   7                                      USBFS_EP[i].epMode = (epType == USBFS_EP_TYPE_ISOC) ?
 661   7                                                          USBFS_MODE_ISO_OUT : USBFS_MODE_ACK_OUT;
 662   7                                      /* Find and initialize CDC IN endpoint number */
 663   7                                      #if defined(USBFS_ENABLE_CDC_CLASS)
                                                  if(((pEP->bMisc == USBFS_CLASS_CDC_DATA) ||
                                                      (pEP->bMisc == USBFS_CLASS_CDC)) &&
                                                      (epType != USBFS_EP_TYPE_INT))
                                                  {
                                                      USBFS_cdc_data_out_ep = i;
                                                  }
                                              #endif  /*  USBFS_ENABLE_CDC_CLASS*/
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 12  

 671   7                                      #if ( defined(USBFS_ENABLE_MIDI_STREAMING) && \
 672   7                                                   (USBFS_MIDI_OUT_BUFF_SIZE > 0) )
                                                  if((pEP->bMisc == USBFS_CLASS_AUDIO) &&
                                                     (epType == USBFS_EP_TYPE_BULK))
                                                  {
                                                      USBFS_midi_out_ep = i;
                                                  }
                                              #endif  /*  USBFS_ENABLE_MIDI_STREAMING*/
 679   7                                  }
 680   6                                  USBFS_EP[i].addr = pEP->addr;
 681   6                                  USBFS_EP[i].attrib = pEP->attributes;
 682   6      
 683   6                                  #if(USBFS_EP_MM == USBFS__EP_DMAAUTO)
                                              break;      /* use first EP setting in Auto memory managment */
                                          #endif /*  USBFS_EP_MM == USBFS__EP_DMAAUTO */
 686   6                              }
 687   5                          }
 688   4                          pEP = &pEP[1u];
 689   4                      }
 690   3                  }
 691   2              #endif /*  (USBFS_EP_MA == USBFS__MA_DYNAMIC) */
 692   2      
 693   2              /* Init class array for each interface and interface number for each EP.
 694   2              *  It is used for handling Class specific requests directed to either an
 695   2              *  interface or the endpoint.
 696   2              */
 697   2              /* p_list points the endpoint setting table. */
 698   2              pEP = (const T_USBFS_EP_SETTINGS_BLOCK CYCODE *) pTmp->p_list;
 699   2              for (i = 0u; i < ep; i++)
 700   2              {
 701   3                  /* Configure interface number for each EP*/
 702   3                  USBFS_EP[pEP->addr & USBFS_DIR_UNUSED].interface = pEP->interface;
 703   3                  pEP = &pEP[1u];
 704   3              }
 705   2              /* Init pointer on interface class table*/
 706   2              USBFS_interfaceClass = USBFS_GetInterfaceClassTablePtr();
 707   2              /* Set the endpoint buffer addresses */
 708   2      
 709   2              #if(USBFS_EP_MM != USBFS__EP_DMAAUTO)
 710   2                  for (ep = USBFS_EP1; ep < USBFS_MAX_EP; ep++)
 711   2                  {
 712   3                      USBFS_EP[ep].buffOffset = buffCount;
 713   3                       buffCount += USBFS_EP[ep].bufferSize;
 714   3                  }
 715   2              #endif /*  USBFS_EP_MM != USBFS__EP_DMAAUTO */
 716   2      
 717   2              /* Configure hardware registers */
 718   2              USBFS_ConfigReg();
 719   2          } /* USBFS_configuration > 0 */
 720   1      }
 721          
 722          
 723          /*******************************************************************************
 724          * Function Name: USBFS_ConfigAltChanged
 725          ********************************************************************************
 726          *
 727          * Summary:
 728          *  This routine update configuration for the required endpoints only.
 729          *  It is called after SET_INTERFACE request when Static memory allocation used.
 730          *
 731          * Parameters:
 732          *  None.
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 13  

 733          *
 734          * Return:
 735          *  None.
 736          *
 737          * Reentrant:
 738          *  No.
 739          *
 740          *******************************************************************************/
 741          void USBFS_ConfigAltChanged(void) 
 742          {
 743   1          uint8 ep;
 744   1          uint8 cur_ep;
 745   1          uint8 i;
 746   1          uint8 epType;
 747   1          uint8 ri;
 748   1      
 749   1          const T_USBFS_LUT CYCODE *pTmp;
 750   1          const T_USBFS_EP_SETTINGS_BLOCK CYCODE *pEP;
 751   1      
 752   1      
 753   1          /* Init Endpoints and Device Status if configured */
 754   1          if(USBFS_configuration > 0u)
 755   1          {
 756   2              pTmp = USBFS_GetConfigTablePtr(USBFS_configuration - 1u);
 757   2              pTmp = &pTmp[1u];
 758   2              ep = pTmp->c;  /* For this table, c is the number of endpoints configurations  */
 759   2      
 760   2              /* Do not touch EP which doesn't need reconfiguration */
 761   2              /* When Alt setting changed, the only required endpoints need to be reconfigured */
 762   2              /* p_list points the endpoint setting table. */
 763   2              pEP = (const T_USBFS_EP_SETTINGS_BLOCK CYCODE *) pTmp->p_list;
 764   2              for (i = 0u; i < ep; i++)
 765   2              {
 766   3                  /*If Alt setting changed and new is same with EP Alt */
 767   3                  if((USBFS_interfaceSetting[pEP->interface] !=
 768   3                      USBFS_interfaceSetting_last[pEP->interface] ) &&
 769   3                     (USBFS_interfaceSetting[pEP->interface] == pEP->altSetting) &&
 770   3                     (pEP->interface == CY_GET_REG8(USBFS_wIndexLo)))
 771   3                  {
 772   4                      cur_ep = pEP->addr & USBFS_DIR_UNUSED;
 773   4                      ri = ((cur_ep - USBFS_EP1) << USBFS_EPX_CNTX_ADDR_SHIFT);
 774   4                      epType = pEP->attributes & USBFS_EP_TYPE_MASK;
 775   4                      if ((pEP->addr & USBFS_DIR_IN) != 0u)
 776   4                      {
 777   5                          /* IN Endpoint */
 778   5                          USBFS_EP[cur_ep].apiEpState = USBFS_EVENT_PENDING;
 779   5                          USBFS_EP[cur_ep].epMode = (epType == USBFS_EP_TYPE_ISOC) ?
 780   5                                                      USBFS_MODE_ISO_IN : USBFS_MODE_ACK_IN;
 781   5                      }
 782   4                      else
 783   4                      {
 784   5                          /* OUT Endpoint */
 785   5                          USBFS_EP[cur_ep].apiEpState = USBFS_NO_EVENT_PENDING;
 786   5                          USBFS_EP[cur_ep].epMode = (epType == USBFS_EP_TYPE_ISOC) ?
 787   5                                                      USBFS_MODE_ISO_OUT : USBFS_MODE_ACK_OUT;
 788   5                      }
 789   4                       /* Change the SIE mode for the selected EP to NAK ALL */
 790   4                       CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CR0_IND + ri), USBFS_MODE_NAK_IN_OUT);
 791   4                      USBFS_EP[cur_ep].bufferSize = pEP->bufferSize;
 792   4                      USBFS_EP[cur_ep].addr = pEP->addr;
 793   4                      USBFS_EP[cur_ep].attrib = pEP->attributes;
 794   4      
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 14  

 795   4                      /* Clear the data toggle */
 796   4                      USBFS_EP[cur_ep].epToggle = 0u;
 797   4      
 798   4                      /* Dynamic reconfiguration for mode 3 transfer */
 799   4                  #if(USBFS_EP_MM == USBFS__EP_DMAAUTO)
                              /* In_data_rdy for selected EP should be set to 0 */
                              * (reg8 *)(USBFS_ARB_EP1_CFG_IND + ri) &= (uint8)~USBFS_ARB_EPX_CFG_IN_DATA_RDY;
              
                              /* write the EP number for which reconfiguration is required */
                              USBFS_DYN_RECONFIG_REG = (cur_ep - USBFS_EP1) <<
                                                                  USBFS_DYN_RECONFIG_EP_SHIFT;
                              /* Set the dyn_config_en bit in dynamic reconfiguration register */
                              USBFS_DYN_RECONFIG_REG |= USBFS_DYN_RECONFIG_ENABLE;
                              /* wait for the dyn_config_rdy bit to set by the block,
                              *  this bit will be set to 1 when block is ready for reconfiguration.
                              */
                              while((USBFS_DYN_RECONFIG_REG & USBFS_DYN_RECONFIG_RDY_STS) == 0u)
                              {
                                  ;
                              }
                              /* Once dyn_config_rdy bit is set, FW can change the EP configuration. */
                              /* Change EP Type with new direction */
                              if((pEP->addr & USBFS_DIR_IN) == 0u)
                              {
                                  USBFS_EP_TYPE_REG |= (uint8)(0x01u << (cur_ep - USBFS_EP1));
                              }
                              else
                              {
                                  USBFS_EP_TYPE_REG &= (uint8)~(uint8)(0x01u << (cur_ep - USBFS_EP1));
                              }
                              /* dynamic reconfiguration enable bit cleared, pointers and control/status
                              *  signals for the selected EP is cleared/re-initialized on negative edge
                              *  of dynamic reconfiguration enable bit).
                              */
                              USBFS_DYN_RECONFIG_REG &= (uint8)~USBFS_DYN_RECONFIG_ENABLE;
                              /* The main loop has to re-enable DMA and OUT endpoint*/
                          #else
 832   4                      CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CNT0_IND + ri),
 833   4                                                                      USBFS_EP[cur_ep].bufferSize >> 8u);
 834   4                      CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CNT1_IND + ri),
 835   4                                                                      USBFS_EP[cur_ep].bufferSize & 0xFFu);
 836   4                      CY_SET_REG8((reg8 *)(USBFS_ARB_RW1_RA_IND + ri),
 837   4                                                                      USBFS_EP[cur_ep].buffOffset & 0xFFu);
 838   4                      CY_SET_REG8((reg8 *)(USBFS_ARB_RW1_RA_MSB_IND + ri),
 839   4                                                                      USBFS_EP[cur_ep].buffOffset >> 8u);
 840   4                      CY_SET_REG8((reg8 *)(USBFS_ARB_RW1_WA_IND + ri),
 841   4                                                                      USBFS_EP[cur_ep].buffOffset & 0xFFu);
 842   4                      CY_SET_REG8((reg8 *)(USBFS_ARB_RW1_WA_MSB_IND + ri),
 843   4                                                                      USBFS_EP[cur_ep].buffOffset >> 8u);
 844   4                  #endif /*  USBFS_EP_MM == USBFS__EP_DMAAUTO */
 845   4                  }
 846   3                  /* Get next EP element */
 847   3                  pEP = &pEP[1u];
 848   3              }
 849   2          }   /* USBFS_configuration > 0 */
 850   1      }
 851          
 852          
 853          /*******************************************************************************
 854          * Function Name: USBFS_GetConfigTablePtr
 855          ********************************************************************************
 856          *
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 15  

 857          * Summary:
 858          *  This routine returns a pointer a configuration table entry
 859          *
 860          * Parameters:
 861          *  confIndex:  Configuration Index
 862          *
 863          * Return:
 864          *  Device Descriptor pointer or NULL when descriptor isn't exists.
 865          *
 866          *******************************************************************************/
 867          const T_USBFS_LUT CYCODE *USBFS_GetConfigTablePtr(uint8 confIndex)
 868                                                                  
 869          {
 870   1          /* Device Table */
 871   1          const T_USBFS_LUT CYCODE *pTmp;
 872   1      
 873   1          pTmp = (const T_USBFS_LUT CYCODE *) USBFS_TABLE[USBFS_device].p_list;
 874   1      
 875   1          /* The first entry points to the Device Descriptor,
 876   1          *  the rest configuration entries.
 877   1          *  Set pointer to the first Configuration Descriptor
 878   1          */
 879   1          pTmp = &pTmp[1u];
 880   1          /* For this table, c is the number of configuration descriptors  */
 881   1          if(confIndex >= pTmp->c)   /* Verify that required configuration descriptor exists */
 882   1          {
 883   2              pTmp = (const T_USBFS_LUT CYCODE *) NULL;
 884   2          }
 885   1          else
 886   1          {
 887   2              pTmp = (const T_USBFS_LUT CYCODE *) pTmp[confIndex].p_list;
 888   2          }
 889   1          
 890   1          return( pTmp );
 891   1      }
 892          
 893          
 894          /*******************************************************************************
 895          * Function Name: USBFS_GetDeviceTablePtr
 896          ********************************************************************************
 897          *
 898          * Summary:
 899          *  This routine returns a pointer to the Device table
 900          *
 901          * Parameters:
 902          *  None.
 903          *
 904          * Return:
 905          *  Device Table pointer
 906          *
 907          *******************************************************************************/
 908          const T_USBFS_LUT CYCODE *USBFS_GetDeviceTablePtr(void)
 909                                                                      
 910          {
 911   1          /* Device Table */
 912   1          return( (const T_USBFS_LUT CYCODE *) USBFS_TABLE[USBFS_device].p_list );
 913   1      }
 914          
 915          
 916          /*******************************************************************************
 917          * Function Name: USB_GetInterfaceClassTablePtr
 918          ********************************************************************************
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 16  

 919          *
 920          * Summary:
 921          *  This routine returns Interface Class table pointer, which contains
 922          *  the relation between interface number and interface class.
 923          *
 924          * Parameters:
 925          *  None.
 926          *
 927          * Return:
 928          *  Interface Class table pointer.
 929          *
 930          *******************************************************************************/
 931          const uint8 CYCODE *USBFS_GetInterfaceClassTablePtr(void)
 932                                                                  
 933          {
 934   1          const T_USBFS_LUT CYCODE *pTmp;
 935   1          const uint8 CYCODE *pInterfaceClass;
 936   1          uint8 currentInterfacesNum;
 937   1      
 938   1          pTmp = USBFS_GetConfigTablePtr(USBFS_configuration - 1u);
 939   1          if( pTmp != NULL )
 940   1          {
 941   2              currentInterfacesNum  = ((const uint8 *) pTmp->p_list)[USBFS_CONFIG_DESCR_NUM_INTERFACES];
 942   2              /* Third entry in the LUT starts the Interface Table pointers */
 943   2              /* The INTERFACE_CLASS table is located after all interfaces */
 944   2              pTmp = &pTmp[currentInterfacesNum + 2u];
 945   2              pInterfaceClass = (const uint8 CYCODE *) pTmp->p_list;
 946   2          }
 947   1          else
 948   1          {
 949   2              pInterfaceClass = (const uint8 CYCODE *) NULL;
 950   2          }
 951   1          
 952   1          return( pInterfaceClass );
 953   1      }
 954          
 955          
 956          /*******************************************************************************
 957          * Function Name: USBFS_TerminateEP
 958          ********************************************************************************
 959          *
 960          * Summary:
 961          *  This function terminates the specified USBFS endpoint.
 962          *  This function should be used before endpoint reconfiguration.
 963          *
 964          * Parameters:
 965          *  Endpoint number.
 966          *
 967          * Return:
 968          *  None.
 969          *
 970          * Reentrant:
 971          *  No.
 972          *
 973          *******************************************************************************/
 974          void USBFS_TerminateEP(uint8 ep) 
 975          {
 976   1          uint8 ri;
 977   1      
 978   1          ep &= USBFS_DIR_UNUSED;
 979   1          ri = ((ep - USBFS_EP1) << USBFS_EPX_CNTX_ADDR_SHIFT);
 980   1      
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 17  

 981   1          if ((ep > USBFS_EP0) && (ep < USBFS_MAX_EP))
 982   1          {
 983   2              /* Set the endpoint Halt */
 984   2              USBFS_EP[ep].hwEpState |= (USBFS_ENDPOINT_STATUS_HALT);
 985   2      
 986   2              /* Clear the data toggle */
 987   2              USBFS_EP[ep].epToggle = 0u;
 988   2              USBFS_EP[ep].apiEpState = USBFS_NO_EVENT_ALLOWED;
 989   2      
 990   2              if ((USBFS_EP[ep].addr & USBFS_DIR_IN) != 0u)
 991   2              {
 992   3                  /* IN Endpoint */
 993   3                  CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CR0_IND + ri), USBFS_MODE_NAK_IN);
 994   3              }
 995   2              else
 996   2              {
 997   3                  /* OUT Endpoint */
 998   3                  CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CR0_IND + ri), USBFS_MODE_NAK_OUT);
 999   3              }
1000   2          }
1001   1      }
1002          
1003          
1004          /*******************************************************************************
1005          * Function Name: USBFS_SetEndpointHalt
1006          ********************************************************************************
1007          *
1008          * Summary:
1009          *  This routine handles set endpoint halt.
1010          *
1011          * Parameters:
1012          *  None.
1013          *
1014          * Return:
1015          *  requestHandled.
1016          *
1017          * Reentrant:
1018          *  No.
1019          *
1020          *******************************************************************************/
1021          uint8 USBFS_SetEndpointHalt(void) 
1022          {
1023   1          uint8 ep;
1024   1          uint8 ri;
1025   1          uint8 requestHandled = USBFS_FALSE;
1026   1      
1027   1          /* Set endpoint halt */
1028   1          ep = CY_GET_REG8(USBFS_wIndexLo) & USBFS_DIR_UNUSED;
1029   1          ri = ((ep - USBFS_EP1) << USBFS_EPX_CNTX_ADDR_SHIFT);
1030   1      
1031   1          if ((ep > USBFS_EP0) && (ep < USBFS_MAX_EP))
1032   1          {
1033   2              /* Set the endpoint Halt */
1034   2              USBFS_EP[ep].hwEpState |= (USBFS_ENDPOINT_STATUS_HALT);
1035   2      
1036   2              /* Clear the data toggle */
1037   2              USBFS_EP[ep].epToggle = 0u;
1038   2              USBFS_EP[ep].apiEpState |= USBFS_NO_EVENT_ALLOWED;
1039   2      
1040   2              if ((USBFS_EP[ep].addr & USBFS_DIR_IN) != 0u)
1041   2              {
1042   3                  /* IN Endpoint */
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 18  

1043   3                  CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CR0_IND + ri), USBFS_MODE_STALL_DATA_EP |
1044   3                                                                     USBFS_MODE_ACK_IN);
1045   3              }
1046   2              else
1047   2              {
1048   3                  /* OUT Endpoint */
1049   3                  CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CR0_IND + ri), USBFS_MODE_STALL_DATA_EP |
1050   3                                                                     USBFS_MODE_ACK_OUT);
1051   3              }
1052   2              requestHandled = USBFS_InitNoDataControlTransfer();
1053   2          }
1054   1      
1055   1          return(requestHandled);
1056   1      }
1057          
1058          
1059          /*******************************************************************************
1060          * Function Name: USBFS_ClearEndpointHalt
1061          ********************************************************************************
1062          *
1063          * Summary:
1064          *  This routine handles clear endpoint halt.
1065          *
1066          * Parameters:
1067          *  None.
1068          *
1069          * Return:
1070          *  requestHandled.
1071          *
1072          * Reentrant:
1073          *  No.
1074          *
1075          *******************************************************************************/
1076          uint8 USBFS_ClearEndpointHalt(void) 
1077          {
1078   1          uint8 ep;
1079   1          uint8 ri;
1080   1          uint8 requestHandled = USBFS_FALSE;
1081   1      
1082   1          /* Clear endpoint halt */
1083   1          ep = CY_GET_REG8(USBFS_wIndexLo) & USBFS_DIR_UNUSED;
1084   1          ri = ((ep - USBFS_EP1) << USBFS_EPX_CNTX_ADDR_SHIFT);
1085   1      
1086   1          if ((ep > USBFS_EP0) && (ep < USBFS_MAX_EP))
1087   1          {
1088   2              /* Clear the endpoint Halt */
1089   2              USBFS_EP[ep].hwEpState &= (uint8)~(USBFS_ENDPOINT_STATUS_HALT);
1090   2      
1091   2              /* Clear the data toggle */
1092   2              USBFS_EP[ep].epToggle = 0u;
1093   2              /* Clear toggle bit for already armed packet */
1094   2              CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CNT0_IND + ri), CY_GET_REG8(
1095   2                          (reg8 *)(USBFS_SIE_EP1_CNT0_IND + ri)) & (uint8)~USBFS_EPX_CNT_DATA_TOGGLE);
1096   2              /* Return API State as it was defined before */
1097   2              USBFS_EP[ep].apiEpState &= (uint8)~USBFS_NO_EVENT_ALLOWED;
1098   2      
1099   2              if ((USBFS_EP[ep].addr & USBFS_DIR_IN) != 0u)
1100   2              {
1101   3                  /* IN Endpoint */
1102   3                  if(USBFS_EP[ep].apiEpState == USBFS_IN_BUFFER_EMPTY)
1103   3                  {       /* Wait for next packet from application */
1104   4                      CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CR0_IND + ri), USBFS_MODE_NAK_IN);
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 19  

1105   4                  }
1106   3                  else    /* Continue armed transfer */
1107   3                  {
1108   4                      CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CR0_IND + ri), USBFS_MODE_ACK_IN);
1109   4                  }
1110   3              }
1111   2              else
1112   2              {
1113   3                  /* OUT Endpoint */
1114   3                  if(USBFS_EP[ep].apiEpState == USBFS_OUT_BUFFER_FULL)
1115   3                  {       /* Allow application to read full buffer */
1116   4                      CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CR0_IND + ri), USBFS_MODE_NAK_OUT);
1117   4                  }
1118   3                  else    /* Mark endpoint as empty, so it will be reloaded */
1119   3                  {
1120   4                      CY_SET_REG8((reg8 *)(USBFS_SIE_EP1_CR0_IND + ri), USBFS_MODE_ACK_OUT);
1121   4                  }
1122   3              }
1123   2              requestHandled = USBFS_InitNoDataControlTransfer();
1124   2          }
1125   1      
1126   1          return(requestHandled);
1127   1      }
1128          
1129          
1130          /*******************************************************************************
1131          * Function Name: USBFS_ValidateAlternateSetting
1132          ********************************************************************************
1133          *
1134          * Summary:
1135          *  Validates (and records) a SET INTERFACE request.
1136          *
1137          * Parameters:
1138          *  None.
1139          *
1140          * Return:
1141          *  requestHandled.
1142          *
1143          * Reentrant:
1144          *  No.
1145          *
1146          *******************************************************************************/
1147          uint8 USBFS_ValidateAlternateSetting(void) 
1148          {
1149   1          uint8 requestHandled = USBFS_TRUE;
1150   1          uint8 interfaceNum;
1151   1          const T_USBFS_LUT CYCODE *pTmp;
1152   1          uint8 currentInterfacesNum;
1153   1      
1154   1          interfaceNum = CY_GET_REG8(USBFS_wIndexLo);
1155   1          /* Validate interface setting, stall if invalid. */
1156   1          pTmp = USBFS_GetConfigTablePtr(USBFS_configuration - 1u);
1157   1          currentInterfacesNum  = ((const uint8 *) pTmp->p_list)[USBFS_CONFIG_DESCR_NUM_INTERFACES];
1158   1      
1159   1          if((interfaceNum >= currentInterfacesNum) || (interfaceNum >= USBFS_MAX_INTERFACES_NUMBER))
1160   1          {   /* Wrong interface number */
1161   2              requestHandled = USBFS_FALSE;
1162   2          }
1163   1          else
1164   1          {
1165   2              /* Save current Alt setting to find out the difference in Config() function */
1166   2              USBFS_interfaceSetting_last[interfaceNum] = USBFS_interfaceSetting[interfaceNum];
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 20  

1167   2              USBFS_interfaceSetting[interfaceNum] = CY_GET_REG8(USBFS_wValueLo);
1168   2          }
1169   1      
1170   1          return (requestHandled);
1171   1      }
1172          
1173          
1174          /* [] END OF FILE */
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 21  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION USBFS_HandleStandardRqst (BEGIN)
                                           ; SOURCE LINE # 88
                                           ; SOURCE LINE # 89
                                           ; SOURCE LINE # 90
0000 900000      R     MOV     DPTR,#requestHandled
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 94
0005 7B00              MOV     R3,#00H
0007 7A00              MOV     R2,#00H
0009 7900              MOV     R1,#00H
000B 900000      R     MOV     DPTR,#pStr
000E 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 102
0011 900000      E     MOV     DPTR,#USBFS_currentTD
0014 E4                CLR     A
0015 F0                MOVX    @DPTR,A
0016 A3                INC     DPTR
0017 E4                CLR     A
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 104
0019 906000            MOV     DPTR,#06000H
001C E0                MOVX    A,@DPTR
001D FF                MOV     R7,A
001E EF                MOV     A,R7
001F 5480              ANL     A,#080H
0021 FF                MOV     R7,A
0022 7E00              MOV     R6,#00H
0024 EF                MOV     A,R7
0025 6480              XRL     A,#080H
0027 4E                ORL     A,R6
0028 6003              JZ      $ + 5H
002A 020000      R     LJMP    ?C0001
                                           ; SOURCE LINE # 105
                                           ; SOURCE LINE # 107
002D 906001            MOV     DPTR,#06001H
0030 E0                MOVX    A,@DPTR
0031 FF                MOV     R7,A
0032 EF                MOV     A,R7
0033 120000      E     LCALL   ?C?CCASE
0036 0000        R     DW      ?C0014
0038 00                DB      00H
0039 0000        R     DW      ?C0003
003B 06                DB      06H
003C 0000        R     DW      ?C0019
003E 08                DB      08H
003F 0000        R     DW      ?C0020
0041 0A                DB      0AH
0042 0000              DW      00H
0044 0000        R     DW      ?C0022
                                           ; SOURCE LINE # 108
                                           ; SOURCE LINE # 109
0046         ?C0003:
                                           ; SOURCE LINE # 110
0046 906003            MOV     DPTR,#06003H
0049 E0                MOVX    A,@DPTR
004A FF                MOV     R7,A
004B EF                MOV     A,R7
004C B40135            CJNE    A,#01H,?C0004
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 22  

                                           ; SOURCE LINE # 111
                                           ; SOURCE LINE # 112
004F 120000      R     LCALL   USBFS_GetDeviceTablePtr
0052 900000      R     MOV     DPTR,#pTmp
0055 EE                MOV     A,R6
0056 F0                MOVX    @DPTR,A
0057 A3                INC     DPTR
0058 EF                MOV     A,R7
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 113
005A 900000      R     MOV     DPTR,#pTmp
005D E0                MOVX    A,@DPTR
005E FE                MOV     R6,A
005F A3                INC     DPTR
0060 E0                MOVX    A,@DPTR
0061 FF                MOV     R7,A
0062 8F82              MOV     DPL,R7
0064 8E83              MOV     DPH,R6
0066 A3                INC     DPTR
0067 120000      E     LCALL   ?C?PLDCODE
006A 900000      E     MOV     DPTR,#USBFS_currentTD+02H
006D 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 114
0070 900000      E     MOV     DPTR,#USBFS_currentTD
0073 E4                CLR     A
0074 F0                MOVX    @DPTR,A
0075 A3                INC     DPTR
0076 7412              MOV     A,#012H
0078 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 115
0079 120000      E     LCALL   USBFS_InitControlRead
007C 900000      R     MOV     DPTR,#requestHandled
007F EF                MOV     A,R7
0080 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 116
0081 020000      R     LJMP    ?C0022
0084         ?C0004:
                                           ; SOURCE LINE # 117
0084 906003            MOV     DPTR,#06003H
0087 E0                MOVX    A,@DPTR
0088 FF                MOV     R7,A
0089 EF                MOV     A,R7
008A 6402              XRL     A,#02H
008C 707A              JNZ     ?C0006
                                           ; SOURCE LINE # 118
                                           ; SOURCE LINE # 119
008E 906002            MOV     DPTR,#06002H
0091 E0                MOVX    A,@DPTR
0092 FF                MOV     R7,A
0093 120000      R     LCALL   _USBFS_GetConfigTablePtr
0096 900000      R     MOV     DPTR,#pTmp
0099 EE                MOV     A,R6
009A F0                MOVX    @DPTR,A
009B A3                INC     DPTR
009C EF                MOV     A,R7
009D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 120
009E 900000      R     MOV     DPTR,#pTmp
00A1 E0                MOVX    A,@DPTR
00A2 FE                MOV     R6,A
00A3 A3                INC     DPTR
00A4 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 23  

00A5 FF                MOV     R7,A
00A6 EF                MOV     A,R7
00A7 4E                ORL     A,R6
00A8 7003              JNZ     $ + 5H
00AA 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 121
                                           ; SOURCE LINE # 122
00AD 900000      R     MOV     DPTR,#pTmp
00B0 E0                MOVX    A,@DPTR
00B1 FE                MOV     R6,A
00B2 A3                INC     DPTR
00B3 E0                MOVX    A,@DPTR
00B4 FF                MOV     R7,A
00B5 8F82              MOV     DPL,R7
00B7 8E83              MOV     DPH,R6
00B9 A3                INC     DPTR
00BA 120000      E     LCALL   ?C?PLDCODE
00BD 900000      E     MOV     DPTR,#USBFS_currentTD+02H
00C0 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 123
00C3 900000      E     MOV     DPTR,#USBFS_currentTD+02H
00C6 120000      E     LCALL   ?C?PLDXDATA
00C9 E9                MOV     A,R1
00CA 2403              ADD     A,#03H
00CC F9                MOV     R1,A
00CD EA                MOV     A,R2
00CE 3400              ADDC    A,#00H
00D0 FA                MOV     R2,A
00D1 120000      E     LCALL   ?C?CLDPTR
00D4 FF                MOV     R7,A
00D5 7E00              MOV     R6,#00H
00D7 EF                MOV     A,R7
00D8 7F00              MOV     R7,#00H
00DA FE                MOV     R6,A
00DB 900000      E     MOV     DPTR,#USBFS_currentTD+02H
00DE 120000      E     LCALL   ?C?PLDXDATA
00E1 E9                MOV     A,R1
00E2 2402              ADD     A,#02H
00E4 F9                MOV     R1,A
00E5 EA                MOV     A,R2
00E6 3400              ADDC    A,#00H
00E8 FA                MOV     R2,A
00E9 120000      E     LCALL   ?C?CLDPTR
00EC FD                MOV     R5,A
00ED 7C00              MOV     R4,#00H
00EF EE                MOV     A,R6
00F0 4C                ORL     A,R4
00F1 FE                MOV     R6,A
00F2 EF                MOV     A,R7
00F3 4D                ORL     A,R5
00F4 FF                MOV     R7,A
00F5 900000      E     MOV     DPTR,#USBFS_currentTD
00F8 EE                MOV     A,R6
00F9 F0                MOVX    @DPTR,A
00FA A3                INC     DPTR
00FB EF                MOV     A,R7
00FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 126
00FD 120000      E     LCALL   USBFS_InitControlRead
0100 900000      R     MOV     DPTR,#requestHandled
0103 EF                MOV     A,R7
0104 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 24  

                                           ; SOURCE LINE # 127
                                           ; SOURCE LINE # 128
0105 020000      R     LJMP    ?C0022
0108         ?C0006:
                                           ; SOURCE LINE # 130
0108 906003            MOV     DPTR,#06003H
010B E0                MOVX    A,@DPTR
010C FF                MOV     R7,A
010D EF                MOV     A,R7
010E 6403              XRL     A,#03H
0110 6003              JZ      $ + 5H
0112 020000      R     LJMP    ?C0009
                                           ; SOURCE LINE # 131
                                           ; SOURCE LINE # 134
0115 900000      R     MOV     DPTR,#nStr
0118 E4                CLR     A
0119 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 135
011A 7BFF              MOV     R3,#0FFH
011C 7A00        E     MOV     R2,#HIGH USBFS_STRING_DESCRIPTORS
011E 7900        E     MOV     R1,#LOW USBFS_STRING_DESCRIPTORS
0120 900000      R     MOV     DPTR,#pStr
0123 120000      E     LCALL   ?C?PSTXDATA
0126         ?C0010:
                                           ; SOURCE LINE # 136
0126 900000      R     MOV     DPTR,#nStr
0129 E0                MOVX    A,@DPTR
012A FF                MOV     R7,A
012B 906002            MOV     DPTR,#06002H
012E E0                MOVX    A,@DPTR
012F FE                MOV     R6,A
0130 EE                MOV     A,R6
0131 D3                SETB    C
0132 9F                SUBB    A,R7
0133 403D              JC      ?C0011
0135 900000      R     MOV     DPTR,#pStr
0138 120000      E     LCALL   ?C?PLDXDATA
013B 120000      E     LCALL   ?C?CLDPTR
013E FF                MOV     R7,A
013F EF                MOV     A,R7
0140 6030              JZ      ?C0011
                                           ; SOURCE LINE # 137
                                           ; SOURCE LINE # 139
0142 900000      R     MOV     DPTR,#pStr
0145 120000      E     LCALL   ?C?PLDXDATA
0148 120000      E     LCALL   ?C?CLDPTR
014B FF                MOV     R7,A
014C 900000      R     MOV     DPTR,#descrLength
014F EF                MOV     A,R7
0150 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 141
0151 900000      R     MOV     DPTR,#pStr
0154 120000      E     LCALL   ?C?PLDXDATA
0157 900000      R     MOV     DPTR,#descrLength
015A E0                MOVX    A,@DPTR
015B FF                MOV     R7,A
015C 7E00              MOV     R6,#00H
015E E9                MOV     A,R1
015F 2F                ADD     A,R7
0160 F9                MOV     R1,A
0161 EA                MOV     A,R2
0162 3E                ADDC    A,R6
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 25  

0163 FA                MOV     R2,A
0164 900000      R     MOV     DPTR,#pStr
0167 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 142
016A 900000      R     MOV     DPTR,#nStr
016D E0                MOVX    A,@DPTR
016E 04                INC     A
016F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 143
0170 80B4              SJMP    ?C0010
0172         ?C0011:
                                           ; SOURCE LINE # 177
0172 900000      R     MOV     DPTR,#pStr
0175 120000      E     LCALL   ?C?PLDXDATA
0178 120000      E     LCALL   ?C?CLDPTR
017B FF                MOV     R7,A
017C EF                MOV     A,R7
017D 7003              JNZ     $ + 5H
017F 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 178
                                           ; SOURCE LINE # 179
0182 900000      R     MOV     DPTR,#pStr
0185 120000      E     LCALL   ?C?PLDXDATA
0188 120000      E     LCALL   ?C?CLDPTR
018B FF                MOV     R7,A
018C 7E00              MOV     R6,#00H
018E 900000      E     MOV     DPTR,#USBFS_currentTD
0191 EE                MOV     A,R6
0192 F0                MOVX    @DPTR,A
0193 A3                INC     DPTR
0194 EF                MOV     A,R7
0195 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 180
0196 900000      R     MOV     DPTR,#pStr
0199 120000      E     LCALL   ?C?PLDXDATA
019C 900000      E     MOV     DPTR,#USBFS_currentTD+02H
019F 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 181
01A2 120000      E     LCALL   USBFS_InitControlRead
01A5 900000      R     MOV     DPTR,#requestHandled
01A8 EF                MOV     A,R7
01A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 182
                                           ; SOURCE LINE # 183
01AA 020000      R     LJMP    ?C0022
01AD         ?C0009:
                                           ; SOURCE LINE # 186
                                           ; SOURCE LINE # 187
01AD 120000      E     LCALL   USBFS_DispatchClassRqst
01B0 900000      R     MOV     DPTR,#requestHandled
01B3 EF                MOV     A,R7
01B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 188
                                           ; SOURCE LINE # 189
01B5 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 190
01B8         ?C0014:
                                           ; SOURCE LINE # 191
01B8 906000            MOV     DPTR,#06000H
01BB E0                MOVX    A,@DPTR
01BC FF                MOV     R7,A
01BD EF                MOV     A,R7
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 26  

01BE 5403              ANL     A,#03H
01C0 FF                MOV     R7,A
01C1 EF                MOV     A,R7
01C2 120000      E     LCALL   ?C?CCASE
01C5 0000        R     DW      ?C0017
01C7 00                DB      00H
01C8 0000        R     DW      ?C0016
01CA 02                DB      02H
01CB 0000              DW      00H
01CD 0000        R     DW      ?C0022
                                           ; SOURCE LINE # 192
                                           ; SOURCE LINE # 193
01CF         ?C0016:
                                           ; SOURCE LINE # 194
01CF 900000      E     MOV     DPTR,#USBFS_currentTD
01D2 E4                CLR     A
01D3 F0                MOVX    @DPTR,A
01D4 A3                INC     DPTR
01D5 7402              MOV     A,#02H
01D7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 195
01D8 906004            MOV     DPTR,#06004H
01DB E0                MOVX    A,@DPTR
01DC FF                MOV     R7,A
01DD EF                MOV     A,R7
01DE 547F              ANL     A,#07FH
01E0 FF                MOV     R7,A
01E1 EF                MOV     A,R7
01E2 75F00B            MOV     B,#0BH
01E5 A4                MUL     AB
01E6 2400        E     ADD     A,#LOW USBFS_EP+02H
01E8 F582              MOV     DPL,A
01EA E4                CLR     A
01EB 3400        E     ADDC    A,#HIGH USBFS_EP+02H
01ED F583              MOV     DPH,A
01EF E0                MOVX    A,@DPTR
01F0 FF                MOV     R7,A
01F1 900000      R     MOV     DPTR,#USBFS_tBuffer
01F4 EF                MOV     A,R7
01F5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 197
01F6 900000      R     MOV     DPTR,#USBFS_tBuffer+01H
01F9 E4                CLR     A
01FA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 198
01FB 7B01              MOV     R3,#01H
01FD 7A00        R     MOV     R2,#HIGH USBFS_tBuffer
01FF 7900        R     MOV     R1,#LOW USBFS_tBuffer
0201 900000      E     MOV     DPTR,#USBFS_currentTD+02H
0204 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 199
0207 120000      E     LCALL   USBFS_InitControlRead
020A 900000      R     MOV     DPTR,#requestHandled
020D EF                MOV     A,R7
020E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 200
020F 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 201
0212         ?C0017:
                                           ; SOURCE LINE # 202
0212 900000      E     MOV     DPTR,#USBFS_currentTD
0215 E4                CLR     A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 27  

0216 F0                MOVX    @DPTR,A
0217 A3                INC     DPTR
0218 7402              MOV     A,#02H
021A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 203
021B 900000      E     MOV     DPTR,#USBFS_deviceStatus
021E E0                MOVX    A,@DPTR
021F FF                MOV     R7,A
0220 900000      R     MOV     DPTR,#USBFS_tBuffer
0223 EF                MOV     A,R7
0224 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 204
0225 900000      R     MOV     DPTR,#USBFS_tBuffer+01H
0228 E4                CLR     A
0229 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 205
022A 7B01              MOV     R3,#01H
022C 7A00        R     MOV     R2,#HIGH USBFS_tBuffer
022E 7900        R     MOV     R1,#LOW USBFS_tBuffer
0230 900000      E     MOV     DPTR,#USBFS_currentTD+02H
0233 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 206
0236 120000      E     LCALL   USBFS_InitControlRead
0239 900000      R     MOV     DPTR,#requestHandled
023C EF                MOV     A,R7
023D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 207
023E 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 208
                                           ; SOURCE LINE # 209
                                           ; SOURCE LINE # 210
                                           ; SOURCE LINE # 211
0241 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 212
0244         ?C0019:
                                           ; SOURCE LINE # 213
0244 900000      E     MOV     DPTR,#USBFS_currentTD
0247 E4                CLR     A
0248 F0                MOVX    @DPTR,A
0249 A3                INC     DPTR
024A 7401              MOV     A,#01H
024C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 214
024D 7B01              MOV     R3,#01H
024F 7A00        E     MOV     R2,#HIGH USBFS_configuration
0251 7900        E     MOV     R1,#LOW USBFS_configuration
0253 900000      E     MOV     DPTR,#USBFS_currentTD+02H
0256 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 215
0259 120000      E     LCALL   USBFS_InitControlRead
025C 900000      R     MOV     DPTR,#requestHandled
025F EF                MOV     A,R7
0260 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 216
0261 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 217
0264         ?C0020:
                                           ; SOURCE LINE # 218
0264 900000      E     MOV     DPTR,#USBFS_currentTD
0267 E4                CLR     A
0268 F0                MOVX    @DPTR,A
0269 A3                INC     DPTR
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 28  

026A 7401              MOV     A,#01H
026C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 219
026D 906004            MOV     DPTR,#06004H
0270 E0                MOVX    A,@DPTR
0271 FF                MOV     R7,A
0272 7400        E     MOV     A,#LOW USBFS_interfaceSetting
0274 2F                ADD     A,R7
0275 F9                MOV     R1,A
0276 E4                CLR     A
0277 3400        E     ADDC    A,#HIGH USBFS_interfaceSetting
0279 FA                MOV     R2,A
027A 7B01              MOV     R3,#01H
027C 900000      E     MOV     DPTR,#USBFS_currentTD+02H
027F 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 221
0282 120000      E     LCALL   USBFS_InitControlRead
0285 900000      R     MOV     DPTR,#requestHandled
0288 EF                MOV     A,R7
0289 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 222
028A 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 223
                                           ; SOURCE LINE # 224
                                           ; SOURCE LINE # 225
                                           ; SOURCE LINE # 226
028D 020000      R     LJMP    ?C0022
0290         ?C0001:
                                           ; SOURCE LINE # 227
                                           ; SOURCE LINE # 229
0290 906001            MOV     DPTR,#06001H
0293 E0                MOVX    A,@DPTR
0294 FF                MOV     R7,A
0295 EF                MOV     A,R7
0296 120000      E     LCALL   ?C?CCASE
0299 0000        R     DW      ?C0033
029B 01                DB      01H
029C 0000        R     DW      ?C0042
029E 03                DB      03H
029F 0000        R     DW      ?C0024
02A1 05                DB      05H
02A2 0000        R     DW      ?C0025
02A4 09                DB      09H
02A5 0000        R     DW      ?C0031
02A7 0B                DB      0BH
02A8 0000              DW      00H
02AA 0000        R     DW      ?C0022
                                           ; SOURCE LINE # 230
                                           ; SOURCE LINE # 231
02AC         ?C0024:
                                           ; SOURCE LINE # 232
02AC 906002            MOV     DPTR,#06002H
02AF E0                MOVX    A,@DPTR
02B0 FF                MOV     R7,A
02B1 900000      E     MOV     DPTR,#USBFS_deviceAddress
02B4 EF                MOV     A,R7
02B5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 233
02B6 120000      E     LCALL   USBFS_InitNoDataControlTransfer
02B9 900000      R     MOV     DPTR,#requestHandled
02BC EF                MOV     A,R7
02BD F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 29  

                                           ; SOURCE LINE # 234
02BE 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 235
02C1         ?C0025:
                                           ; SOURCE LINE # 236
02C1 906002            MOV     DPTR,#06002H
02C4 E0                MOVX    A,@DPTR
02C5 FF                MOV     R7,A
02C6 900000      R     MOV     DPTR,#configurationN
02C9 EF                MOV     A,R7
02CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 237
02CB 900000      R     MOV     DPTR,#configurationN
02CE E0                MOVX    A,@DPTR
02CF FF                MOV     R7,A
02D0 EF                MOV     A,R7
02D1 D3                SETB    C
02D2 9400              SUBB    A,#00H
02D4 4013              JC      ?C0026
                                           ; SOURCE LINE # 238
                                           ; SOURCE LINE # 239
02D6 900000      R     MOV     DPTR,#configurationN
02D9 E0                MOVX    A,@DPTR
02DA FF                MOV     R7,A
02DB EF                MOV     A,R7
02DC 14                DEC     A
02DD FF                MOV     R7,A
02DE 120000      R     LCALL   _USBFS_GetConfigTablePtr
02E1 900000      R     MOV     DPTR,#pTmp
02E4 EE                MOV     A,R6
02E5 F0                MOVX    @DPTR,A
02E6 A3                INC     DPTR
02E7 EF                MOV     A,R7
02E8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 240
02E9         ?C0026:
                                           ; SOURCE LINE # 242
02E9 900000      R     MOV     DPTR,#configurationN
02EC E0                MOVX    A,@DPTR
02ED FF                MOV     R7,A
02EE EF                MOV     A,R7
02EF D3                SETB    C
02F0 9400              SUBB    A,#00H
02F2 400C              JC      ?C0029
02F4 900000      R     MOV     DPTR,#pTmp
02F7 E0                MOVX    A,@DPTR
02F8 FE                MOV     R6,A
02F9 A3                INC     DPTR
02FA E0                MOVX    A,@DPTR
02FB FF                MOV     R7,A
02FC EF                MOV     A,R7
02FD 4E                ORL     A,R6
02FE 700B              JNZ     ?C0028
0300         ?C0029:
0300 900000      R     MOV     DPTR,#configurationN
0303 E0                MOVX    A,@DPTR
0304 FF                MOV     R7,A
0305 EF                MOV     A,R7
0306 6003              JZ      $ + 5H
0308 020000      R     LJMP    ?C0022
030B         ?C0028:
                                           ; SOURCE LINE # 243
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 30  

                                           ; SOURCE LINE # 245
030B 900000      E     MOV     DPTR,#USBFS_configuration
030E E0                MOVX    A,@DPTR
030F FF                MOV     R7,A
0310 900000      R     MOV     DPTR,#configurationN
0313 E0                MOVX    A,@DPTR
0314 FE                MOV     R6,A
0315 EE                MOV     A,R6
0316 6F                XRL     A,R7
0317 6015              JZ      ?C0030
                                           ; SOURCE LINE # 246
                                           ; SOURCE LINE # 247
0319 900000      R     MOV     DPTR,#configurationN
031C E0                MOVX    A,@DPTR
031D FF                MOV     R7,A
031E 900000      E     MOV     DPTR,#USBFS_configuration
0321 EF                MOV     A,R7
0322 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 248
0323 900000      E     MOV     DPTR,#USBFS_configurationChanged
0326 7401              MOV     A,#01H
0328 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 249
0329 7F01              MOV     R7,#01H
032B 120000      R     LCALL   _USBFS_Config
                                           ; SOURCE LINE # 250
032E         ?C0030:
                                           ; SOURCE LINE # 251
032E 120000      E     LCALL   USBFS_InitNoDataControlTransfer
0331 900000      R     MOV     DPTR,#requestHandled
0334 EF                MOV     A,R7
0335 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 252
                                           ; SOURCE LINE # 253
0336 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 254
0339         ?C0031:
                                           ; SOURCE LINE # 255
0339 120000      R     LCALL   USBFS_ValidateAlternateSetting
033C EF                MOV     A,R7
033D 7003              JNZ     $ + 5H
033F 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 256
                                           ; SOURCE LINE # 257
0342 906004            MOV     DPTR,#06004H
0345 E0                MOVX    A,@DPTR
0346 FF                MOV     R7,A
0347 900000      R     MOV     DPTR,#interfaceNumber
034A EF                MOV     A,R7
034B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 258
034C 900000      R     MOV     DPTR,#interfaceNumber
034F E0                MOVX    A,@DPTR
0350 FF                MOV     R7,A
0351 900000      E     MOV     DPTR,#USBFS_interfaceNumber
0354 EF                MOV     A,R7
0355 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 259
0356 900000      E     MOV     DPTR,#USBFS_configurationChanged
0359 7401              MOV     A,#01H
035B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 264
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 31  

035C 120000      R     LCALL   USBFS_ConfigAltChanged
                                           ; SOURCE LINE # 267
035F 900000      R     MOV     DPTR,#interfaceNumber
0362 E0                MOVX    A,@DPTR
0363 FF                MOV     R7,A
0364 7400        E     MOV     A,#LOW USBFS_interfaceSetting
0366 2F                ADD     A,R7
0367 F582              MOV     DPL,A
0369 E4                CLR     A
036A 3400        E     ADDC    A,#HIGH USBFS_interfaceSetting
036C F583              MOV     DPH,A
036E E0                MOVX    A,@DPTR
036F FF                MOV     R7,A
0370 900000      R     MOV     DPTR,#interfaceNumber
0373 E0                MOVX    A,@DPTR
0374 FE                MOV     R6,A
0375 7400        E     MOV     A,#LOW USBFS_interfaceSetting_last
0377 2E                ADD     A,R6
0378 F582              MOV     DPL,A
037A E4                CLR     A
037B 3400        E     ADDC    A,#HIGH USBFS_interfaceSetting_last
037D F583              MOV     DPH,A
037F EF                MOV     A,R7
0380 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 269
0381 120000      E     LCALL   USBFS_InitNoDataControlTransfer
0384 900000      R     MOV     DPTR,#requestHandled
0387 EF                MOV     A,R7
0388 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 270
                                           ; SOURCE LINE # 271
0389 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 272
038C         ?C0033:
                                           ; SOURCE LINE # 273
038C 906000            MOV     DPTR,#06000H
038F E0                MOVX    A,@DPTR
0390 FF                MOV     R7,A
0391 EF                MOV     A,R7
0392 5403              ANL     A,#03H
0394 FF                MOV     R7,A
0395 EF                MOV     A,R7
0396 120000      E     LCALL   ?C?CCASE
0399 0000        R     DW      ?C0037
039B 00                DB      00H
039C 0000        R     DW      ?C0039
039E 01                DB      01H
039F 0000        R     DW      ?C0035
03A1 02                DB      02H
03A2 0000              DW      00H
03A4 0000        R     DW      ?C0022
                                           ; SOURCE LINE # 274
                                           ; SOURCE LINE # 275
03A6         ?C0035:
                                           ; SOURCE LINE # 276
03A6 906002            MOV     DPTR,#06002H
03A9 E0                MOVX    A,@DPTR
03AA FF                MOV     R7,A
03AB EF                MOV     A,R7
03AC 6003              JZ      $ + 5H
03AE 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 277
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 32  

                                           ; SOURCE LINE # 278
03B1 120000      R     LCALL   USBFS_ClearEndpointHalt
03B4 900000      R     MOV     DPTR,#requestHandled
03B7 EF                MOV     A,R7
03B8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 279
                                           ; SOURCE LINE # 280
03B9 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 281
03BC         ?C0037:
                                           ; SOURCE LINE # 283
03BC 906002            MOV     DPTR,#06002H
03BF E0                MOVX    A,@DPTR
03C0 FF                MOV     R7,A
03C1 EF                MOV     A,R7
03C2 6401              XRL     A,#01H
03C4 6003              JZ      $ + 5H
03C6 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 284
                                           ; SOURCE LINE # 285
03C9 900000      E     MOV     DPTR,#USBFS_deviceStatus
03CC E0                MOVX    A,@DPTR
03CD FF                MOV     R7,A
03CE EF                MOV     A,R7
03CF 54FD              ANL     A,#0FDH
03D1 FF                MOV     R7,A
03D2 900000      E     MOV     DPTR,#USBFS_deviceStatus
03D5 EF                MOV     A,R7
03D6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 286
03D7 120000      E     LCALL   USBFS_InitNoDataControlTransfer
03DA 900000      R     MOV     DPTR,#requestHandled
03DD EF                MOV     A,R7
03DE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 287
                                           ; SOURCE LINE # 288
03DF 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 289
03E2         ?C0039:
                                           ; SOURCE LINE # 291
03E2 906004            MOV     DPTR,#06004H
03E5 E0                MOVX    A,@DPTR
03E6 FF                MOV     R7,A
03E7 EF                MOV     A,R7
03E8 C3                CLR     C
03E9 9402              SUBB    A,#02H
03EB 4003              JC      $ + 5H
03ED 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 292
                                           ; SOURCE LINE # 294
03F0 906004            MOV     DPTR,#06004H
03F3 E0                MOVX    A,@DPTR
03F4 FF                MOV     R7,A
03F5 7400        E     MOV     A,#LOW USBFS_interfaceStatus
03F7 2F                ADD     A,R7
03F8 F582              MOV     DPL,A
03FA E4                CLR     A
03FB 3400        E     ADDC    A,#HIGH USBFS_interfaceStatus
03FD F583              MOV     DPH,A
03FF C083              PUSH    DPH
0401 C082              PUSH    DPL
0403 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 33  

0404 FF                MOV     R7,A
0405 906002            MOV     DPTR,#06002H
0408 E0                MOVX    A,@DPTR
0409 FE                MOV     R6,A
040A EE                MOV     A,R6
040B F4                CPL     A
040C FE                MOV     R6,A
040D EF                MOV     A,R7
040E 5E                ANL     A,R6
040F FF                MOV     R7,A
0410 D082              POP     DPL
0412 D083              POP     DPH
0414 EF                MOV     A,R7
0415 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 295
0416 120000      E     LCALL   USBFS_InitNoDataControlTransfer
0419 900000      R     MOV     DPTR,#requestHandled
041C EF                MOV     A,R7
041D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 296
                                           ; SOURCE LINE # 297
041E 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 298
                                           ; SOURCE LINE # 299
                                           ; SOURCE LINE # 300
                                           ; SOURCE LINE # 301
0421 020000      R     LJMP    ?C0022
                                           ; SOURCE LINE # 302
0424         ?C0042:
                                           ; SOURCE LINE # 303
0424 906000            MOV     DPTR,#06000H
0427 E0                MOVX    A,@DPTR
0428 FF                MOV     R7,A
0429 EF                MOV     A,R7
042A 5403              ANL     A,#03H
042C FF                MOV     R7,A
042D EF                MOV     A,R7
042E 120000      E     LCALL   ?C?CCASE
0431 0000        R     DW      ?C0046
0433 00                DB      00H
0434 0000        R     DW      ?C0048
0436 01                DB      01H
0437 0000        R     DW      ?C0044
0439 02                DB      02H
043A 0000              DW      00H
043C 0000        R     DW      ?C0022
                                           ; SOURCE LINE # 304
                                           ; SOURCE LINE # 305
043E         ?C0044:
                                           ; SOURCE LINE # 306
043E 906002            MOV     DPTR,#06002H
0441 E0                MOVX    A,@DPTR
0442 FF                MOV     R7,A
0443 EF                MOV     A,R7
0444 7065              JNZ     ?C0022
                                           ; SOURCE LINE # 307
                                           ; SOURCE LINE # 308
0446 120000      R     LCALL   USBFS_SetEndpointHalt
0449 900000      R     MOV     DPTR,#requestHandled
044C EF                MOV     A,R7
044D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 309
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 34  

                                           ; SOURCE LINE # 310
044E 805B              SJMP    ?C0022
                                           ; SOURCE LINE # 311
0450         ?C0046:
                                           ; SOURCE LINE # 313
0450 906002            MOV     DPTR,#06002H
0453 E0                MOVX    A,@DPTR
0454 FF                MOV     R7,A
0455 EF                MOV     A,R7
0456 6401              XRL     A,#01H
0458 7051              JNZ     ?C0022
                                           ; SOURCE LINE # 314
                                           ; SOURCE LINE # 315
045A 900000      E     MOV     DPTR,#USBFS_deviceStatus
045D E0                MOVX    A,@DPTR
045E FF                MOV     R7,A
045F EF                MOV     A,R7
0460 4402              ORL     A,#02H
0462 FF                MOV     R7,A
0463 900000      E     MOV     DPTR,#USBFS_deviceStatus
0466 EF                MOV     A,R7
0467 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 316
0468 120000      E     LCALL   USBFS_InitNoDataControlTransfer
046B 900000      R     MOV     DPTR,#requestHandled
046E EF                MOV     A,R7
046F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 317
                                           ; SOURCE LINE # 318
0470 8039              SJMP    ?C0022
                                           ; SOURCE LINE # 319
0472         ?C0048:
                                           ; SOURCE LINE # 321
0472 906004            MOV     DPTR,#06004H
0475 E0                MOVX    A,@DPTR
0476 FF                MOV     R7,A
0477 EF                MOV     A,R7
0478 C3                CLR     C
0479 9402              SUBB    A,#02H
047B 502E              JNC     ?C0022
                                           ; SOURCE LINE # 322
                                           ; SOURCE LINE # 324
047D 906004            MOV     DPTR,#06004H
0480 E0                MOVX    A,@DPTR
0481 FF                MOV     R7,A
0482 7400        E     MOV     A,#LOW USBFS_interfaceStatus
0484 2F                ADD     A,R7
0485 F582              MOV     DPL,A
0487 E4                CLR     A
0488 3400        E     ADDC    A,#HIGH USBFS_interfaceStatus
048A F583              MOV     DPH,A
048C C083              PUSH    DPH
048E C082              PUSH    DPL
0490 E0                MOVX    A,@DPTR
0491 FF                MOV     R7,A
0492 906002            MOV     DPTR,#06002H
0495 E0                MOVX    A,@DPTR
0496 FE                MOV     R6,A
0497 EE                MOV     A,R6
0498 F4                CPL     A
0499 FE                MOV     R6,A
049A EF                MOV     A,R7
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 35  

049B 5E                ANL     A,R6
049C FF                MOV     R7,A
049D D082              POP     DPL
049F D083              POP     DPH
04A1 EF                MOV     A,R7
04A2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 325
04A3 120000      E     LCALL   USBFS_InitNoDataControlTransfer
04A6 900000      R     MOV     DPTR,#requestHandled
04A9 EF                MOV     A,R7
04AA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 326
                                           ; SOURCE LINE # 327
                                           ; SOURCE LINE # 328
                                           ; SOURCE LINE # 329
                                           ; SOURCE LINE # 330
                                           ; SOURCE LINE # 331
                                           ; SOURCE LINE # 332
                                           ; SOURCE LINE # 333
                                           ; SOURCE LINE # 334
                                           ; SOURCE LINE # 335
04AB         ?C0022:
                                           ; SOURCE LINE # 336
04AB 900000      R     MOV     DPTR,#requestHandled
04AE E0                MOVX    A,@DPTR
04AF FF                MOV     R7,A
                                           ; SOURCE LINE # 337
04B0         ?C0052:
04B0 22                RET     
             ; FUNCTION USBFS_HandleStandardRqst (END)

             ; FUNCTION USBFS_ConfigReg (BEGIN)
                                           ; SOURCE LINE # 402
                                           ; SOURCE LINE # 403
                                           ; SOURCE LINE # 411
0000 900000      R     MOV     DPTR,#ep
0003 7401              MOV     A,#01H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 412
0006 900000      R     MOV     DPTR,#i
0009 E4                CLR     A
000A F0                MOVX    @DPTR,A
000B         ?C0053:
000B 900000      R     MOV     DPTR,#i
000E E0                MOVX    A,@DPTR
000F FF                MOV     R7,A
0010 EF                MOV     A,R7
0011 C3                CLR     C
0012 9480              SUBB    A,#080H
0014 4003              JC      $ + 5H
0016 020000      R     LJMP    ?C0054
                                           ; SOURCE LINE # 413
                                           ; SOURCE LINE # 414
0019 900000      R     MOV     DPTR,#i
001C E0                MOVX    A,@DPTR
001D FF                MOV     R7,A
001E 7E00              MOV     R6,#00H
0020 EF                MOV     A,R7
0021 2480              ADD     A,#080H
0023 FF                MOV     R7,A
0024 EE                MOV     A,R6
0025 3460              ADDC    A,#060H
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 36  

0027 FE                MOV     R6,A
0028 8F82              MOV     DPL,R7
002A 8E83              MOV     DPH,R6
002C 740C              MOV     A,#0CH
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 417
002F 900000      R     MOV     DPTR,#i
0032 E0                MOVX    A,@DPTR
0033 FF                MOV     R7,A
0034 7E00              MOV     R6,#00H
0036 EF                MOV     A,R7
0037 2481              ADD     A,#081H
0039 FF                MOV     R7,A
003A EE                MOV     A,R6
003B 3460              ADDC    A,#060H
003D FE                MOV     R6,A
003E 8F82              MOV     DPL,R7
0040 8E83              MOV     DPH,R6
0042 741F              MOV     A,#01FH
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 420
0045 900000      R     MOV     DPTR,#ep
0048 E0                MOVX    A,@DPTR
0049 FF                MOV     R7,A
004A EF                MOV     A,R7
004B 75F00B            MOV     B,#0BH
004E A4                MUL     AB
004F 2400        E     ADD     A,#LOW USBFS_EP+05H
0051 F582              MOV     DPL,A
0053 E4                CLR     A
0054 3400        E     ADDC    A,#HIGH USBFS_EP+05H
0056 F583              MOV     DPH,A
0058 E0                MOVX    A,@DPTR
0059 FF                MOV     R7,A
005A EF                MOV     A,R7
005B 604F              JZ      ?C0056
                                           ; SOURCE LINE # 421
                                           ; SOURCE LINE # 422
005D 900000      R     MOV     DPTR,#ep
0060 E0                MOVX    A,@DPTR
0061 FF                MOV     R7,A
0062 EF                MOV     A,R7
0063 75F00B            MOV     B,#0BH
0066 A4                MUL     AB
0067 2400        E     ADD     A,#LOW USBFS_EP+04H
0069 F582              MOV     DPL,A
006B E4                CLR     A
006C 3400        E     ADDC    A,#HIGH USBFS_EP+04H
006E F583              MOV     DPH,A
0070 E0                MOVX    A,@DPTR
0071 FF                MOV     R7,A
0072 EF                MOV     A,R7
0073 5480              ANL     A,#080H
0075 FF                MOV     R7,A
0076 7E00              MOV     R6,#00H
0078 EF                MOV     A,R7
0079 4E                ORL     A,R6
007A 6018              JZ      ?C0057
                                           ; SOURCE LINE # 423
                                           ; SOURCE LINE # 424
007C 900000      R     MOV     DPTR,#i
007F E0                MOVX    A,@DPTR
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 37  

0080 FF                MOV     R7,A
0081 7E00              MOV     R6,#00H
0083 EF                MOV     A,R7
0084 240E              ADD     A,#0EH
0086 FF                MOV     R7,A
0087 EE                MOV     A,R6
0088 3460              ADDC    A,#060H
008A FE                MOV     R6,A
008B 8F82              MOV     DPL,R7
008D 8E83              MOV     DPH,R6
008F 740C              MOV     A,#0CH
0091 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 425
0092 802E              SJMP    ?C0059
0094         ?C0057:
                                           ; SOURCE LINE # 427
                                           ; SOURCE LINE # 428
0094 900000      R     MOV     DPTR,#i
0097 E0                MOVX    A,@DPTR
0098 FF                MOV     R7,A
0099 7E00              MOV     R6,#00H
009B EF                MOV     A,R7
009C 240E              ADD     A,#0EH
009E FF                MOV     R7,A
009F EE                MOV     A,R6
00A0 3460              ADDC    A,#060H
00A2 FE                MOV     R6,A
00A3 8F82              MOV     DPL,R7
00A5 8E83              MOV     DPH,R6
00A7 7408              MOV     A,#08H
00A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 433
                                           ; SOURCE LINE # 434
00AA 8016              SJMP    ?C0059
00AC         ?C0056:
                                           ; SOURCE LINE # 436
                                           ; SOURCE LINE # 437
00AC 900000      R     MOV     DPTR,#i
00AF E0                MOVX    A,@DPTR
00B0 FF                MOV     R7,A
00B1 7E00              MOV     R6,#00H
00B3 EF                MOV     A,R7
00B4 240E              ADD     A,#0EH
00B6 FF                MOV     R7,A
00B7 EE                MOV     A,R6
00B8 3460              ADDC    A,#060H
00BA FE                MOV     R6,A
00BB 8F82              MOV     DPL,R7
00BD 8E83              MOV     DPH,R6
00BF 7480              MOV     A,#080H
00C1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 438
00C2         ?C0059:
                                           ; SOURCE LINE # 441
00C2 900000      R     MOV     DPTR,#ep
00C5 E0                MOVX    A,@DPTR
00C6 FF                MOV     R7,A
00C7 EF                MOV     A,R7
00C8 75F00B            MOV     B,#0BH
00CB A4                MUL     AB
00CC 2400        E     ADD     A,#LOW USBFS_EP+08H
00CE F582              MOV     DPL,A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 38  

00D0 E4                CLR     A
00D1 3400        E     ADDC    A,#HIGH USBFS_EP+08H
00D3 F583              MOV     DPH,A
00D5 E0                MOVX    A,@DPTR
00D6 FE                MOV     R6,A
00D7 A3                INC     DPTR
00D8 E0                MOVX    A,@DPTR
00D9 FF                MOV     R7,A
00DA EE                MOV     A,R6
00DB FF                MOV     R7,A
00DC 7E00              MOV     R6,#00H
00DE 900000      R     MOV     DPTR,#i
00E1 E0                MOVX    A,@DPTR
00E2 FE                MOV     R6,A
00E3 EE                MOV     A,R6
00E4 FD                MOV     R5,A
00E5 7C00              MOV     R4,#00H
00E7 ED                MOV     A,R5
00E8 240C              ADD     A,#0CH
00EA FD                MOV     R5,A
00EB EC                MOV     A,R4
00EC 3460              ADDC    A,#060H
00EE FC                MOV     R4,A
00EF 8D82              MOV     DPL,R5
00F1 8C83              MOV     DPH,R4
00F3 EF                MOV     A,R7
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 442
00F5 900000      R     MOV     DPTR,#ep
00F8 E0                MOVX    A,@DPTR
00F9 FF                MOV     R7,A
00FA EF                MOV     A,R7
00FB 75F00B            MOV     B,#0BH
00FE A4                MUL     AB
00FF 2400        E     ADD     A,#LOW USBFS_EP+08H
0101 F582              MOV     DPL,A
0103 E4                CLR     A
0104 3400        E     ADDC    A,#HIGH USBFS_EP+08H
0106 F583              MOV     DPH,A
0108 E0                MOVX    A,@DPTR
0109 FE                MOV     R6,A
010A A3                INC     DPTR
010B E0                MOVX    A,@DPTR
010C FF                MOV     R7,A
010D EF                MOV     A,R7
010E 54FF              ANL     A,#0FFH
0110 FF                MOV     R7,A
0111 900000      R     MOV     DPTR,#i
0114 E0                MOVX    A,@DPTR
0115 FE                MOV     R6,A
0116 EE                MOV     A,R6
0117 FD                MOV     R5,A
0118 7C00              MOV     R4,#00H
011A ED                MOV     A,R5
011B 240D              ADD     A,#0DH
011D FD                MOV     R5,A
011E EC                MOV     A,R4
011F 3460              ADDC    A,#060H
0121 FC                MOV     R4,A
0122 8D82              MOV     DPL,R5
0124 8C83              MOV     DPH,R4
0126 EF                MOV     A,R7
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 39  

0127 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 444
0128 900000      R     MOV     DPTR,#ep
012B E0                MOVX    A,@DPTR
012C FF                MOV     R7,A
012D EF                MOV     A,R7
012E 75F00B            MOV     B,#0BH
0131 A4                MUL     AB
0132 2400        E     ADD     A,#LOW USBFS_EP+06H
0134 F582              MOV     DPL,A
0136 E4                CLR     A
0137 3400        E     ADDC    A,#HIGH USBFS_EP+06H
0139 F583              MOV     DPH,A
013B E0                MOVX    A,@DPTR
013C FE                MOV     R6,A
013D A3                INC     DPTR
013E E0                MOVX    A,@DPTR
013F FF                MOV     R7,A
0140 EF                MOV     A,R7
0141 54FF              ANL     A,#0FFH
0143 FF                MOV     R7,A
0144 900000      R     MOV     DPTR,#i
0147 E0                MOVX    A,@DPTR
0148 FE                MOV     R6,A
0149 EE                MOV     A,R6
014A FD                MOV     R5,A
014B 7C00              MOV     R4,#00H
014D ED                MOV     A,R5
014E 2486              ADD     A,#086H
0150 FD                MOV     R5,A
0151 EC                MOV     A,R4
0152 3460              ADDC    A,#060H
0154 FC                MOV     R4,A
0155 8D82              MOV     DPL,R5
0157 8C83              MOV     DPH,R4
0159 EF                MOV     A,R7
015A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 445
015B 900000      R     MOV     DPTR,#ep
015E E0                MOVX    A,@DPTR
015F FF                MOV     R7,A
0160 EF                MOV     A,R7
0161 75F00B            MOV     B,#0BH
0164 A4                MUL     AB
0165 2400        E     ADD     A,#LOW USBFS_EP+06H
0167 F582              MOV     DPL,A
0169 E4                CLR     A
016A 3400        E     ADDC    A,#HIGH USBFS_EP+06H
016C F583              MOV     DPH,A
016E E0                MOVX    A,@DPTR
016F FE                MOV     R6,A
0170 A3                INC     DPTR
0171 E0                MOVX    A,@DPTR
0172 FF                MOV     R7,A
0173 EE                MOV     A,R6
0174 FF                MOV     R7,A
0175 7E00              MOV     R6,#00H
0177 900000      R     MOV     DPTR,#i
017A E0                MOVX    A,@DPTR
017B FE                MOV     R6,A
017C EE                MOV     A,R6
017D FD                MOV     R5,A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 40  

017E 7C00              MOV     R4,#00H
0180 ED                MOV     A,R5
0181 2487              ADD     A,#087H
0183 FD                MOV     R5,A
0184 EC                MOV     A,R4
0185 3460              ADDC    A,#060H
0187 FC                MOV     R4,A
0188 8D82              MOV     DPL,R5
018A 8C83              MOV     DPH,R4
018C EF                MOV     A,R7
018D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 446
018E 900000      R     MOV     DPTR,#ep
0191 E0                MOVX    A,@DPTR
0192 FF                MOV     R7,A
0193 EF                MOV     A,R7
0194 75F00B            MOV     B,#0BH
0197 A4                MUL     AB
0198 2400        E     ADD     A,#LOW USBFS_EP+06H
019A F582              MOV     DPL,A
019C E4                CLR     A
019D 3400        E     ADDC    A,#HIGH USBFS_EP+06H
019F F583              MOV     DPH,A
01A1 E0                MOVX    A,@DPTR
01A2 FE                MOV     R6,A
01A3 A3                INC     DPTR
01A4 E0                MOVX    A,@DPTR
01A5 FF                MOV     R7,A
01A6 EF                MOV     A,R7
01A7 54FF              ANL     A,#0FFH
01A9 FF                MOV     R7,A
01AA 900000      R     MOV     DPTR,#i
01AD E0                MOVX    A,@DPTR
01AE FE                MOV     R6,A
01AF EE                MOV     A,R6
01B0 FD                MOV     R5,A
01B1 7C00              MOV     R4,#00H
01B3 ED                MOV     A,R5
01B4 2484              ADD     A,#084H
01B6 FD                MOV     R5,A
01B7 EC                MOV     A,R4
01B8 3460              ADDC    A,#060H
01BA FC                MOV     R4,A
01BB 8D82              MOV     DPL,R5
01BD 8C83              MOV     DPH,R4
01BF EF                MOV     A,R7
01C0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 447
01C1 900000      R     MOV     DPTR,#ep
01C4 E0                MOVX    A,@DPTR
01C5 FF                MOV     R7,A
01C6 EF                MOV     A,R7
01C7 75F00B            MOV     B,#0BH
01CA A4                MUL     AB
01CB 2400        E     ADD     A,#LOW USBFS_EP+06H
01CD F582              MOV     DPL,A
01CF E4                CLR     A
01D0 3400        E     ADDC    A,#HIGH USBFS_EP+06H
01D2 F583              MOV     DPH,A
01D4 E0                MOVX    A,@DPTR
01D5 FE                MOV     R6,A
01D6 A3                INC     DPTR
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 41  

01D7 E0                MOVX    A,@DPTR
01D8 FF                MOV     R7,A
01D9 EE                MOV     A,R6
01DA FF                MOV     R7,A
01DB 7E00              MOV     R6,#00H
01DD 900000      R     MOV     DPTR,#i
01E0 E0                MOVX    A,@DPTR
01E1 FE                MOV     R6,A
01E2 EE                MOV     A,R6
01E3 FD                MOV     R5,A
01E4 7C00              MOV     R4,#00H
01E6 ED                MOV     A,R5
01E7 2485              ADD     A,#085H
01E9 FD                MOV     R5,A
01EA EC                MOV     A,R4
01EB 3460              ADDC    A,#060H
01ED FC                MOV     R4,A
01EE 8D82              MOV     DPL,R5
01F0 8C83              MOV     DPH,R4
01F2 EF                MOV     A,R7
01F3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 450
01F4 900000      R     MOV     DPTR,#ep
01F7 E0                MOVX    A,@DPTR
01F8 04                INC     A
01F9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 451
01FA 900000      R     MOV     DPTR,#i
01FD E0                MOVX    A,@DPTR
01FE 2410              ADD     A,#010H
0200 F0                MOVX    @DPTR,A
0201 020000      R     LJMP    ?C0053
0204         ?C0054:
                                           ; SOURCE LINE # 467
0204 90600A            MOV     DPTR,#0600AH
0207 74FF              MOV     A,#0FFH
0209 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 468
020A 22                RET     
             ; FUNCTION USBFS_ConfigReg (END)

             ; FUNCTION _USBFS_Config (BEGIN)
                                           ; SOURCE LINE # 493
0000 900000      R     MOV     DPTR,#clearAltSetting
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 494
                                           ; SOURCE LINE # 501
0005 900000      R     MOV     DPTR,#buffCount
0008 E4                CLR     A
0009 F0                MOVX    @DPTR,A
000A A3                INC     DPTR
000B E4                CLR     A
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 508
000D 900000      R     MOV     DPTR,#ep
0010 E4                CLR     A
0011 F0                MOVX    @DPTR,A
0012         ?C0061:
0012 900000      R     MOV     DPTR,#ep
0015 E0                MOVX    A,@DPTR
0016 FF                MOV     R7,A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 42  

0017 EF                MOV     A,R7
0018 C3                CLR     C
0019 9409              SUBB    A,#09H
001B 4003              JC      $ + 5H
001D 020000      R     LJMP    ?C0062
                                           ; SOURCE LINE # 509
                                           ; SOURCE LINE # 510
0020 900000      R     MOV     DPTR,#ep
0023 E0                MOVX    A,@DPTR
0024 FF                MOV     R7,A
0025 EF                MOV     A,R7
0026 75F00B            MOV     B,#0BH
0029 A4                MUL     AB
002A 2400        E     ADD     A,#LOW USBFS_EP
002C F582              MOV     DPL,A
002E E4                CLR     A
002F 3400        E     ADDC    A,#HIGH USBFS_EP
0031 F583              MOV     DPH,A
0033 E4                CLR     A
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 511
0035 900000      R     MOV     DPTR,#ep
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
003A EF                MOV     A,R7
003B 75F00B            MOV     B,#0BH
003E A4                MUL     AB
003F 2400        E     ADD     A,#LOW USBFS_EP+02H
0041 F582              MOV     DPL,A
0043 E4                CLR     A
0044 3400        E     ADDC    A,#HIGH USBFS_EP+02H
0046 F583              MOV     DPH,A
0048 E4                CLR     A
0049 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 512
004A 900000      R     MOV     DPTR,#ep
004D E0                MOVX    A,@DPTR
004E FF                MOV     R7,A
004F EF                MOV     A,R7
0050 75F00B            MOV     B,#0BH
0053 A4                MUL     AB
0054 2400        E     ADD     A,#LOW USBFS_EP+01H
0056 F582              MOV     DPL,A
0058 E4                CLR     A
0059 3400        E     ADDC    A,#HIGH USBFS_EP+01H
005B F583              MOV     DPH,A
005D E4                CLR     A
005E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 513
005F 900000      R     MOV     DPTR,#ep
0062 E0                MOVX    A,@DPTR
0063 FF                MOV     R7,A
0064 EF                MOV     A,R7
0065 75F00B            MOV     B,#0BH
0068 A4                MUL     AB
0069 2400        E     ADD     A,#LOW USBFS_EP+03H
006B F582              MOV     DPL,A
006D E4                CLR     A
006E 3400        E     ADDC    A,#HIGH USBFS_EP+03H
0070 F583              MOV     DPH,A
0072 E4                CLR     A
0073 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 43  

                                           ; SOURCE LINE # 514
0074 900000      R     MOV     DPTR,#ep
0077 E0                MOVX    A,@DPTR
0078 FF                MOV     R7,A
0079 EF                MOV     A,R7
007A 75F00B            MOV     B,#0BH
007D A4                MUL     AB
007E 2400        E     ADD     A,#LOW USBFS_EP+05H
0080 F582              MOV     DPL,A
0082 E4                CLR     A
0083 3400        E     ADDC    A,#HIGH USBFS_EP+05H
0085 F583              MOV     DPH,A
0087 E4                CLR     A
0088 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 515
0089 900000      R     MOV     DPTR,#ep
008C E0                MOVX    A,@DPTR
008D FF                MOV     R7,A
008E EF                MOV     A,R7
008F 75F00B            MOV     B,#0BH
0092 A4                MUL     AB
0093 2400        E     ADD     A,#LOW USBFS_EP+08H
0095 F582              MOV     DPL,A
0097 E4                CLR     A
0098 3400        E     ADDC    A,#HIGH USBFS_EP+08H
009A F583              MOV     DPH,A
009C E4                CLR     A
009D F0                MOVX    @DPTR,A
009E A3                INC     DPTR
009F E4                CLR     A
00A0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 516
00A1 900000      R     MOV     DPTR,#ep
00A4 E0                MOVX    A,@DPTR
00A5 FF                MOV     R7,A
00A6 EF                MOV     A,R7
00A7 75F00B            MOV     B,#0BH
00AA A4                MUL     AB
00AB 2400        E     ADD     A,#LOW USBFS_EP+0AH
00AD F582              MOV     DPL,A
00AF E4                CLR     A
00B0 3400        E     ADDC    A,#HIGH USBFS_EP+0AH
00B2 F583              MOV     DPH,A
00B4 E4                CLR     A
00B5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 518
00B6 900000      R     MOV     DPTR,#ep
00B9 E0                MOVX    A,@DPTR
00BA 04                INC     A
00BB F0                MOVX    @DPTR,A
00BC 020000      R     LJMP    ?C0061
00BF         ?C0062:
                                           ; SOURCE LINE # 521
00BF 900000      R     MOV     DPTR,#clearAltSetting
00C2 E0                MOVX    A,@DPTR
00C3 FF                MOV     R7,A
00C4 EF                MOV     A,R7
00C5 603A              JZ      ?C0064
                                           ; SOURCE LINE # 522
                                           ; SOURCE LINE # 523
00C7 900000      R     MOV     DPTR,#i
00CA E4                CLR     A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 44  

00CB F0                MOVX    @DPTR,A
00CC         ?C0065:
00CC 900000      R     MOV     DPTR,#i
00CF E0                MOVX    A,@DPTR
00D0 FF                MOV     R7,A
00D1 EF                MOV     A,R7
00D2 C3                CLR     C
00D3 9402              SUBB    A,#02H
00D5 502A              JNC     ?C0064
                                           ; SOURCE LINE # 524
                                           ; SOURCE LINE # 525
00D7 900000      R     MOV     DPTR,#i
00DA E0                MOVX    A,@DPTR
00DB FF                MOV     R7,A
00DC 7400        E     MOV     A,#LOW USBFS_interfaceSetting
00DE 2F                ADD     A,R7
00DF F582              MOV     DPL,A
00E1 E4                CLR     A
00E2 3400        E     ADDC    A,#HIGH USBFS_interfaceSetting
00E4 F583              MOV     DPH,A
00E6 E4                CLR     A
00E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 526
00E8 900000      R     MOV     DPTR,#i
00EB E0                MOVX    A,@DPTR
00EC FF                MOV     R7,A
00ED 7400        E     MOV     A,#LOW USBFS_interfaceSetting_last
00EF 2F                ADD     A,R7
00F0 F582              MOV     DPL,A
00F2 E4                CLR     A
00F3 3400        E     ADDC    A,#HIGH USBFS_interfaceSetting_last
00F5 F583              MOV     DPH,A
00F7 E4                CLR     A
00F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 527
00F9 900000      R     MOV     DPTR,#i
00FC E0                MOVX    A,@DPTR
00FD 04                INC     A
00FE F0                MOVX    @DPTR,A
00FF 80CB              SJMP    ?C0065
                                           ; SOURCE LINE # 528
0101         ?C0064:
                                           ; SOURCE LINE # 531
0101 900000      E     MOV     DPTR,#USBFS_configuration
0104 E0                MOVX    A,@DPTR
0105 FF                MOV     R7,A
0106 EF                MOV     A,R7
0107 D3                SETB    C
0108 9400              SUBB    A,#00H
010A 5003              JNC     $ + 5H
010C 020000      R     LJMP    ?C0092
                                           ; SOURCE LINE # 532
                                           ; SOURCE LINE # 533
010F 900000      E     MOV     DPTR,#USBFS_configuration
0112 E0                MOVX    A,@DPTR
0113 FF                MOV     R7,A
0114 EF                MOV     A,R7
0115 14                DEC     A
0116 FF                MOV     R7,A
0117 120000      R     LCALL   _USBFS_GetConfigTablePtr
011A 900000      R     MOV     DPTR,#pTmp
011D EE                MOV     A,R6
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 45  

011E F0                MOVX    @DPTR,A
011F A3                INC     DPTR
0120 EF                MOV     A,R7
0121 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 535
0122 900000      R     MOV     DPTR,#pTmp
0125 E0                MOVX    A,@DPTR
0126 FE                MOV     R6,A
0127 A3                INC     DPTR
0128 E0                MOVX    A,@DPTR
0129 FF                MOV     R7,A
012A 8F82              MOV     DPL,R7
012C 8E83              MOV     DPH,R6
012E A3                INC     DPTR
012F 120000      E     LCALL   ?C?PLDCODE
0132 900000      R     MOV     DPTR,#pDescr
0135 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 536
0138 900000      R     MOV     DPTR,#pDescr
013B 120000      E     LCALL   ?C?PLDXDATA
013E E9                MOV     A,R1
013F 2407              ADD     A,#07H
0141 F9                MOV     R1,A
0142 EA                MOV     A,R2
0143 3400              ADDC    A,#00H
0145 FA                MOV     R2,A
0146 120000      E     LCALL   ?C?CLDPTR
0149 FF                MOV     R7,A
014A EF                MOV     A,R7
014B 5440              ANL     A,#040H
014D FF                MOV     R7,A
014E 7E00              MOV     R6,#00H
0150 EF                MOV     A,R7
0151 4E                ORL     A,R6
0152 6010              JZ      ?C0069
                                           ; SOURCE LINE # 537
                                           ; SOURCE LINE # 538
0154 900000      E     MOV     DPTR,#USBFS_deviceStatus
0157 E0                MOVX    A,@DPTR
0158 FF                MOV     R7,A
0159 EF                MOV     A,R7
015A 4401              ORL     A,#01H
015C FF                MOV     R7,A
015D 900000      E     MOV     DPTR,#USBFS_deviceStatus
0160 EF                MOV     A,R7
0161 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 539
0162 800E              SJMP    ?C0070
0164         ?C0069:
                                           ; SOURCE LINE # 541
                                           ; SOURCE LINE # 542
0164 900000      E     MOV     DPTR,#USBFS_deviceStatus
0167 E0                MOVX    A,@DPTR
0168 FF                MOV     R7,A
0169 EF                MOV     A,R7
016A 54FE              ANL     A,#0FEH
016C FF                MOV     R7,A
016D 900000      E     MOV     DPTR,#USBFS_deviceStatus
0170 EF                MOV     A,R7
0171 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 543
0172         ?C0070:
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 46  

                                           ; SOURCE LINE # 545
0172 900000      R     MOV     DPTR,#pTmp
0175 E0                MOVX    A,@DPTR
0176 FE                MOV     R6,A
0177 A3                INC     DPTR
0178 E0                MOVX    A,@DPTR
0179 FF                MOV     R7,A
017A EF                MOV     A,R7
017B 2404              ADD     A,#04H
017D FF                MOV     R7,A
017E EE                MOV     A,R6
017F 3400              ADDC    A,#00H
0181 FE                MOV     R6,A
0182 900000      R     MOV     DPTR,#pTmp
0185 EE                MOV     A,R6
0186 F0                MOVX    @DPTR,A
0187 A3                INC     DPTR
0188 EF                MOV     A,R7
0189 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 546
018A 900000      R     MOV     DPTR,#pTmp
018D E0                MOVX    A,@DPTR
018E FE                MOV     R6,A
018F A3                INC     DPTR
0190 E0                MOVX    A,@DPTR
0191 FF                MOV     R7,A
0192 8F82              MOV     DPL,R7
0194 8E83              MOV     DPH,R6
0196 E4                CLR     A
0197 93                MOVC    A,@A+DPTR
0198 FF                MOV     R7,A
0199 900000      R     MOV     DPTR,#ep
019C EF                MOV     A,R7
019D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 613
019E 900000      R     MOV     DPTR,#i
01A1 7401              MOV     A,#01H
01A3 F0                MOVX    @DPTR,A
01A4         ?C0071:
01A4 900000      R     MOV     DPTR,#i
01A7 E0                MOVX    A,@DPTR
01A8 FF                MOV     R7,A
01A9 EF                MOV     A,R7
01AA C3                CLR     C
01AB 9409              SUBB    A,#09H
01AD 4003              JC      $ + 5H
01AF 020000      R     LJMP    ?C0072
                                           ; SOURCE LINE # 614
                                           ; SOURCE LINE # 616
01B2 900000      R     MOV     DPTR,#pTmp
01B5 E0                MOVX    A,@DPTR
01B6 FE                MOV     R6,A
01B7 A3                INC     DPTR
01B8 E0                MOVX    A,@DPTR
01B9 FF                MOV     R7,A
01BA 8F82              MOV     DPL,R7
01BC 8E83              MOV     DPH,R6
01BE A3                INC     DPTR
01BF 120000      E     LCALL   ?C?PLDCODE
01C2 AE02              MOV     R6,AR2
01C4 AF01              MOV     R7,AR1
01C6 900000      R     MOV     DPTR,#pEP
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 47  

01C9 EE                MOV     A,R6
01CA F0                MOVX    @DPTR,A
01CB A3                INC     DPTR
01CC EF                MOV     A,R7
01CD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 619
01CE 900000      R     MOV     DPTR,#cur_ep
01D1 E4                CLR     A
01D2 F0                MOVX    @DPTR,A
01D3         ?C0074:
01D3 900000      R     MOV     DPTR,#ep
01D6 E0                MOVX    A,@DPTR
01D7 FF                MOV     R7,A
01D8 900000      R     MOV     DPTR,#cur_ep
01DB E0                MOVX    A,@DPTR
01DC FE                MOV     R6,A
01DD EE                MOV     A,R6
01DE C3                CLR     C
01DF 9F                SUBB    A,R7
01E0 4003              JC      $ + 5H
01E2 020000      R     LJMP    ?C0073
                                           ; SOURCE LINE # 620
                                           ; SOURCE LINE # 622
01E5 900000      R     MOV     DPTR,#pEP
01E8 E0                MOVX    A,@DPTR
01E9 FE                MOV     R6,A
01EA A3                INC     DPTR
01EB E0                MOVX    A,@DPTR
01EC FF                MOV     R7,A
01ED 8F82              MOV     DPL,R7
01EF 8E83              MOV     DPH,R6
01F1 7402              MOV     A,#02H
01F3 93                MOVC    A,@A+DPTR
01F4 FF                MOV     R7,A
01F5 EF                MOV     A,R7
01F6 547F              ANL     A,#07FH
01F8 FF                MOV     R7,A
01F9 7E00              MOV     R6,#00H
01FB 900000      R     MOV     DPTR,#i
01FE E0                MOVX    A,@DPTR
01FF FD                MOV     R5,A
0200 7C00              MOV     R4,#00H
0202 ED                MOV     A,R5
0203 6F                XRL     A,R7
0204 7002              JNZ     ?C0132
0206 EC                MOV     A,R4
0207 6E                XRL     A,R6
0208         ?C0132:
0208 6003              JZ      $ + 5H
020A 020000      R     LJMP    ?C0077
                                           ; SOURCE LINE # 623
                                           ; SOURCE LINE # 624
020D 900000      R     MOV     DPTR,#pEP
0210 E0                MOVX    A,@DPTR
0211 FE                MOV     R6,A
0212 A3                INC     DPTR
0213 E0                MOVX    A,@DPTR
0214 FF                MOV     R7,A
0215 8F82              MOV     DPL,R7
0217 8E83              MOV     DPH,R6
0219 7404              MOV     A,#04H
021B 93                MOVC    A,@A+DPTR
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 48  

021C FE                MOV     R6,A
021D 7405              MOV     A,#05H
021F 93                MOVC    A,@A+DPTR
0220 FF                MOV     R7,A
0221 900000      R     MOV     DPTR,#i
0224 E0                MOVX    A,@DPTR
0225 FD                MOV     R5,A
0226 ED                MOV     A,R5
0227 75F00B            MOV     B,#0BH
022A A4                MUL     AB
022B 2400        E     ADD     A,#LOW USBFS_EP+08H
022D F582              MOV     DPL,A
022F E4                CLR     A
0230 3400        E     ADDC    A,#HIGH USBFS_EP+08H
0232 F583              MOV     DPH,A
0234 E0                MOVX    A,@DPTR
0235 FC                MOV     R4,A
0236 A3                INC     DPTR
0237 E0                MOVX    A,@DPTR
0238 FD                MOV     R5,A
0239 C3                CLR     C
023A ED                MOV     A,R5
023B 9F                SUBB    A,R7
023C EC                MOV     A,R4
023D 9E                SUBB    A,R6
023E 502C              JNC     ?C0078
                                           ; SOURCE LINE # 625
                                           ; SOURCE LINE # 626
0240 900000      R     MOV     DPTR,#pEP
0243 E0                MOVX    A,@DPTR
0244 FE                MOV     R6,A
0245 A3                INC     DPTR
0246 E0                MOVX    A,@DPTR
0247 FF                MOV     R7,A
0248 8F82              MOV     DPL,R7
024A 8E83              MOV     DPH,R6
024C 7404              MOV     A,#04H
024E 93                MOVC    A,@A+DPTR
024F FE                MOV     R6,A
0250 7405              MOV     A,#05H
0252 93                MOVC    A,@A+DPTR
0253 FF                MOV     R7,A
0254 900000      R     MOV     DPTR,#i
0257 E0                MOVX    A,@DPTR
0258 FD                MOV     R5,A
0259 ED                MOV     A,R5
025A 75F00B            MOV     B,#0BH
025D A4                MUL     AB
025E 2400        E     ADD     A,#LOW USBFS_EP+08H
0260 F582              MOV     DPL,A
0262 E4                CLR     A
0263 3400        E     ADDC    A,#HIGH USBFS_EP+08H
0265 F583              MOV     DPH,A
0267 EE                MOV     A,R6
0268 F0                MOVX    @DPTR,A
0269 A3                INC     DPTR
026A EF                MOV     A,R7
026B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 627
026C         ?C0078:
                                           ; SOURCE LINE # 629
026C 900000      R     MOV     DPTR,#pEP
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 49  

026F E0                MOVX    A,@DPTR
0270 FE                MOV     R6,A
0271 A3                INC     DPTR
0272 E0                MOVX    A,@DPTR
0273 FF                MOV     R7,A
0274 8F82              MOV     DPL,R7
0276 8E83              MOV     DPH,R6
0278 E4                CLR     A
0279 93                MOVC    A,@A+DPTR
027A FF                MOV     R7,A
027B 7400        E     MOV     A,#LOW USBFS_interfaceSetting
027D 2F                ADD     A,R7
027E F582              MOV     DPL,A
0280 E4                CLR     A
0281 3400        E     ADDC    A,#HIGH USBFS_interfaceSetting
0283 F583              MOV     DPH,A
0285 E0                MOVX    A,@DPTR
0286 FF                MOV     R7,A
0287 900000      R     MOV     DPTR,#pEP
028A E0                MOVX    A,@DPTR
028B FC                MOV     R4,A
028C A3                INC     DPTR
028D E0                MOVX    A,@DPTR
028E FD                MOV     R5,A
028F 8D82              MOV     DPL,R5
0291 8C83              MOV     DPH,R4
0293 7401              MOV     A,#01H
0295 93                MOVC    A,@A+DPTR
0296 FE                MOV     R6,A
0297 EF                MOV     A,R7
0298 6E                XRL     A,R6
0299 6003              JZ      $ + 5H
029B 020000      R     LJMP    ?C0077
                                           ; SOURCE LINE # 630
                                           ; SOURCE LINE # 631
029E 900000      R     MOV     DPTR,#pEP
02A1 E0                MOVX    A,@DPTR
02A2 FE                MOV     R6,A
02A3 A3                INC     DPTR
02A4 E0                MOVX    A,@DPTR
02A5 FF                MOV     R7,A
02A6 8F82              MOV     DPL,R7
02A8 8E83              MOV     DPH,R6
02AA 7403              MOV     A,#03H
02AC 93                MOVC    A,@A+DPTR
02AD FF                MOV     R7,A
02AE EF                MOV     A,R7
02AF 5403              ANL     A,#03H
02B1 FF                MOV     R7,A
02B2 900000      R     MOV     DPTR,#epType
02B5 EF                MOV     A,R7
02B6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 632
02B7 900000      R     MOV     DPTR,#pEP
02BA E0                MOVX    A,@DPTR
02BB FE                MOV     R6,A
02BC A3                INC     DPTR
02BD E0                MOVX    A,@DPTR
02BE FF                MOV     R7,A
02BF 8F82              MOV     DPL,R7
02C1 8E83              MOV     DPH,R6
02C3 7402              MOV     A,#02H
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 50  

02C5 93                MOVC    A,@A+DPTR
02C6 FF                MOV     R7,A
02C7 EF                MOV     A,R7
02C8 5480              ANL     A,#080H
02CA FF                MOV     R7,A
02CB 7E00              MOV     R6,#00H
02CD EF                MOV     A,R7
02CE 4E                ORL     A,R6
02CF 603C              JZ      ?C0080
                                           ; SOURCE LINE # 633
                                           ; SOURCE LINE # 635
02D1 900000      R     MOV     DPTR,#i
02D4 E0                MOVX    A,@DPTR
02D5 FF                MOV     R7,A
02D6 EF                MOV     A,R7
02D7 75F00B            MOV     B,#0BH
02DA A4                MUL     AB
02DB 2400        E     ADD     A,#LOW USBFS_EP+01H
02DD F582              MOV     DPL,A
02DF E4                CLR     A
02E0 3400        E     ADDC    A,#HIGH USBFS_EP+01H
02E2 F583              MOV     DPH,A
02E4 7401              MOV     A,#01H
02E6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 636
02E7 900000      R     MOV     DPTR,#epType
02EA E0                MOVX    A,@DPTR
02EB FF                MOV     R7,A
02EC EF                MOV     A,R7
02ED B40104            CJNE    A,#01H,?C0081
02F0 7F07              MOV     R7,#07H
02F2 8002              SJMP    ?C0082
02F4         ?C0081:
02F4 7F0D              MOV     R7,#0DH
02F6         ?C0082:
02F6 900000      R     MOV     DPTR,#i
02F9 E0                MOVX    A,@DPTR
02FA FE                MOV     R6,A
02FB EE                MOV     A,R6
02FC 75F00B            MOV     B,#0BH
02FF A4                MUL     AB
0300 2400        E     ADD     A,#LOW USBFS_EP+05H
0302 F582              MOV     DPL,A
0304 E4                CLR     A
0305 3400        E     ADDC    A,#HIGH USBFS_EP+05H
0307 F583              MOV     DPH,A
0309 EF                MOV     A,R7
030A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 655
030B 8039              SJMP    ?C0083
030D         ?C0080:
                                           ; SOURCE LINE # 657
                                           ; SOURCE LINE # 659
030D 900000      R     MOV     DPTR,#i
0310 E0                MOVX    A,@DPTR
0311 FF                MOV     R7,A
0312 EF                MOV     A,R7
0313 75F00B            MOV     B,#0BH
0316 A4                MUL     AB
0317 2400        E     ADD     A,#LOW USBFS_EP+01H
0319 F582              MOV     DPL,A
031B E4                CLR     A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 51  

031C 3400        E     ADDC    A,#HIGH USBFS_EP+01H
031E F583              MOV     DPH,A
0320 E4                CLR     A
0321 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 660
0322 900000      R     MOV     DPTR,#epType
0325 E0                MOVX    A,@DPTR
0326 FF                MOV     R7,A
0327 EF                MOV     A,R7
0328 B40104            CJNE    A,#01H,?C0084
032B 7F05              MOV     R7,#05H
032D 8002              SJMP    ?C0085
032F         ?C0084:
032F 7F09              MOV     R7,#09H
0331         ?C0085:
0331 900000      R     MOV     DPTR,#i
0334 E0                MOVX    A,@DPTR
0335 FE                MOV     R6,A
0336 EE                MOV     A,R6
0337 75F00B            MOV     B,#0BH
033A A4                MUL     AB
033B 2400        E     ADD     A,#LOW USBFS_EP+05H
033D F582              MOV     DPL,A
033F E4                CLR     A
0340 3400        E     ADDC    A,#HIGH USBFS_EP+05H
0342 F583              MOV     DPH,A
0344 EF                MOV     A,R7
0345 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 679
0346         ?C0083:
                                           ; SOURCE LINE # 680
0346 900000      R     MOV     DPTR,#pEP
0349 E0                MOVX    A,@DPTR
034A FE                MOV     R6,A
034B A3                INC     DPTR
034C E0                MOVX    A,@DPTR
034D FF                MOV     R7,A
034E 8F82              MOV     DPL,R7
0350 8E83              MOV     DPH,R6
0352 7402              MOV     A,#02H
0354 93                MOVC    A,@A+DPTR
0355 FF                MOV     R7,A
0356 900000      R     MOV     DPTR,#i
0359 E0                MOVX    A,@DPTR
035A FE                MOV     R6,A
035B EE                MOV     A,R6
035C 75F00B            MOV     B,#0BH
035F A4                MUL     AB
0360 2400        E     ADD     A,#LOW USBFS_EP+04H
0362 F582              MOV     DPL,A
0364 E4                CLR     A
0365 3400        E     ADDC    A,#HIGH USBFS_EP+04H
0367 F583              MOV     DPH,A
0369 EF                MOV     A,R7
036A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 681
036B 900000      R     MOV     DPTR,#pEP
036E E0                MOVX    A,@DPTR
036F FE                MOV     R6,A
0370 A3                INC     DPTR
0371 E0                MOVX    A,@DPTR
0372 FF                MOV     R7,A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 52  

0373 8F82              MOV     DPL,R7
0375 8E83              MOV     DPH,R6
0377 7403              MOV     A,#03H
0379 93                MOVC    A,@A+DPTR
037A FF                MOV     R7,A
037B 900000      R     MOV     DPTR,#i
037E E0                MOVX    A,@DPTR
037F FE                MOV     R6,A
0380 EE                MOV     A,R6
0381 75F00B            MOV     B,#0BH
0384 A4                MUL     AB
0385 2400        E     ADD     A,#LOW USBFS_EP
0387 F582              MOV     DPL,A
0389 E4                CLR     A
038A 3400        E     ADDC    A,#HIGH USBFS_EP
038C F583              MOV     DPH,A
038E EF                MOV     A,R7
038F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 686
                                           ; SOURCE LINE # 687
0390         ?C0077:
                                           ; SOURCE LINE # 688
0390 900000      R     MOV     DPTR,#pEP
0393 E0                MOVX    A,@DPTR
0394 FE                MOV     R6,A
0395 A3                INC     DPTR
0396 E0                MOVX    A,@DPTR
0397 FF                MOV     R7,A
0398 EF                MOV     A,R7
0399 2407              ADD     A,#07H
039B FF                MOV     R7,A
039C EE                MOV     A,R6
039D 3400              ADDC    A,#00H
039F FE                MOV     R6,A
03A0 900000      R     MOV     DPTR,#pEP
03A3 EE                MOV     A,R6
03A4 F0                MOVX    @DPTR,A
03A5 A3                INC     DPTR
03A6 EF                MOV     A,R7
03A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 689
03A8 900000      R     MOV     DPTR,#cur_ep
03AB E0                MOVX    A,@DPTR
03AC 04                INC     A
03AD F0                MOVX    @DPTR,A
03AE 020000      R     LJMP    ?C0074
                                           ; SOURCE LINE # 690
03B1         ?C0073:
03B1 900000      R     MOV     DPTR,#i
03B4 E0                MOVX    A,@DPTR
03B5 04                INC     A
03B6 F0                MOVX    @DPTR,A
03B7 020000      R     LJMP    ?C0071
03BA         ?C0072:
                                           ; SOURCE LINE # 698
03BA 900000      R     MOV     DPTR,#pTmp
03BD E0                MOVX    A,@DPTR
03BE FE                MOV     R6,A
03BF A3                INC     DPTR
03C0 E0                MOVX    A,@DPTR
03C1 FF                MOV     R7,A
03C2 8F82              MOV     DPL,R7
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 53  

03C4 8E83              MOV     DPH,R6
03C6 A3                INC     DPTR
03C7 120000      E     LCALL   ?C?PLDCODE
03CA AE02              MOV     R6,AR2
03CC AF01              MOV     R7,AR1
03CE 900000      R     MOV     DPTR,#pEP
03D1 EE                MOV     A,R6
03D2 F0                MOVX    @DPTR,A
03D3 A3                INC     DPTR
03D4 EF                MOV     A,R7
03D5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 699
03D6 900000      R     MOV     DPTR,#i
03D9 E4                CLR     A
03DA F0                MOVX    @DPTR,A
03DB         ?C0086:
03DB 900000      R     MOV     DPTR,#ep
03DE E0                MOVX    A,@DPTR
03DF FF                MOV     R7,A
03E0 900000      R     MOV     DPTR,#i
03E3 E0                MOVX    A,@DPTR
03E4 FE                MOV     R6,A
03E5 EE                MOV     A,R6
03E6 C3                CLR     C
03E7 9F                SUBB    A,R7
03E8 5053              JNC     ?C0087
                                           ; SOURCE LINE # 700
                                           ; SOURCE LINE # 702
03EA 900000      R     MOV     DPTR,#pEP
03ED E0                MOVX    A,@DPTR
03EE FE                MOV     R6,A
03EF A3                INC     DPTR
03F0 E0                MOVX    A,@DPTR
03F1 FF                MOV     R7,A
03F2 8F82              MOV     DPL,R7
03F4 8E83              MOV     DPH,R6
03F6 E4                CLR     A
03F7 93                MOVC    A,@A+DPTR
03F8 FF                MOV     R7,A
03F9 900000      R     MOV     DPTR,#pEP
03FC E0                MOVX    A,@DPTR
03FD FC                MOV     R4,A
03FE A3                INC     DPTR
03FF E0                MOVX    A,@DPTR
0400 FD                MOV     R5,A
0401 8D82              MOV     DPL,R5
0403 8C83              MOV     DPH,R4
0405 7402              MOV     A,#02H
0407 93                MOVC    A,@A+DPTR
0408 FE                MOV     R6,A
0409 EE                MOV     A,R6
040A 547F              ANL     A,#07FH
040C FE                MOV     R6,A
040D EE                MOV     A,R6
040E 75F00B            MOV     B,#0BH
0411 A4                MUL     AB
0412 2400        E     ADD     A,#LOW USBFS_EP+0AH
0414 F582              MOV     DPL,A
0416 E4                CLR     A
0417 3400        E     ADDC    A,#HIGH USBFS_EP+0AH
0419 F583              MOV     DPH,A
041B EF                MOV     A,R7
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 54  

041C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 703
041D 900000      R     MOV     DPTR,#pEP
0420 E0                MOVX    A,@DPTR
0421 FE                MOV     R6,A
0422 A3                INC     DPTR
0423 E0                MOVX    A,@DPTR
0424 FF                MOV     R7,A
0425 EF                MOV     A,R7
0426 2407              ADD     A,#07H
0428 FF                MOV     R7,A
0429 EE                MOV     A,R6
042A 3400              ADDC    A,#00H
042C FE                MOV     R6,A
042D 900000      R     MOV     DPTR,#pEP
0430 EE                MOV     A,R6
0431 F0                MOVX    @DPTR,A
0432 A3                INC     DPTR
0433 EF                MOV     A,R7
0434 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 704
0435 900000      R     MOV     DPTR,#i
0438 E0                MOVX    A,@DPTR
0439 04                INC     A
043A F0                MOVX    @DPTR,A
043B 809E              SJMP    ?C0086
043D         ?C0087:
                                           ; SOURCE LINE # 706
043D 120000      R     LCALL   USBFS_GetInterfaceClassTablePtr
0440 900000      E     MOV     DPTR,#USBFS_interfaceClass
0443 EE                MOV     A,R6
0444 F0                MOVX    @DPTR,A
0445 A3                INC     DPTR
0446 EF                MOV     A,R7
0447 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 710
0448 900000      R     MOV     DPTR,#ep
044B 7401              MOV     A,#01H
044D F0                MOVX    @DPTR,A
044E         ?C0089:
044E 900000      R     MOV     DPTR,#ep
0451 E0                MOVX    A,@DPTR
0452 FF                MOV     R7,A
0453 EF                MOV     A,R7
0454 C3                CLR     C
0455 9409              SUBB    A,#09H
0457 5049              JNC     ?C0090
                                           ; SOURCE LINE # 711
                                           ; SOURCE LINE # 712
0459 900000      R     MOV     DPTR,#buffCount
045C E0                MOVX    A,@DPTR
045D FE                MOV     R6,A
045E A3                INC     DPTR
045F E0                MOVX    A,@DPTR
0460 FF                MOV     R7,A
0461 900000      R     MOV     DPTR,#ep
0464 E0                MOVX    A,@DPTR
0465 FD                MOV     R5,A
0466 ED                MOV     A,R5
0467 75F00B            MOV     B,#0BH
046A A4                MUL     AB
046B 2400        E     ADD     A,#LOW USBFS_EP+06H
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 55  

046D F582              MOV     DPL,A
046F E4                CLR     A
0470 3400        E     ADDC    A,#HIGH USBFS_EP+06H
0472 F583              MOV     DPH,A
0474 EE                MOV     A,R6
0475 F0                MOVX    @DPTR,A
0476 A3                INC     DPTR
0477 EF                MOV     A,R7
0478 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 713
0479 900000      R     MOV     DPTR,#ep
047C E0                MOVX    A,@DPTR
047D FF                MOV     R7,A
047E EF                MOV     A,R7
047F 75F00B            MOV     B,#0BH
0482 A4                MUL     AB
0483 2400        E     ADD     A,#LOW USBFS_EP+08H
0485 F582              MOV     DPL,A
0487 E4                CLR     A
0488 3400        E     ADDC    A,#HIGH USBFS_EP+08H
048A F583              MOV     DPH,A
048C E0                MOVX    A,@DPTR
048D FE                MOV     R6,A
048E A3                INC     DPTR
048F E0                MOVX    A,@DPTR
0490 FF                MOV     R7,A
0491 900000      R     MOV     DPTR,#buffCount
0494 EE                MOV     A,R6
0495 8FF0              MOV     B,R7
0497 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 714
049A 900000      R     MOV     DPTR,#ep
049D E0                MOVX    A,@DPTR
049E 04                INC     A
049F F0                MOVX    @DPTR,A
04A0 80AC              SJMP    ?C0089
04A2         ?C0090:
                                           ; SOURCE LINE # 718
04A2 120000      R     LCALL   USBFS_ConfigReg
                                           ; SOURCE LINE # 719
                                           ; SOURCE LINE # 720
04A5         ?C0092:
04A5 22                RET     
             ; FUNCTION _USBFS_Config (END)

             ; FUNCTION USBFS_ConfigAltChanged (BEGIN)
                                           ; SOURCE LINE # 741
                                           ; SOURCE LINE # 742
                                           ; SOURCE LINE # 754
0000 900000      E     MOV     DPTR,#USBFS_configuration
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 EF                MOV     A,R7
0006 D3                SETB    C
0007 9400              SUBB    A,#00H
0009 5003              JNC     $ + 5H
000B 020000      R     LJMP    ?C0104
                                           ; SOURCE LINE # 755
                                           ; SOURCE LINE # 756
000E 900000      E     MOV     DPTR,#USBFS_configuration
0011 E0                MOVX    A,@DPTR
0012 FF                MOV     R7,A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 56  

0013 EF                MOV     A,R7
0014 14                DEC     A
0015 FF                MOV     R7,A
0016 120000      R     LCALL   _USBFS_GetConfigTablePtr
0019 900000      R     MOV     DPTR,#pTmp
001C EE                MOV     A,R6
001D F0                MOVX    @DPTR,A
001E A3                INC     DPTR
001F EF                MOV     A,R7
0020 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 757
0021 900000      R     MOV     DPTR,#pTmp
0024 E0                MOVX    A,@DPTR
0025 FE                MOV     R6,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 FF                MOV     R7,A
0029 EF                MOV     A,R7
002A 2404              ADD     A,#04H
002C FF                MOV     R7,A
002D EE                MOV     A,R6
002E 3400              ADDC    A,#00H
0030 FE                MOV     R6,A
0031 900000      R     MOV     DPTR,#pTmp
0034 EE                MOV     A,R6
0035 F0                MOVX    @DPTR,A
0036 A3                INC     DPTR
0037 EF                MOV     A,R7
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 758
0039 900000      R     MOV     DPTR,#pTmp
003C E0                MOVX    A,@DPTR
003D FE                MOV     R6,A
003E A3                INC     DPTR
003F E0                MOVX    A,@DPTR
0040 FF                MOV     R7,A
0041 8F82              MOV     DPL,R7
0043 8E83              MOV     DPH,R6
0045 E4                CLR     A
0046 93                MOVC    A,@A+DPTR
0047 FF                MOV     R7,A
0048 900000      R     MOV     DPTR,#ep
004B EF                MOV     A,R7
004C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 763
004D 900000      R     MOV     DPTR,#pTmp
0050 E0                MOVX    A,@DPTR
0051 FE                MOV     R6,A
0052 A3                INC     DPTR
0053 E0                MOVX    A,@DPTR
0054 FF                MOV     R7,A
0055 8F82              MOV     DPL,R7
0057 8E83              MOV     DPH,R6
0059 A3                INC     DPTR
005A 120000      E     LCALL   ?C?PLDCODE
005D AE02              MOV     R6,AR2
005F AF01              MOV     R7,AR1
0061 900000      R     MOV     DPTR,#pEP
0064 EE                MOV     A,R6
0065 F0                MOVX    @DPTR,A
0066 A3                INC     DPTR
0067 EF                MOV     A,R7
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 57  

0068 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 764
0069 900000      R     MOV     DPTR,#i
006C E4                CLR     A
006D F0                MOVX    @DPTR,A
006E         ?C0094:
006E 900000      R     MOV     DPTR,#ep
0071 E0                MOVX    A,@DPTR
0072 FF                MOV     R7,A
0073 900000      R     MOV     DPTR,#i
0076 E0                MOVX    A,@DPTR
0077 FE                MOV     R6,A
0078 EE                MOV     A,R6
0079 C3                CLR     C
007A 9F                SUBB    A,R7
007B 4003              JC      $ + 5H
007D 020000      R     LJMP    ?C0104
                                           ; SOURCE LINE # 765
                                           ; SOURCE LINE # 770
0080 900000      R     MOV     DPTR,#pEP
0083 E0                MOVX    A,@DPTR
0084 FE                MOV     R6,A
0085 A3                INC     DPTR
0086 E0                MOVX    A,@DPTR
0087 FF                MOV     R7,A
0088 8F82              MOV     DPL,R7
008A 8E83              MOV     DPH,R6
008C E4                CLR     A
008D 93                MOVC    A,@A+DPTR
008E FF                MOV     R7,A
008F 7400        E     MOV     A,#LOW USBFS_interfaceSetting_last
0091 2F                ADD     A,R7
0092 F582              MOV     DPL,A
0094 E4                CLR     A
0095 3400        E     ADDC    A,#HIGH USBFS_interfaceSetting_last
0097 F583              MOV     DPH,A
0099 E0                MOVX    A,@DPTR
009A FF                MOV     R7,A
009B 900000      R     MOV     DPTR,#pEP
009E E0                MOVX    A,@DPTR
009F FC                MOV     R4,A
00A0 A3                INC     DPTR
00A1 E0                MOVX    A,@DPTR
00A2 FD                MOV     R5,A
00A3 8D82              MOV     DPL,R5
00A5 8C83              MOV     DPH,R4
00A7 E4                CLR     A
00A8 93                MOVC    A,@A+DPTR
00A9 FE                MOV     R6,A
00AA 7400        E     MOV     A,#LOW USBFS_interfaceSetting
00AC 2E                ADD     A,R6
00AD F582              MOV     DPL,A
00AF E4                CLR     A
00B0 3400        E     ADDC    A,#HIGH USBFS_interfaceSetting
00B2 F583              MOV     DPH,A
00B4 E0                MOVX    A,@DPTR
00B5 FE                MOV     R6,A
00B6 EE                MOV     A,R6
00B7 6F                XRL     A,R7
00B8 7003              JNZ     $ + 5H
00BA 020000      R     LJMP    ?C0097
00BD 900000      R     MOV     DPTR,#pEP
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 58  

00C0 E0                MOVX    A,@DPTR
00C1 FE                MOV     R6,A
00C2 A3                INC     DPTR
00C3 E0                MOVX    A,@DPTR
00C4 FF                MOV     R7,A
00C5 8F82              MOV     DPL,R7
00C7 8E83              MOV     DPH,R6
00C9 E4                CLR     A
00CA 93                MOVC    A,@A+DPTR
00CB FF                MOV     R7,A
00CC 7400        E     MOV     A,#LOW USBFS_interfaceSetting
00CE 2F                ADD     A,R7
00CF F582              MOV     DPL,A
00D1 E4                CLR     A
00D2 3400        E     ADDC    A,#HIGH USBFS_interfaceSetting
00D4 F583              MOV     DPH,A
00D6 E0                MOVX    A,@DPTR
00D7 FF                MOV     R7,A
00D8 900000      R     MOV     DPTR,#pEP
00DB E0                MOVX    A,@DPTR
00DC FC                MOV     R4,A
00DD A3                INC     DPTR
00DE E0                MOVX    A,@DPTR
00DF FD                MOV     R5,A
00E0 8D82              MOV     DPL,R5
00E2 8C83              MOV     DPH,R4
00E4 7401              MOV     A,#01H
00E6 93                MOVC    A,@A+DPTR
00E7 FE                MOV     R6,A
00E8 EF                MOV     A,R7
00E9 6E                XRL     A,R6
00EA 6003              JZ      $ + 5H
00EC 020000      R     LJMP    ?C0097
00EF 900000      R     MOV     DPTR,#pEP
00F2 E0                MOVX    A,@DPTR
00F3 FE                MOV     R6,A
00F4 A3                INC     DPTR
00F5 E0                MOVX    A,@DPTR
00F6 FF                MOV     R7,A
00F7 8F82              MOV     DPL,R7
00F9 8E83              MOV     DPH,R6
00FB E4                CLR     A
00FC 93                MOVC    A,@A+DPTR
00FD FF                MOV     R7,A
00FE 906004            MOV     DPTR,#06004H
0101 E0                MOVX    A,@DPTR
0102 FE                MOV     R6,A
0103 EF                MOV     A,R7
0104 6E                XRL     A,R6
0105 6003              JZ      $ + 5H
0107 020000      R     LJMP    ?C0097
                                           ; SOURCE LINE # 771
                                           ; SOURCE LINE # 772
010A 900000      R     MOV     DPTR,#pEP
010D E0                MOVX    A,@DPTR
010E FE                MOV     R6,A
010F A3                INC     DPTR
0110 E0                MOVX    A,@DPTR
0111 FF                MOV     R7,A
0112 8F82              MOV     DPL,R7
0114 8E83              MOV     DPH,R6
0116 7402              MOV     A,#02H
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 59  

0118 93                MOVC    A,@A+DPTR
0119 FF                MOV     R7,A
011A EF                MOV     A,R7
011B 547F              ANL     A,#07FH
011D FF                MOV     R7,A
011E 900000      R     MOV     DPTR,#cur_ep
0121 EF                MOV     A,R7
0122 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 773
0123 900000      R     MOV     DPTR,#cur_ep
0126 E0                MOVX    A,@DPTR
0127 FF                MOV     R7,A
0128 7E00              MOV     R6,#00H
012A EF                MOV     A,R7
012B 24FF              ADD     A,#0FFH
012D FF                MOV     R7,A
012E EE                MOV     A,R6
012F 34FF              ADDC    A,#0FFH
0131 FE                MOV     R6,A
0132 EF                MOV     A,R7
0133 C4                SWAP    A
0134 F8                MOV     R0,A
0135 540F              ANL     A,#0FH
0137 C8                XCH     A,R0
0138 68                XRL     A,R0
0139 FF                MOV     R7,A
013A EE                MOV     A,R6
013B C4                SWAP    A
013C 54F0              ANL     A,#0F0H
013E 48                ORL     A,R0
013F FE                MOV     R6,A
0140 900000      R     MOV     DPTR,#ri
0143 EF                MOV     A,R7
0144 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 774
0145 900000      R     MOV     DPTR,#pEP
0148 E0                MOVX    A,@DPTR
0149 FE                MOV     R6,A
014A A3                INC     DPTR
014B E0                MOVX    A,@DPTR
014C FF                MOV     R7,A
014D 8F82              MOV     DPL,R7
014F 8E83              MOV     DPH,R6
0151 7403              MOV     A,#03H
0153 93                MOVC    A,@A+DPTR
0154 FF                MOV     R7,A
0155 EF                MOV     A,R7
0156 5403              ANL     A,#03H
0158 FF                MOV     R7,A
0159 900000      R     MOV     DPTR,#epType
015C EF                MOV     A,R7
015D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 775
015E 900000      R     MOV     DPTR,#pEP
0161 E0                MOVX    A,@DPTR
0162 FE                MOV     R6,A
0163 A3                INC     DPTR
0164 E0                MOVX    A,@DPTR
0165 FF                MOV     R7,A
0166 8F82              MOV     DPL,R7
0168 8E83              MOV     DPH,R6
016A 7402              MOV     A,#02H
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 60  

016C 93                MOVC    A,@A+DPTR
016D FF                MOV     R7,A
016E EF                MOV     A,R7
016F 5480              ANL     A,#080H
0171 FF                MOV     R7,A
0172 7E00              MOV     R6,#00H
0174 EF                MOV     A,R7
0175 4E                ORL     A,R6
0176 603C              JZ      ?C0098
                                           ; SOURCE LINE # 776
                                           ; SOURCE LINE # 778
0178 900000      R     MOV     DPTR,#cur_ep
017B E0                MOVX    A,@DPTR
017C FF                MOV     R7,A
017D EF                MOV     A,R7
017E 75F00B            MOV     B,#0BH
0181 A4                MUL     AB
0182 2400        E     ADD     A,#LOW USBFS_EP+01H
0184 F582              MOV     DPL,A
0186 E4                CLR     A
0187 3400        E     ADDC    A,#HIGH USBFS_EP+01H
0189 F583              MOV     DPH,A
018B 7401              MOV     A,#01H
018D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 779
018E 900000      R     MOV     DPTR,#epType
0191 E0                MOVX    A,@DPTR
0192 FF                MOV     R7,A
0193 EF                MOV     A,R7
0194 B40104            CJNE    A,#01H,?C0099
0197 7F07              MOV     R7,#07H
0199 8002              SJMP    ?C0100
019B         ?C0099:
019B 7F0D              MOV     R7,#0DH
019D         ?C0100:
019D 900000      R     MOV     DPTR,#cur_ep
01A0 E0                MOVX    A,@DPTR
01A1 FE                MOV     R6,A
01A2 EE                MOV     A,R6
01A3 75F00B            MOV     B,#0BH
01A6 A4                MUL     AB
01A7 2400        E     ADD     A,#LOW USBFS_EP+05H
01A9 F582              MOV     DPL,A
01AB E4                CLR     A
01AC 3400        E     ADDC    A,#HIGH USBFS_EP+05H
01AE F583              MOV     DPH,A
01B0 EF                MOV     A,R7
01B1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 781
01B2 8039              SJMP    ?C0101
01B4         ?C0098:
                                           ; SOURCE LINE # 783
                                           ; SOURCE LINE # 785
01B4 900000      R     MOV     DPTR,#cur_ep
01B7 E0                MOVX    A,@DPTR
01B8 FF                MOV     R7,A
01B9 EF                MOV     A,R7
01BA 75F00B            MOV     B,#0BH
01BD A4                MUL     AB
01BE 2400        E     ADD     A,#LOW USBFS_EP+01H
01C0 F582              MOV     DPL,A
01C2 E4                CLR     A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 61  

01C3 3400        E     ADDC    A,#HIGH USBFS_EP+01H
01C5 F583              MOV     DPH,A
01C7 E4                CLR     A
01C8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 786
01C9 900000      R     MOV     DPTR,#epType
01CC E0                MOVX    A,@DPTR
01CD FF                MOV     R7,A
01CE EF                MOV     A,R7
01CF B40104            CJNE    A,#01H,?C0102
01D2 7F05              MOV     R7,#05H
01D4 8002              SJMP    ?C0103
01D6         ?C0102:
01D6 7F09              MOV     R7,#09H
01D8         ?C0103:
01D8 900000      R     MOV     DPTR,#cur_ep
01DB E0                MOVX    A,@DPTR
01DC FE                MOV     R6,A
01DD EE                MOV     A,R6
01DE 75F00B            MOV     B,#0BH
01E1 A4                MUL     AB
01E2 2400        E     ADD     A,#LOW USBFS_EP+05H
01E4 F582              MOV     DPL,A
01E6 E4                CLR     A
01E7 3400        E     ADDC    A,#HIGH USBFS_EP+05H
01E9 F583              MOV     DPH,A
01EB EF                MOV     A,R7
01EC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 788
01ED         ?C0101:
                                           ; SOURCE LINE # 790
01ED 900000      R     MOV     DPTR,#ri
01F0 E0                MOVX    A,@DPTR
01F1 FF                MOV     R7,A
01F2 7E00              MOV     R6,#00H
01F4 EF                MOV     A,R7
01F5 240E              ADD     A,#0EH
01F7 FF                MOV     R7,A
01F8 EE                MOV     A,R6
01F9 3460              ADDC    A,#060H
01FB FE                MOV     R6,A
01FC 8F82              MOV     DPL,R7
01FE 8E83              MOV     DPH,R6
0200 7401              MOV     A,#01H
0202 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 791
0203 900000      R     MOV     DPTR,#pEP
0206 E0                MOVX    A,@DPTR
0207 FE                MOV     R6,A
0208 A3                INC     DPTR
0209 E0                MOVX    A,@DPTR
020A FF                MOV     R7,A
020B 8F82              MOV     DPL,R7
020D 8E83              MOV     DPH,R6
020F 7404              MOV     A,#04H
0211 93                MOVC    A,@A+DPTR
0212 FE                MOV     R6,A
0213 7405              MOV     A,#05H
0215 93                MOVC    A,@A+DPTR
0216 FF                MOV     R7,A
0217 900000      R     MOV     DPTR,#cur_ep
021A E0                MOVX    A,@DPTR
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 62  

021B FD                MOV     R5,A
021C ED                MOV     A,R5
021D 75F00B            MOV     B,#0BH
0220 A4                MUL     AB
0221 2400        E     ADD     A,#LOW USBFS_EP+08H
0223 F582              MOV     DPL,A
0225 E4                CLR     A
0226 3400        E     ADDC    A,#HIGH USBFS_EP+08H
0228 F583              MOV     DPH,A
022A EE                MOV     A,R6
022B F0                MOVX    @DPTR,A
022C A3                INC     DPTR
022D EF                MOV     A,R7
022E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 792
022F 900000      R     MOV     DPTR,#pEP
0232 E0                MOVX    A,@DPTR
0233 FE                MOV     R6,A
0234 A3                INC     DPTR
0235 E0                MOVX    A,@DPTR
0236 FF                MOV     R7,A
0237 8F82              MOV     DPL,R7
0239 8E83              MOV     DPH,R6
023B 7402              MOV     A,#02H
023D 93                MOVC    A,@A+DPTR
023E FF                MOV     R7,A
023F 900000      R     MOV     DPTR,#cur_ep
0242 E0                MOVX    A,@DPTR
0243 FE                MOV     R6,A
0244 EE                MOV     A,R6
0245 75F00B            MOV     B,#0BH
0248 A4                MUL     AB
0249 2400        E     ADD     A,#LOW USBFS_EP+04H
024B F582              MOV     DPL,A
024D E4                CLR     A
024E 3400        E     ADDC    A,#HIGH USBFS_EP+04H
0250 F583              MOV     DPH,A
0252 EF                MOV     A,R7
0253 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 793
0254 900000      R     MOV     DPTR,#pEP
0257 E0                MOVX    A,@DPTR
0258 FE                MOV     R6,A
0259 A3                INC     DPTR
025A E0                MOVX    A,@DPTR
025B FF                MOV     R7,A
025C 8F82              MOV     DPL,R7
025E 8E83              MOV     DPH,R6
0260 7403              MOV     A,#03H
0262 93                MOVC    A,@A+DPTR
0263 FF                MOV     R7,A
0264 900000      R     MOV     DPTR,#cur_ep
0267 E0                MOVX    A,@DPTR
0268 FE                MOV     R6,A
0269 EE                MOV     A,R6
026A 75F00B            MOV     B,#0BH
026D A4                MUL     AB
026E 2400        E     ADD     A,#LOW USBFS_EP
0270 F582              MOV     DPL,A
0272 E4                CLR     A
0273 3400        E     ADDC    A,#HIGH USBFS_EP
0275 F583              MOV     DPH,A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 63  

0277 EF                MOV     A,R7
0278 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 796
0279 900000      R     MOV     DPTR,#cur_ep
027C E0                MOVX    A,@DPTR
027D FF                MOV     R7,A
027E EF                MOV     A,R7
027F 75F00B            MOV     B,#0BH
0282 A4                MUL     AB
0283 2400        E     ADD     A,#LOW USBFS_EP+03H
0285 F582              MOV     DPL,A
0287 E4                CLR     A
0288 3400        E     ADDC    A,#HIGH USBFS_EP+03H
028A F583              MOV     DPH,A
028C E4                CLR     A
028D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 833
028E 900000      R     MOV     DPTR,#cur_ep
0291 E0                MOVX    A,@DPTR
0292 FF                MOV     R7,A
0293 EF                MOV     A,R7
0294 75F00B            MOV     B,#0BH
0297 A4                MUL     AB
0298 2400        E     ADD     A,#LOW USBFS_EP+08H
029A F582              MOV     DPL,A
029C E4                CLR     A
029D 3400        E     ADDC    A,#HIGH USBFS_EP+08H
029F F583              MOV     DPH,A
02A1 E0                MOVX    A,@DPTR
02A2 FE                MOV     R6,A
02A3 A3                INC     DPTR
02A4 E0                MOVX    A,@DPTR
02A5 FF                MOV     R7,A
02A6 EE                MOV     A,R6
02A7 FF                MOV     R7,A
02A8 7E00              MOV     R6,#00H
02AA 900000      R     MOV     DPTR,#ri
02AD E0                MOVX    A,@DPTR
02AE FE                MOV     R6,A
02AF EE                MOV     A,R6
02B0 FD                MOV     R5,A
02B1 7C00              MOV     R4,#00H
02B3 ED                MOV     A,R5
02B4 240C              ADD     A,#0CH
02B6 FD                MOV     R5,A
02B7 EC                MOV     A,R4
02B8 3460              ADDC    A,#060H
02BA FC                MOV     R4,A
02BB 8D82              MOV     DPL,R5
02BD 8C83              MOV     DPH,R4
02BF EF                MOV     A,R7
02C0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 835
02C1 900000      R     MOV     DPTR,#cur_ep
02C4 E0                MOVX    A,@DPTR
02C5 FF                MOV     R7,A
02C6 EF                MOV     A,R7
02C7 75F00B            MOV     B,#0BH
02CA A4                MUL     AB
02CB 2400        E     ADD     A,#LOW USBFS_EP+08H
02CD F582              MOV     DPL,A
02CF E4                CLR     A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 64  

02D0 3400        E     ADDC    A,#HIGH USBFS_EP+08H
02D2 F583              MOV     DPH,A
02D4 E0                MOVX    A,@DPTR
02D5 FE                MOV     R6,A
02D6 A3                INC     DPTR
02D7 E0                MOVX    A,@DPTR
02D8 FF                MOV     R7,A
02D9 EF                MOV     A,R7
02DA 54FF              ANL     A,#0FFH
02DC FF                MOV     R7,A
02DD 900000      R     MOV     DPTR,#ri
02E0 E0                MOVX    A,@DPTR
02E1 FE                MOV     R6,A
02E2 EE                MOV     A,R6
02E3 FD                MOV     R5,A
02E4 7C00              MOV     R4,#00H
02E6 ED                MOV     A,R5
02E7 240D              ADD     A,#0DH
02E9 FD                MOV     R5,A
02EA EC                MOV     A,R4
02EB 3460              ADDC    A,#060H
02ED FC                MOV     R4,A
02EE 8D82              MOV     DPL,R5
02F0 8C83              MOV     DPH,R4
02F2 EF                MOV     A,R7
02F3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 837
02F4 900000      R     MOV     DPTR,#cur_ep
02F7 E0                MOVX    A,@DPTR
02F8 FF                MOV     R7,A
02F9 EF                MOV     A,R7
02FA 75F00B            MOV     B,#0BH
02FD A4                MUL     AB
02FE 2400        E     ADD     A,#LOW USBFS_EP+06H
0300 F582              MOV     DPL,A
0302 E4                CLR     A
0303 3400        E     ADDC    A,#HIGH USBFS_EP+06H
0305 F583              MOV     DPH,A
0307 E0                MOVX    A,@DPTR
0308 FE                MOV     R6,A
0309 A3                INC     DPTR
030A E0                MOVX    A,@DPTR
030B FF                MOV     R7,A
030C EF                MOV     A,R7
030D 54FF              ANL     A,#0FFH
030F FF                MOV     R7,A
0310 900000      R     MOV     DPTR,#ri
0313 E0                MOVX    A,@DPTR
0314 FE                MOV     R6,A
0315 EE                MOV     A,R6
0316 FD                MOV     R5,A
0317 7C00              MOV     R4,#00H
0319 ED                MOV     A,R5
031A 2486              ADD     A,#086H
031C FD                MOV     R5,A
031D EC                MOV     A,R4
031E 3460              ADDC    A,#060H
0320 FC                MOV     R4,A
0321 8D82              MOV     DPL,R5
0323 8C83              MOV     DPH,R4
0325 EF                MOV     A,R7
0326 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 65  

                                           ; SOURCE LINE # 839
0327 900000      R     MOV     DPTR,#cur_ep
032A E0                MOVX    A,@DPTR
032B FF                MOV     R7,A
032C EF                MOV     A,R7
032D 75F00B            MOV     B,#0BH
0330 A4                MUL     AB
0331 2400        E     ADD     A,#LOW USBFS_EP+06H
0333 F582              MOV     DPL,A
0335 E4                CLR     A
0336 3400        E     ADDC    A,#HIGH USBFS_EP+06H
0338 F583              MOV     DPH,A
033A E0                MOVX    A,@DPTR
033B FE                MOV     R6,A
033C A3                INC     DPTR
033D E0                MOVX    A,@DPTR
033E FF                MOV     R7,A
033F EE                MOV     A,R6
0340 FF                MOV     R7,A
0341 7E00              MOV     R6,#00H
0343 900000      R     MOV     DPTR,#ri
0346 E0                MOVX    A,@DPTR
0347 FE                MOV     R6,A
0348 EE                MOV     A,R6
0349 FD                MOV     R5,A
034A 7C00              MOV     R4,#00H
034C ED                MOV     A,R5
034D 2487              ADD     A,#087H
034F FD                MOV     R5,A
0350 EC                MOV     A,R4
0351 3460              ADDC    A,#060H
0353 FC                MOV     R4,A
0354 8D82              MOV     DPL,R5
0356 8C83              MOV     DPH,R4
0358 EF                MOV     A,R7
0359 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 841
035A 900000      R     MOV     DPTR,#cur_ep
035D E0                MOVX    A,@DPTR
035E FF                MOV     R7,A
035F EF                MOV     A,R7
0360 75F00B            MOV     B,#0BH
0363 A4                MUL     AB
0364 2400        E     ADD     A,#LOW USBFS_EP+06H
0366 F582              MOV     DPL,A
0368 E4                CLR     A
0369 3400        E     ADDC    A,#HIGH USBFS_EP+06H
036B F583              MOV     DPH,A
036D E0                MOVX    A,@DPTR
036E FE                MOV     R6,A
036F A3                INC     DPTR
0370 E0                MOVX    A,@DPTR
0371 FF                MOV     R7,A
0372 EF                MOV     A,R7
0373 54FF              ANL     A,#0FFH
0375 FF                MOV     R7,A
0376 900000      R     MOV     DPTR,#ri
0379 E0                MOVX    A,@DPTR
037A FE                MOV     R6,A
037B EE                MOV     A,R6
037C FD                MOV     R5,A
037D 7C00              MOV     R4,#00H
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 66  

037F ED                MOV     A,R5
0380 2484              ADD     A,#084H
0382 FD                MOV     R5,A
0383 EC                MOV     A,R4
0384 3460              ADDC    A,#060H
0386 FC                MOV     R4,A
0387 8D82              MOV     DPL,R5
0389 8C83              MOV     DPH,R4
038B EF                MOV     A,R7
038C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 843
038D 900000      R     MOV     DPTR,#cur_ep
0390 E0                MOVX    A,@DPTR
0391 FF                MOV     R7,A
0392 EF                MOV     A,R7
0393 75F00B            MOV     B,#0BH
0396 A4                MUL     AB
0397 2400        E     ADD     A,#LOW USBFS_EP+06H
0399 F582              MOV     DPL,A
039B E4                CLR     A
039C 3400        E     ADDC    A,#HIGH USBFS_EP+06H
039E F583              MOV     DPH,A
03A0 E0                MOVX    A,@DPTR
03A1 FE                MOV     R6,A
03A2 A3                INC     DPTR
03A3 E0                MOVX    A,@DPTR
03A4 FF                MOV     R7,A
03A5 EE                MOV     A,R6
03A6 FF                MOV     R7,A
03A7 7E00              MOV     R6,#00H
03A9 900000      R     MOV     DPTR,#ri
03AC E0                MOVX    A,@DPTR
03AD FE                MOV     R6,A
03AE EE                MOV     A,R6
03AF FD                MOV     R5,A
03B0 7C00              MOV     R4,#00H
03B2 ED                MOV     A,R5
03B3 2485              ADD     A,#085H
03B5 FD                MOV     R5,A
03B6 EC                MOV     A,R4
03B7 3460              ADDC    A,#060H
03B9 FC                MOV     R4,A
03BA 8D82              MOV     DPL,R5
03BC 8C83              MOV     DPH,R4
03BE EF                MOV     A,R7
03BF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 845
03C0         ?C0097:
                                           ; SOURCE LINE # 847
03C0 900000      R     MOV     DPTR,#pEP
03C3 E0                MOVX    A,@DPTR
03C4 FE                MOV     R6,A
03C5 A3                INC     DPTR
03C6 E0                MOVX    A,@DPTR
03C7 FF                MOV     R7,A
03C8 EF                MOV     A,R7
03C9 2407              ADD     A,#07H
03CB FF                MOV     R7,A
03CC EE                MOV     A,R6
03CD 3400              ADDC    A,#00H
03CF FE                MOV     R6,A
03D0 900000      R     MOV     DPTR,#pEP
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 67  

03D3 EE                MOV     A,R6
03D4 F0                MOVX    @DPTR,A
03D5 A3                INC     DPTR
03D6 EF                MOV     A,R7
03D7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 848
03D8 900000      R     MOV     DPTR,#i
03DB E0                MOVX    A,@DPTR
03DC 04                INC     A
03DD F0                MOVX    @DPTR,A
03DE 020000      R     LJMP    ?C0094
                                           ; SOURCE LINE # 849
                                           ; SOURCE LINE # 850
03E1         ?C0104:
03E1 22                RET     
             ; FUNCTION USBFS_ConfigAltChanged (END)

             ; FUNCTION _USBFS_GetConfigTablePtr (BEGIN)
                                           ; SOURCE LINE # 867
0000 900000      R     MOV     DPTR,#confIndex
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 869
                                           ; SOURCE LINE # 873
0005 900000      E     MOV     DPTR,#USBFS_device
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A EF                MOV     A,R7
000B 25E0              ADD     A,ACC
000D 25E0              ADD     A,ACC
000F 2400        E     ADD     A,#LOW USBFS_TABLE+01H
0011 F582              MOV     DPL,A
0013 E4                CLR     A
0014 3400        E     ADDC    A,#HIGH USBFS_TABLE+01H
0016 F583              MOV     DPH,A
0018 120000      E     LCALL   ?C?PLDCODE
001B AE02              MOV     R6,AR2
001D AF01              MOV     R7,AR1
001F 900000      R     MOV     DPTR,#pTmp
0022 EE                MOV     A,R6
0023 F0                MOVX    @DPTR,A
0024 A3                INC     DPTR
0025 EF                MOV     A,R7
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 879
0027 900000      R     MOV     DPTR,#pTmp
002A E0                MOVX    A,@DPTR
002B FE                MOV     R6,A
002C A3                INC     DPTR
002D E0                MOVX    A,@DPTR
002E FF                MOV     R7,A
002F EF                MOV     A,R7
0030 2404              ADD     A,#04H
0032 FF                MOV     R7,A
0033 EE                MOV     A,R6
0034 3400              ADDC    A,#00H
0036 FE                MOV     R6,A
0037 900000      R     MOV     DPTR,#pTmp
003A EE                MOV     A,R6
003B F0                MOVX    @DPTR,A
003C A3                INC     DPTR
003D EF                MOV     A,R7
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 68  

003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 881
003F 900000      R     MOV     DPTR,#pTmp
0042 E0                MOVX    A,@DPTR
0043 FE                MOV     R6,A
0044 A3                INC     DPTR
0045 E0                MOVX    A,@DPTR
0046 FF                MOV     R7,A
0047 8F82              MOV     DPL,R7
0049 8E83              MOV     DPH,R6
004B E4                CLR     A
004C 93                MOVC    A,@A+DPTR
004D FF                MOV     R7,A
004E 900000      R     MOV     DPTR,#confIndex
0051 E0                MOVX    A,@DPTR
0052 FE                MOV     R6,A
0053 EE                MOV     A,R6
0054 C3                CLR     C
0055 9F                SUBB    A,R7
0056 400A              JC      ?C0105
                                           ; SOURCE LINE # 882
                                           ; SOURCE LINE # 883
0058 900000      R     MOV     DPTR,#pTmp
005B E4                CLR     A
005C F0                MOVX    @DPTR,A
005D A3                INC     DPTR
005E E4                CLR     A
005F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 884
0060 8030              SJMP    ?C0106
0062         ?C0105:
                                           ; SOURCE LINE # 886
                                           ; SOURCE LINE # 887
0062 900000      R     MOV     DPTR,#pTmp
0065 E0                MOVX    A,@DPTR
0066 FE                MOV     R6,A
0067 A3                INC     DPTR
0068 E0                MOVX    A,@DPTR
0069 FF                MOV     R7,A
006A 8F82              MOV     DPL,R7
006C 8E83              MOV     DPH,R6
006E C083              PUSH    DPH
0070 C082              PUSH    DPL
0072 900000      R     MOV     DPTR,#confIndex
0075 E0                MOVX    A,@DPTR
0076 FF                MOV     R7,A
0077 D082              POP     DPL
0079 D083              POP     DPH
007B 75F004            MOV     B,#04H
007E EF                MOV     A,R7
007F 120000      E     LCALL   ?C?OFFXADD
0082 A3                INC     DPTR
0083 120000      E     LCALL   ?C?PLDCODE
0086 AE02              MOV     R6,AR2
0088 AF01              MOV     R7,AR1
008A 900000      R     MOV     DPTR,#pTmp
008D EE                MOV     A,R6
008E F0                MOVX    @DPTR,A
008F A3                INC     DPTR
0090 EF                MOV     A,R7
0091 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 888
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 69  

0092         ?C0106:
                                           ; SOURCE LINE # 890
0092 900000      R     MOV     DPTR,#pTmp
0095 E0                MOVX    A,@DPTR
0096 FE                MOV     R6,A
0097 A3                INC     DPTR
0098 E0                MOVX    A,@DPTR
0099 FF                MOV     R7,A
                                           ; SOURCE LINE # 891
009A         ?C0107:
009A 22                RET     
             ; FUNCTION _USBFS_GetConfigTablePtr (END)

             ; FUNCTION USBFS_GetDeviceTablePtr (BEGIN)
                                           ; SOURCE LINE # 908
                                           ; SOURCE LINE # 910
                                           ; SOURCE LINE # 912
0000 900000      E     MOV     DPTR,#USBFS_device
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 EF                MOV     A,R7
0006 25E0              ADD     A,ACC
0008 25E0              ADD     A,ACC
000A 2400        E     ADD     A,#LOW USBFS_TABLE+01H
000C F582              MOV     DPL,A
000E E4                CLR     A
000F 3400        E     ADDC    A,#HIGH USBFS_TABLE+01H
0011 F583              MOV     DPH,A
0013 120000      E     LCALL   ?C?PLDCODE
0016 AE02              MOV     R6,AR2
0018 AF01              MOV     R7,AR1
                                           ; SOURCE LINE # 913
001A         ?C0108:
001A 22                RET     
             ; FUNCTION USBFS_GetDeviceTablePtr (END)

             ; FUNCTION USBFS_GetInterfaceClassTablePtr (BEGIN)
                                           ; SOURCE LINE # 931
                                           ; SOURCE LINE # 933
                                           ; SOURCE LINE # 938
0000 900000      E     MOV     DPTR,#USBFS_configuration
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 EF                MOV     A,R7
0006 14                DEC     A
0007 FF                MOV     R7,A
0008 120000      R     LCALL   _USBFS_GetConfigTablePtr
000B 900000      R     MOV     DPTR,#pTmp
000E EE                MOV     A,R6
000F F0                MOVX    @DPTR,A
0010 A3                INC     DPTR
0011 EF                MOV     A,R7
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 939
0013 900000      R     MOV     DPTR,#pTmp
0016 E0                MOVX    A,@DPTR
0017 FE                MOV     R6,A
0018 A3                INC     DPTR
0019 E0                MOVX    A,@DPTR
001A FF                MOV     R7,A
001B EF                MOV     A,R7
001C 4E                ORL     A,R6
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 70  

001D 606F              JZ      ?C0109
                                           ; SOURCE LINE # 940
                                           ; SOURCE LINE # 941
001F 900000      R     MOV     DPTR,#pTmp
0022 E0                MOVX    A,@DPTR
0023 FE                MOV     R6,A
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 FF                MOV     R7,A
0027 8F82              MOV     DPL,R7
0029 8E83              MOV     DPH,R6
002B A3                INC     DPTR
002C 120000      E     LCALL   ?C?PLDCODE
002F E9                MOV     A,R1
0030 2404              ADD     A,#04H
0032 F9                MOV     R1,A
0033 EA                MOV     A,R2
0034 3400              ADDC    A,#00H
0036 FA                MOV     R2,A
0037 120000      E     LCALL   ?C?CLDPTR
003A FF                MOV     R7,A
003B 900000      R     MOV     DPTR,#currentInterfacesNum
003E EF                MOV     A,R7
003F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 944
0040 900000      R     MOV     DPTR,#currentInterfacesNum
0043 E0                MOVX    A,@DPTR
0044 FF                MOV     R7,A
0045 7E00              MOV     R6,#00H
0047 EF                MOV     A,R7
0048 2402              ADD     A,#02H
004A FF                MOV     R7,A
004B EE                MOV     A,R6
004C 3400              ADDC    A,#00H
004E FE                MOV     R6,A
004F EF                MOV     A,R7
0050 7802              MOV     R0,#02H
0052         ?C0133:
0052 C3                CLR     C
0053 33                RLC     A
0054 CE                XCH     A,R6
0055 33                RLC     A
0056 CE                XCH     A,R6
0057 D8F9              DJNZ    R0,?C0133
0059 FF                MOV     R7,A
005A 900000      R     MOV     DPTR,#pTmp
005D E0                MOVX    A,@DPTR
005E FC                MOV     R4,A
005F A3                INC     DPTR
0060 E0                MOVX    A,@DPTR
0061 FD                MOV     R5,A
0062 EF                MOV     A,R7
0063 2D                ADD     A,R5
0064 FF                MOV     R7,A
0065 EE                MOV     A,R6
0066 3C                ADDC    A,R4
0067 FE                MOV     R6,A
0068 900000      R     MOV     DPTR,#pTmp
006B EE                MOV     A,R6
006C F0                MOVX    @DPTR,A
006D A3                INC     DPTR
006E EF                MOV     A,R7
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 71  

006F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 945
0070 900000      R     MOV     DPTR,#pTmp
0073 E0                MOVX    A,@DPTR
0074 FE                MOV     R6,A
0075 A3                INC     DPTR
0076 E0                MOVX    A,@DPTR
0077 FF                MOV     R7,A
0078 8F82              MOV     DPL,R7
007A 8E83              MOV     DPH,R6
007C A3                INC     DPTR
007D 120000      E     LCALL   ?C?PLDCODE
0080 AE02              MOV     R6,AR2
0082 AF01              MOV     R7,AR1
0084 900000      R     MOV     DPTR,#pInterfaceClass
0087 EE                MOV     A,R6
0088 F0                MOVX    @DPTR,A
0089 A3                INC     DPTR
008A EF                MOV     A,R7
008B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 946
008C 8008              SJMP    ?C0110
008E         ?C0109:
                                           ; SOURCE LINE # 948
                                           ; SOURCE LINE # 949
008E 900000      R     MOV     DPTR,#pInterfaceClass
0091 E4                CLR     A
0092 F0                MOVX    @DPTR,A
0093 A3                INC     DPTR
0094 E4                CLR     A
0095 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 950
0096         ?C0110:
                                           ; SOURCE LINE # 952
0096 900000      R     MOV     DPTR,#pInterfaceClass
0099 E0                MOVX    A,@DPTR
009A FE                MOV     R6,A
009B A3                INC     DPTR
009C E0                MOVX    A,@DPTR
009D FF                MOV     R7,A
                                           ; SOURCE LINE # 953
009E         ?C0111:
009E 22                RET     
             ; FUNCTION USBFS_GetInterfaceClassTablePtr (END)

             ; FUNCTION _USBFS_TerminateEP (BEGIN)
                                           ; SOURCE LINE # 974
0000 900000      R     MOV     DPTR,#ep
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 975
                                           ; SOURCE LINE # 978
0005 900000      R     MOV     DPTR,#ep
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A EF                MOV     A,R7
000B 547F              ANL     A,#07FH
000D FF                MOV     R7,A
000E 900000      R     MOV     DPTR,#ep
0011 EF                MOV     A,R7
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 979
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 72  

0013 900000      R     MOV     DPTR,#ep
0016 E0                MOVX    A,@DPTR
0017 FF                MOV     R7,A
0018 7E00              MOV     R6,#00H
001A EF                MOV     A,R7
001B 24FF              ADD     A,#0FFH
001D FF                MOV     R7,A
001E EE                MOV     A,R6
001F 34FF              ADDC    A,#0FFH
0021 FE                MOV     R6,A
0022 EF                MOV     A,R7
0023 C4                SWAP    A
0024 F8                MOV     R0,A
0025 540F              ANL     A,#0FH
0027 C8                XCH     A,R0
0028 68                XRL     A,R0
0029 FF                MOV     R7,A
002A EE                MOV     A,R6
002B C4                SWAP    A
002C 54F0              ANL     A,#0F0H
002E 48                ORL     A,R0
002F FE                MOV     R6,A
0030 900000      R     MOV     DPTR,#ri
0033 EF                MOV     A,R7
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 981
0035 900000      R     MOV     DPTR,#ep
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
003A EF                MOV     A,R7
003B D3                SETB    C
003C 9400              SUBB    A,#00H
003E 5003              JNC     $ + 5H
0040 020000      R     LJMP    ?C0115
0043 900000      R     MOV     DPTR,#ep
0046 E0                MOVX    A,@DPTR
0047 FF                MOV     R7,A
0048 EF                MOV     A,R7
0049 C3                CLR     C
004A 9409              SUBB    A,#09H
004C 4003              JC      $ + 5H
004E 020000      R     LJMP    ?C0115
                                           ; SOURCE LINE # 982
                                           ; SOURCE LINE # 984
0051 900000      R     MOV     DPTR,#ep
0054 E0                MOVX    A,@DPTR
0055 FF                MOV     R7,A
0056 EF                MOV     A,R7
0057 75F00B            MOV     B,#0BH
005A A4                MUL     AB
005B 2400        E     ADD     A,#LOW USBFS_EP+02H
005D F582              MOV     DPL,A
005F E4                CLR     A
0060 3400        E     ADDC    A,#HIGH USBFS_EP+02H
0062 F583              MOV     DPH,A
0064 E0                MOVX    A,@DPTR
0065 FF                MOV     R7,A
0066 EF                MOV     A,R7
0067 4401              ORL     A,#01H
0069 FF                MOV     R7,A
006A EF                MOV     A,R7
006B F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 73  

                                           ; SOURCE LINE # 987
006C 900000      R     MOV     DPTR,#ep
006F E0                MOVX    A,@DPTR
0070 FF                MOV     R7,A
0071 EF                MOV     A,R7
0072 75F00B            MOV     B,#0BH
0075 A4                MUL     AB
0076 2400        E     ADD     A,#LOW USBFS_EP+03H
0078 F582              MOV     DPL,A
007A E4                CLR     A
007B 3400        E     ADDC    A,#HIGH USBFS_EP+03H
007D F583              MOV     DPH,A
007F E4                CLR     A
0080 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 988
0081 900000      R     MOV     DPTR,#ep
0084 E0                MOVX    A,@DPTR
0085 FF                MOV     R7,A
0086 EF                MOV     A,R7
0087 75F00B            MOV     B,#0BH
008A A4                MUL     AB
008B 2400        E     ADD     A,#LOW USBFS_EP+01H
008D F582              MOV     DPL,A
008F E4                CLR     A
0090 3400        E     ADDC    A,#HIGH USBFS_EP+01H
0092 F583              MOV     DPH,A
0094 7402              MOV     A,#02H
0096 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 990
0097 900000      R     MOV     DPTR,#ep
009A E0                MOVX    A,@DPTR
009B FF                MOV     R7,A
009C EF                MOV     A,R7
009D 75F00B            MOV     B,#0BH
00A0 A4                MUL     AB
00A1 2400        E     ADD     A,#LOW USBFS_EP+04H
00A3 F582              MOV     DPL,A
00A5 E4                CLR     A
00A6 3400        E     ADDC    A,#HIGH USBFS_EP+04H
00A8 F583              MOV     DPH,A
00AA E0                MOVX    A,@DPTR
00AB FF                MOV     R7,A
00AC EF                MOV     A,R7
00AD 5480              ANL     A,#080H
00AF FF                MOV     R7,A
00B0 7E00              MOV     R6,#00H
00B2 EF                MOV     A,R7
00B3 4E                ORL     A,R6
00B4 6017              JZ      ?C0113
                                           ; SOURCE LINE # 991
                                           ; SOURCE LINE # 993
00B6 900000      R     MOV     DPTR,#ri
00B9 E0                MOVX    A,@DPTR
00BA FF                MOV     R7,A
00BB 7E00              MOV     R6,#00H
00BD EF                MOV     A,R7
00BE 240E              ADD     A,#0EH
00C0 FF                MOV     R7,A
00C1 EE                MOV     A,R6
00C2 3460              ADDC    A,#060H
00C4 FE                MOV     R6,A
00C5 8F82              MOV     DPL,R7
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 74  

00C7 8E83              MOV     DPH,R6
00C9 740C              MOV     A,#0CH
00CB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 994
00CC 22                RET     
00CD         ?C0113:
                                           ; SOURCE LINE # 996
                                           ; SOURCE LINE # 998
00CD 900000      R     MOV     DPTR,#ri
00D0 E0                MOVX    A,@DPTR
00D1 FF                MOV     R7,A
00D2 7E00              MOV     R6,#00H
00D4 EF                MOV     A,R7
00D5 240E              ADD     A,#0EH
00D7 FF                MOV     R7,A
00D8 EE                MOV     A,R6
00D9 3460              ADDC    A,#060H
00DB FE                MOV     R6,A
00DC 8F82              MOV     DPL,R7
00DE 8E83              MOV     DPH,R6
00E0 7408              MOV     A,#08H
00E2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 999
                                           ; SOURCE LINE # 1000
                                           ; SOURCE LINE # 1001
00E3         ?C0115:
00E3 22                RET     
             ; FUNCTION _USBFS_TerminateEP (END)

             ; FUNCTION USBFS_SetEndpointHalt (BEGIN)
                                           ; SOURCE LINE # 1021
                                           ; SOURCE LINE # 1022
                                           ; SOURCE LINE # 1025
0000 900000      R     MOV     DPTR,#requestHandled
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1028
0005 906004            MOV     DPTR,#06004H
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A EF                MOV     A,R7
000B 547F              ANL     A,#07FH
000D FF                MOV     R7,A
000E 900000      R     MOV     DPTR,#ep
0011 EF                MOV     A,R7
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1029
0013 900000      R     MOV     DPTR,#ep
0016 E0                MOVX    A,@DPTR
0017 FF                MOV     R7,A
0018 7E00              MOV     R6,#00H
001A EF                MOV     A,R7
001B 24FF              ADD     A,#0FFH
001D FF                MOV     R7,A
001E EE                MOV     A,R6
001F 34FF              ADDC    A,#0FFH
0021 FE                MOV     R6,A
0022 EF                MOV     A,R7
0023 C4                SWAP    A
0024 F8                MOV     R0,A
0025 540F              ANL     A,#0FH
0027 C8                XCH     A,R0
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 75  

0028 68                XRL     A,R0
0029 FF                MOV     R7,A
002A EE                MOV     A,R6
002B C4                SWAP    A
002C 54F0              ANL     A,#0F0H
002E 48                ORL     A,R0
002F FE                MOV     R6,A
0030 900000      R     MOV     DPTR,#ri
0033 EF                MOV     A,R7
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1031
0035 900000      R     MOV     DPTR,#ep
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
003A EF                MOV     A,R7
003B D3                SETB    C
003C 9400              SUBB    A,#00H
003E 5003              JNC     $ + 5H
0040 020000      R     LJMP    ?C0116
0043 900000      R     MOV     DPTR,#ep
0046 E0                MOVX    A,@DPTR
0047 FF                MOV     R7,A
0048 EF                MOV     A,R7
0049 C3                CLR     C
004A 9409              SUBB    A,#09H
004C 4003              JC      $ + 5H
004E 020000      R     LJMP    ?C0116
                                           ; SOURCE LINE # 1032
                                           ; SOURCE LINE # 1034
0051 900000      R     MOV     DPTR,#ep
0054 E0                MOVX    A,@DPTR
0055 FF                MOV     R7,A
0056 EF                MOV     A,R7
0057 75F00B            MOV     B,#0BH
005A A4                MUL     AB
005B 2400        E     ADD     A,#LOW USBFS_EP+02H
005D F582              MOV     DPL,A
005F E4                CLR     A
0060 3400        E     ADDC    A,#HIGH USBFS_EP+02H
0062 F583              MOV     DPH,A
0064 E0                MOVX    A,@DPTR
0065 FF                MOV     R7,A
0066 EF                MOV     A,R7
0067 4401              ORL     A,#01H
0069 FF                MOV     R7,A
006A EF                MOV     A,R7
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1037
006C 900000      R     MOV     DPTR,#ep
006F E0                MOVX    A,@DPTR
0070 FF                MOV     R7,A
0071 EF                MOV     A,R7
0072 75F00B            MOV     B,#0BH
0075 A4                MUL     AB
0076 2400        E     ADD     A,#LOW USBFS_EP+03H
0078 F582              MOV     DPL,A
007A E4                CLR     A
007B 3400        E     ADDC    A,#HIGH USBFS_EP+03H
007D F583              MOV     DPH,A
007F E4                CLR     A
0080 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1038
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 76  

0081 900000      R     MOV     DPTR,#ep
0084 E0                MOVX    A,@DPTR
0085 FF                MOV     R7,A
0086 EF                MOV     A,R7
0087 75F00B            MOV     B,#0BH
008A A4                MUL     AB
008B 2400        E     ADD     A,#LOW USBFS_EP+01H
008D F582              MOV     DPL,A
008F E4                CLR     A
0090 3400        E     ADDC    A,#HIGH USBFS_EP+01H
0092 F583              MOV     DPH,A
0094 E0                MOVX    A,@DPTR
0095 FF                MOV     R7,A
0096 EF                MOV     A,R7
0097 4402              ORL     A,#02H
0099 FF                MOV     R7,A
009A EF                MOV     A,R7
009B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1040
009C 900000      R     MOV     DPTR,#ep
009F E0                MOVX    A,@DPTR
00A0 FF                MOV     R7,A
00A1 EF                MOV     A,R7
00A2 75F00B            MOV     B,#0BH
00A5 A4                MUL     AB
00A6 2400        E     ADD     A,#LOW USBFS_EP+04H
00A8 F582              MOV     DPL,A
00AA E4                CLR     A
00AB 3400        E     ADDC    A,#HIGH USBFS_EP+04H
00AD F583              MOV     DPH,A
00AF E0                MOVX    A,@DPTR
00B0 FF                MOV     R7,A
00B1 EF                MOV     A,R7
00B2 5480              ANL     A,#080H
00B4 FF                MOV     R7,A
00B5 7E00              MOV     R6,#00H
00B7 EF                MOV     A,R7
00B8 4E                ORL     A,R6
00B9 6018              JZ      ?C0117
                                           ; SOURCE LINE # 1041
                                           ; SOURCE LINE # 1044
00BB 900000      R     MOV     DPTR,#ri
00BE E0                MOVX    A,@DPTR
00BF FF                MOV     R7,A
00C0 7E00              MOV     R6,#00H
00C2 EF                MOV     A,R7
00C3 240E              ADD     A,#0EH
00C5 FF                MOV     R7,A
00C6 EE                MOV     A,R6
00C7 3460              ADDC    A,#060H
00C9 FE                MOV     R6,A
00CA 8F82              MOV     DPL,R7
00CC 8E83              MOV     DPH,R6
00CE 748D              MOV     A,#08DH
00D0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1045
00D1 8016              SJMP    ?C0118
00D3         ?C0117:
                                           ; SOURCE LINE # 1047
                                           ; SOURCE LINE # 1050
00D3 900000      R     MOV     DPTR,#ri
00D6 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 77  

00D7 FF                MOV     R7,A
00D8 7E00              MOV     R6,#00H
00DA EF                MOV     A,R7
00DB 240E              ADD     A,#0EH
00DD FF                MOV     R7,A
00DE EE                MOV     A,R6
00DF 3460              ADDC    A,#060H
00E1 FE                MOV     R6,A
00E2 8F82              MOV     DPL,R7
00E4 8E83              MOV     DPH,R6
00E6 7489              MOV     A,#089H
00E8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1051
00E9         ?C0118:
                                           ; SOURCE LINE # 1052
00E9 120000      E     LCALL   USBFS_InitNoDataControlTransfer
00EC 900000      R     MOV     DPTR,#requestHandled
00EF EF                MOV     A,R7
00F0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1053
00F1         ?C0116:
                                           ; SOURCE LINE # 1055
00F1 900000      R     MOV     DPTR,#requestHandled
00F4 E0                MOVX    A,@DPTR
00F5 FF                MOV     R7,A
                                           ; SOURCE LINE # 1056
00F6         ?C0119:
00F6 22                RET     
             ; FUNCTION USBFS_SetEndpointHalt (END)

             ; FUNCTION USBFS_ClearEndpointHalt (BEGIN)
                                           ; SOURCE LINE # 1076
                                           ; SOURCE LINE # 1077
                                           ; SOURCE LINE # 1080
0000 900000      R     MOV     DPTR,#requestHandled
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1083
0005 906004            MOV     DPTR,#06004H
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A EF                MOV     A,R7
000B 547F              ANL     A,#07FH
000D FF                MOV     R7,A
000E 900000      R     MOV     DPTR,#ep
0011 EF                MOV     A,R7
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1084
0013 900000      R     MOV     DPTR,#ep
0016 E0                MOVX    A,@DPTR
0017 FF                MOV     R7,A
0018 7E00              MOV     R6,#00H
001A EF                MOV     A,R7
001B 24FF              ADD     A,#0FFH
001D FF                MOV     R7,A
001E EE                MOV     A,R6
001F 34FF              ADDC    A,#0FFH
0021 FE                MOV     R6,A
0022 EF                MOV     A,R7
0023 C4                SWAP    A
0024 F8                MOV     R0,A
0025 540F              ANL     A,#0FH
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 78  

0027 C8                XCH     A,R0
0028 68                XRL     A,R0
0029 FF                MOV     R7,A
002A EE                MOV     A,R6
002B C4                SWAP    A
002C 54F0              ANL     A,#0F0H
002E 48                ORL     A,R0
002F FE                MOV     R6,A
0030 900000      R     MOV     DPTR,#ri
0033 EF                MOV     A,R7
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1086
0035 900000      R     MOV     DPTR,#ep
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
003A EF                MOV     A,R7
003B D3                SETB    C
003C 9400              SUBB    A,#00H
003E 5003              JNC     $ + 5H
0040 020000      R     LJMP    ?C0120
0043 900000      R     MOV     DPTR,#ep
0046 E0                MOVX    A,@DPTR
0047 FF                MOV     R7,A
0048 EF                MOV     A,R7
0049 C3                CLR     C
004A 9409              SUBB    A,#09H
004C 4003              JC      $ + 5H
004E 020000      R     LJMP    ?C0120
                                           ; SOURCE LINE # 1087
                                           ; SOURCE LINE # 1089
0051 900000      R     MOV     DPTR,#ep
0054 E0                MOVX    A,@DPTR
0055 FF                MOV     R7,A
0056 EF                MOV     A,R7
0057 75F00B            MOV     B,#0BH
005A A4                MUL     AB
005B 2400        E     ADD     A,#LOW USBFS_EP+02H
005D F582              MOV     DPL,A
005F E4                CLR     A
0060 3400        E     ADDC    A,#HIGH USBFS_EP+02H
0062 F583              MOV     DPH,A
0064 E0                MOVX    A,@DPTR
0065 FF                MOV     R7,A
0066 EF                MOV     A,R7
0067 54FE              ANL     A,#0FEH
0069 FF                MOV     R7,A
006A EF                MOV     A,R7
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1092
006C 900000      R     MOV     DPTR,#ep
006F E0                MOVX    A,@DPTR
0070 FF                MOV     R7,A
0071 EF                MOV     A,R7
0072 75F00B            MOV     B,#0BH
0075 A4                MUL     AB
0076 2400        E     ADD     A,#LOW USBFS_EP+03H
0078 F582              MOV     DPL,A
007A E4                CLR     A
007B 3400        E     ADDC    A,#HIGH USBFS_EP+03H
007D F583              MOV     DPH,A
007F E4                CLR     A
0080 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 79  

                                           ; SOURCE LINE # 1095
0081 900000      R     MOV     DPTR,#ri
0084 E0                MOVX    A,@DPTR
0085 FF                MOV     R7,A
0086 7E00              MOV     R6,#00H
0088 EF                MOV     A,R7
0089 240C              ADD     A,#0CH
008B FF                MOV     R7,A
008C EE                MOV     A,R6
008D 3460              ADDC    A,#060H
008F FE                MOV     R6,A
0090 8F82              MOV     DPL,R7
0092 8E83              MOV     DPH,R6
0094 E0                MOVX    A,@DPTR
0095 FF                MOV     R7,A
0096 EF                MOV     A,R7
0097 547F              ANL     A,#07FH
0099 FF                MOV     R7,A
009A EF                MOV     A,R7
009B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1097
009C 900000      R     MOV     DPTR,#ep
009F E0                MOVX    A,@DPTR
00A0 FF                MOV     R7,A
00A1 EF                MOV     A,R7
00A2 75F00B            MOV     B,#0BH
00A5 A4                MUL     AB
00A6 2400        E     ADD     A,#LOW USBFS_EP+01H
00A8 F582              MOV     DPL,A
00AA E4                CLR     A
00AB 3400        E     ADDC    A,#HIGH USBFS_EP+01H
00AD F583              MOV     DPH,A
00AF E0                MOVX    A,@DPTR
00B0 FF                MOV     R7,A
00B1 EF                MOV     A,R7
00B2 54FD              ANL     A,#0FDH
00B4 FF                MOV     R7,A
00B5 EF                MOV     A,R7
00B6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1099
00B7 900000      R     MOV     DPTR,#ep
00BA E0                MOVX    A,@DPTR
00BB FF                MOV     R7,A
00BC EF                MOV     A,R7
00BD 75F00B            MOV     B,#0BH
00C0 A4                MUL     AB
00C1 2400        E     ADD     A,#LOW USBFS_EP+04H
00C3 F582              MOV     DPL,A
00C5 E4                CLR     A
00C6 3400        E     ADDC    A,#HIGH USBFS_EP+04H
00C8 F583              MOV     DPH,A
00CA E0                MOVX    A,@DPTR
00CB FF                MOV     R7,A
00CC EF                MOV     A,R7
00CD 5480              ANL     A,#080H
00CF FF                MOV     R7,A
00D0 7E00              MOV     R6,#00H
00D2 EF                MOV     A,R7
00D3 4E                ORL     A,R6
00D4 6049              JZ      ?C0121
                                           ; SOURCE LINE # 1100
                                           ; SOURCE LINE # 1102
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 80  

00D6 900000      R     MOV     DPTR,#ep
00D9 E0                MOVX    A,@DPTR
00DA FF                MOV     R7,A
00DB EF                MOV     A,R7
00DC 75F00B            MOV     B,#0BH
00DF A4                MUL     AB
00E0 2400        E     ADD     A,#LOW USBFS_EP+01H
00E2 F582              MOV     DPL,A
00E4 E4                CLR     A
00E5 3400        E     ADDC    A,#HIGH USBFS_EP+01H
00E7 F583              MOV     DPH,A
00E9 E0                MOVX    A,@DPTR
00EA FF                MOV     R7,A
00EB EF                MOV     A,R7
00EC B40118            CJNE    A,#01H,?C0122
                                           ; SOURCE LINE # 1103
                                           ; SOURCE LINE # 1104
00EF 900000      R     MOV     DPTR,#ri
00F2 E0                MOVX    A,@DPTR
00F3 FF                MOV     R7,A
00F4 7E00              MOV     R6,#00H
00F6 EF                MOV     A,R7
00F7 240E              ADD     A,#0EH
00F9 FF                MOV     R7,A
00FA EE                MOV     A,R6
00FB 3460              ADDC    A,#060H
00FD FE                MOV     R6,A
00FE 8F82              MOV     DPL,R7
0100 8E83              MOV     DPH,R6
0102 740C              MOV     A,#0CH
0104 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1105
0105 805F              SJMP    ?C0124
0107         ?C0122:
                                           ; SOURCE LINE # 1107
                                           ; SOURCE LINE # 1108
0107 900000      R     MOV     DPTR,#ri
010A E0                MOVX    A,@DPTR
010B FF                MOV     R7,A
010C 7E00              MOV     R6,#00H
010E EF                MOV     A,R7
010F 240E              ADD     A,#0EH
0111 FF                MOV     R7,A
0112 EE                MOV     A,R6
0113 3460              ADDC    A,#060H
0115 FE                MOV     R6,A
0116 8F82              MOV     DPL,R7
0118 8E83              MOV     DPH,R6
011A 740D              MOV     A,#0DH
011C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1109
                                           ; SOURCE LINE # 1110
011D 8047              SJMP    ?C0124
011F         ?C0121:
                                           ; SOURCE LINE # 1112
                                           ; SOURCE LINE # 1114
011F 900000      R     MOV     DPTR,#ep
0122 E0                MOVX    A,@DPTR
0123 FF                MOV     R7,A
0124 EF                MOV     A,R7
0125 75F00B            MOV     B,#0BH
0128 A4                MUL     AB
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 81  

0129 2400        E     ADD     A,#LOW USBFS_EP+01H
012B F582              MOV     DPL,A
012D E4                CLR     A
012E 3400        E     ADDC    A,#HIGH USBFS_EP+01H
0130 F583              MOV     DPH,A
0132 E0                MOVX    A,@DPTR
0133 FF                MOV     R7,A
0134 EF                MOV     A,R7
0135 B40118            CJNE    A,#01H,?C0125
                                           ; SOURCE LINE # 1115
                                           ; SOURCE LINE # 1116
0138 900000      R     MOV     DPTR,#ri
013B E0                MOVX    A,@DPTR
013C FF                MOV     R7,A
013D 7E00              MOV     R6,#00H
013F EF                MOV     A,R7
0140 240E              ADD     A,#0EH
0142 FF                MOV     R7,A
0143 EE                MOV     A,R6
0144 3460              ADDC    A,#060H
0146 FE                MOV     R6,A
0147 8F82              MOV     DPL,R7
0149 8E83              MOV     DPH,R6
014B 7408              MOV     A,#08H
014D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1117
014E 8016              SJMP    ?C0124
0150         ?C0125:
                                           ; SOURCE LINE # 1119
                                           ; SOURCE LINE # 1120
0150 900000      R     MOV     DPTR,#ri
0153 E0                MOVX    A,@DPTR
0154 FF                MOV     R7,A
0155 7E00              MOV     R6,#00H
0157 EF                MOV     A,R7
0158 240E              ADD     A,#0EH
015A FF                MOV     R7,A
015B EE                MOV     A,R6
015C 3460              ADDC    A,#060H
015E FE                MOV     R6,A
015F 8F82              MOV     DPL,R7
0161 8E83              MOV     DPH,R6
0163 7409              MOV     A,#09H
0165 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1121
                                           ; SOURCE LINE # 1122
0166         ?C0124:
                                           ; SOURCE LINE # 1123
0166 120000      E     LCALL   USBFS_InitNoDataControlTransfer
0169 900000      R     MOV     DPTR,#requestHandled
016C EF                MOV     A,R7
016D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1124
016E         ?C0120:
                                           ; SOURCE LINE # 1126
016E 900000      R     MOV     DPTR,#requestHandled
0171 E0                MOVX    A,@DPTR
0172 FF                MOV     R7,A
                                           ; SOURCE LINE # 1127
0173         ?C0127:
0173 22                RET     
             ; FUNCTION USBFS_ClearEndpointHalt (END)
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 82  


             ; FUNCTION USBFS_ValidateAlternateSetting (BEGIN)
                                           ; SOURCE LINE # 1147
                                           ; SOURCE LINE # 1148
                                           ; SOURCE LINE # 1149
0000 900000      R     MOV     DPTR,#requestHandled
0003 7401              MOV     A,#01H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1154
0006 906004            MOV     DPTR,#06004H
0009 E0                MOVX    A,@DPTR
000A FF                MOV     R7,A
000B 900000      R     MOV     DPTR,#interfaceNum
000E EF                MOV     A,R7
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1156
0010 900000      E     MOV     DPTR,#USBFS_configuration
0013 E0                MOVX    A,@DPTR
0014 FF                MOV     R7,A
0015 EF                MOV     A,R7
0016 14                DEC     A
0017 FF                MOV     R7,A
0018 120000      R     LCALL   _USBFS_GetConfigTablePtr
001B 900000      R     MOV     DPTR,#pTmp
001E EE                MOV     A,R6
001F F0                MOVX    @DPTR,A
0020 A3                INC     DPTR
0021 EF                MOV     A,R7
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1157
0023 900000      R     MOV     DPTR,#pTmp
0026 E0                MOVX    A,@DPTR
0027 FE                MOV     R6,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
002A FF                MOV     R7,A
002B 8F82              MOV     DPL,R7
002D 8E83              MOV     DPH,R6
002F A3                INC     DPTR
0030 120000      E     LCALL   ?C?PLDCODE
0033 E9                MOV     A,R1
0034 2404              ADD     A,#04H
0036 F9                MOV     R1,A
0037 EA                MOV     A,R2
0038 3400              ADDC    A,#00H
003A FA                MOV     R2,A
003B 120000      E     LCALL   ?C?CLDPTR
003E FF                MOV     R7,A
003F 900000      R     MOV     DPTR,#currentInterfacesNum
0042 EF                MOV     A,R7
0043 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1159
0044 900000      R     MOV     DPTR,#currentInterfacesNum
0047 E0                MOVX    A,@DPTR
0048 FF                MOV     R7,A
0049 900000      R     MOV     DPTR,#interfaceNum
004C E0                MOVX    A,@DPTR
004D FE                MOV     R6,A
004E EE                MOV     A,R6
004F C3                CLR     C
0050 9F                SUBB    A,R7
0051 500B              JNC     ?C0129
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 83  

0053 900000      R     MOV     DPTR,#interfaceNum
0056 E0                MOVX    A,@DPTR
0057 FF                MOV     R7,A
0058 EF                MOV     A,R7
0059 C3                CLR     C
005A 9402              SUBB    A,#02H
005C 4007              JC      ?C0128
005E         ?C0129:
                                           ; SOURCE LINE # 1160
                                           ; SOURCE LINE # 1161
005E 900000      R     MOV     DPTR,#requestHandled
0061 E4                CLR     A
0062 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1162
0063 8038              SJMP    ?C0130
0065         ?C0128:
                                           ; SOURCE LINE # 1164
                                           ; SOURCE LINE # 1166
0065 900000      R     MOV     DPTR,#interfaceNum
0068 E0                MOVX    A,@DPTR
0069 FF                MOV     R7,A
006A 7400        E     MOV     A,#LOW USBFS_interfaceSetting
006C 2F                ADD     A,R7
006D F582              MOV     DPL,A
006F E4                CLR     A
0070 3400        E     ADDC    A,#HIGH USBFS_interfaceSetting
0072 F583              MOV     DPH,A
0074 E0                MOVX    A,@DPTR
0075 FF                MOV     R7,A
0076 900000      R     MOV     DPTR,#interfaceNum
0079 E0                MOVX    A,@DPTR
007A FE                MOV     R6,A
007B 7400        E     MOV     A,#LOW USBFS_interfaceSetting_last
007D 2E                ADD     A,R6
007E F582              MOV     DPL,A
0080 E4                CLR     A
0081 3400        E     ADDC    A,#HIGH USBFS_interfaceSetting_last
0083 F583              MOV     DPH,A
0085 EF                MOV     A,R7
0086 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1167
0087 906002            MOV     DPTR,#06002H
008A E0                MOVX    A,@DPTR
008B FF                MOV     R7,A
008C 900000      R     MOV     DPTR,#interfaceNum
008F E0                MOVX    A,@DPTR
0090 FE                MOV     R6,A
0091 7400        E     MOV     A,#LOW USBFS_interfaceSetting
0093 2E                ADD     A,R6
0094 F582              MOV     DPL,A
0096 E4                CLR     A
0097 3400        E     ADDC    A,#HIGH USBFS_interfaceSetting
0099 F583              MOV     DPH,A
009B EF                MOV     A,R7
009C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1168
009D         ?C0130:
                                           ; SOURCE LINE # 1170
009D 900000      R     MOV     DPTR,#requestHandled
00A0 E0                MOVX    A,@DPTR
00A1 FF                MOV     R7,A
                                           ; SOURCE LINE # 1171
C51 COMPILER V9.51   USBFS_STD                                                             05/19/2017 11:21:14 PAGE 84  

00A2         ?C0131:
00A2 22                RET     
             ; FUNCTION USBFS_ValidateAlternateSetting (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   5259    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2      56
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
